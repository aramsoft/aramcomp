<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="aramframework.com.cop.smt.lsm.dao.LeaderSchdulMapper">

	<!-- 간부일정관리::목록조회 -->
	<select id="selectLeaderSchdulList" resultType="egovMap">
	 	<![CDATA[
			SELECT A.SCHDUL_ID					AS "schdulId"
				 , A.SCHDUL_SE					AS "schdulSe"
				 , A.SCHDUL_NM					AS "schdulNm"
				 , A.SCHDUL_BGNDE				AS "schdulBgnde"
				 , A.SCHDUL_ENDDE				AS "schdulEndde"
				 , C.USER_NM 					AS "leaderName" 
				 , A.REPTIT_SE_CODE 			AS "reptitSeCode"
			  FROM COMTN_LEADER_SCHDUL A
				   LEFT OUTER JOIN COMTN_EMPLYR_INFO C
						ON A.LEADER_ID = C.ESNTL_ID
			 WHERE 1=1 
	 	]]>
    	<if test='searchMode != null and searchMode != ""'>
        <choose>
        	<when test='searchMode == "MONTH"'>
				<![CDATA[ 
		 	 		AND (#{searchMonth} BETWEEN SUBSTR(A.SCHDUL_BGNDE, 1, 6)  AND SUBSTR(A.SCHDUL_ENDDE, 1, 6) ) 
				]]>
            </when>
            <when test='searchMode == "WEEK"'>
				<![CDATA[ 
			    	AND (  
					 	( SUBSTR(A.SCHDUL_BGNDE,1,8) > #{searchBgnde} AND SUBSTR(A.SCHDUL_BGNDE,1,8) <= #{searchEndde})
						OR
					 	( SUBSTR(A.SCHDUL_ENDDE,1,8) > #{searchBgnde} AND SUBSTR(A.SCHDUL_ENDDE,1,8) <= #{searchEndde})
				   	)
				]]>
            </when>
            <when test='searchMode == "DAILY"'>
				<![CDATA[
			 	  	AND (#{searchDay} BETWEEN SUBSTR(A.SCHDUL_BGNDE, 1, 8)  AND SUBSTR(A.SCHDUL_ENDDE, 1, 8) )
				]]> 
            </when>
        </choose>
		</if>
     	<if test='searchSchdulSe != null and searchSchdulSe != ""'>
	  			<![CDATA[ AND A.SCHDUL_SE = #{searchSchdulSe} ]]> 
		</if>
   	    <if test='searchUser != null and searchUser != ""'>
 	  			<![CDATA[ AND C.USER_NM LIKE '%'||#{searchUser}||'%' ]]> 
		</if>
	 	<![CDATA[
			ORDER BY SCHDUL_BGNDE
		]]> 
	</select>
	
	<!-- 간부일정관리::상세보기 -->
	<select id="selectLeaderSchdul" resultType="leaderSchdulVO" >
	 	<![CDATA[
			SELECT A.SCHDUL_ID
				 , A.SCHDUL_SE
				 , A.SCHDUL_NM
				 , A.SCHDUL_CN
				 , A.SCHDUL_PLACE
				 , A.LEADER_ID
				 , B.USER_NM 					AS "leaderName" 
				 , A.REPTIT_SE_CODE
				 , A.SCHDUL_BGNDE
				 , A.SCHDUL_ENDDE
				 , A.SCHDUL_CHARGER_ID
				 , C.USER_NM 					AS "schdulChargerName"
				 , A.FRST_REGIST_PNTTM			AS "frstRegisterPnttm"
				 , A.FRST_REGISTER_ID
				 , A.LAST_UPDT_PNTTM			AS "lastUpdusrPnttm"
				 , A.LAST_UPDUSR_ID 
			  FROM COMTN_LEADER_SCHDUL A
				   LEFT OUTER JOIN COMTN_EMPLYR_INFO B
						ON A.LEADER_ID = B.ESNTL_ID
				   LEFT OUTER JOIN COMTN_EMPLYR_INFO C
						ON A.SCHDUL_CHARGER_ID = C.ESNTL_ID
			 WHERE A.SCHDUL_ID = #{schdulId}
		]]> 
	</select>
	
	<!-- 간부일정관리::입력  -->
	<insert id="insertLeaderSchdul" >
	 	<![CDATA[
			INSERT INTO COMTN_LEADER_SCHDUL ( 
					SCHDUL_ID
				  , SCHDUL_SE
				  ,	SCHDUL_NM
				  ,	SCHDUL_CN
				  , SCHDUL_PLACE
				  ,	LEADER_ID
				  ,	REPTIT_SE_CODE
				  ,	SCHDUL_BGNDE
				  ,	SCHDUL_ENDDE
				  , SCHDUL_CHARGER_ID
				  , FRST_REGISTER_ID 
				  , FRST_REGIST_PNTTM 
				  , LAST_UPDUSR_ID
				  , LAST_UPDT_PNTTM 
			)VALUES( 
					#{schdulId}
				  ,	#{schdulSe}
				  ,	#{schdulNm}
				  ,	#{schdulCn}
				  ,	#{schdulPlace, jdbcType=VARCHAR}
				  ,	#{leaderId}
				  ,	#{reptitSeCode}
				  ,	#{schdulBgnde}
				  ,	#{schdulEndde}
				  ,	#{schdulChargerId}
				  , #{frstRegisterId}
				  , SYSDATE
				  , #{frstRegisterId} 
				  , SYSDATE
			)
	 	]]>
	</insert>
	
	<!-- 간부일정정보::수정  -->
	<update id="updateLeaderSchdul" > 
	 	<![CDATA[
			UPDATE COMTN_LEADER_SCHDUL 
			   SET SCHDUL_SE			= #{schdulSe}
			     , SCHDUL_NM			= #{schdulNm}
			     , SCHDUL_CN			= #{schdulCn}
			     , SCHDUL_PLACE			= #{schdulPlace, jdbcType=VARCHAR}
			     , LEADER_ID			= #{leaderId}
			     , REPTIT_SE_CODE		= #{reptitSeCode}
			     , SCHDUL_BGNDE			= #{schdulBgnde}
			     , SCHDUL_ENDDE			= #{schdulEndde}
			     , SCHDUL_CHARGER_ID	= #{schdulChargerId}
			     , LAST_UPDUSR_ID 		= #{lastUpdusrId}
			     , LAST_UPDT_PNTTM 		= SYSDATE
			 WHERE SCHDUL_ID = #{schdulId}
	 	]]>
	</update>
	
	<!-- 간부일정관리::삭제  -->
	<delete id="deleteLeaderSchdul" > 
		<![CDATA[
			DELETE 
			  FROM COMTN_LEADER_SCHDUL 
			 WHERE SCHDUL_ID = #{schdulId}
		]]>
	</delete>
	
	<!-- 간부상태::목록조회 -->
	<select id="selectLeaderSttusList" resultType="egovMap">
		<![CDATA[
	        SELECT *
	          FROM (
	        SELECT ROWNUM RNUM, ALL_LIST.*
	          FROM (
       	]]>
       	/* 구현 Sql */
	 	<![CDATA[
			SELECT A.LEADER_ID					AS "leaderId"
				 , B.USER_NM 					AS "leaderNm" 
				 , D.ORGNZT_NM					AS "orgnztNm"
				 , E.CODE_NM 					AS "leaderSttusNm" 
				 , A.LAST_UPDT_PNTTM			AS "lastUpdusrPnttm"
			  FROM COMTN_LEADER_STTUS A
				   LEFT OUTER JOIN COMTN_EMPLYR_INFO B
						ON  A.LEADER_ID = B.ESNTL_ID 
				   LEFT OUTER JOIN COMTN_ORGNZT_INFO D
						ON  B.ORGNZT_ID = D.ORGNZT_ID
				   LEFT OUTER JOIN (SELECT CODE, CODE_NM
					    	   		  FROM COMTC_CMMN_DETAIL_CODE  	
					    	  		 WHERE CODE_ID = 'COM061') E
				       	ON A.LEADER_STTUS = E.CODE
			 WHERE 1=1
	 	]]>
   	    <if test='searchVO.searchKeyword != null and searchVO.searchKeyword != ""'>
        <choose>
            <when test='searchVO.searchCondition == "USER_NM"'>
             	<![CDATA[ AND B.USER_NM LIKE '%'|| #{searchVO.searchKeyword} ||'%' ]]>
            </when>
            <when test='searchVO.searchCondition == "LEADER_STTUS"'>
             	<![CDATA[ AND E.CODE_NM LIKE '%'|| #{searchVO.searchKeyword} ||'%' ]]>
            </when>
        </choose>
		</if>
	 	<![CDATA[
		 	ORDER BY B.USER_NM ASC
	 	]]>	
       	/* 구현 Sql */
       	<![CDATA[
                ) ALL_LIST
                )
            WHERE RNUM BETWEEN #{searchVO.firstIndex} + 1 AND #{searchVO.firstIndex} + #{searchVO.recordPerPage}
       ]]>			
	</select>
	
	<!-- 간부상태::목록조회 Count-->
	<select id="selectLeaderSttusListCnt" resultType="int" >
		<![CDATA[
			SELECT COUNT(A.LEADER_ID) as cnt
			  FROM COMTN_LEADER_STTUS A
				   LEFT OUTER JOIN COMTN_EMPLYR_INFO B
						ON  A.LEADER_ID = B.ESNTL_ID 
				   LEFT OUTER JOIN COMTN_ORGNZT_INFO D
						ON  B.ORGNZT_ID = D.ORGNZT_ID
				   LEFT OUTER JOIN (SELECT CODE, CODE_NM
					    	   		  FROM COMTC_CMMN_DETAIL_CODE  	
					    	  		 WHERE CODE_ID = 'COM061') E
				       	ON A.LEADER_STTUS = E.CODE
			 WHERE 1=1
		]]>
   	    <if test='searchVO.searchKeyword != null and searchVO.searchKeyword != ""'>
        <choose>
            <when test='searchVO.searchCondition == "USER_NM"'>
             	<![CDATA[ AND B.USER_NM LIKE '%'|| #{searchVO.searchKeyword} ||'%' ]]>
            </when>
            <when test='searchVO.searchCondition == "LEADER_STTUS"'>
             	<![CDATA[ AND E.CODE_NM LIKE '%'|| #{searchVO.searchKeyword} ||'%' ]]>
            </when>
        </choose>
		</if>
	</select>
	
	<!-- 간부상태::상세보기 -->
	<select id="selectLeaderSttus" resultType="leaderSttusVO" >
		<![CDATA[
			SELECT A.LEADER_ID
				 , B.USER_NM 					AS "leaderNm"
				 , C.ORGNZT_NM
				 , A.LEADER_STTUS
				 , D.CODE_NM 					AS "leaderSttusNm"
			  FROM COMTN_LEADER_STTUS A
				   LEFT OUTER JOIN COMTN_EMPLYR_INFO B
						ON  A.LEADER_ID = B.ESNTL_ID 
				   LEFT OUTER JOIN COMTN_ORGNZT_INFO C
						ON  B.ORGNZT_ID = C.ORGNZT_ID
				   LEFT OUTER JOIN (SELECT CODE, CODE_NM
					    	   		  FROM COMTC_CMMN_DETAIL_CODE  	
					    	  		 WHERE CODE_ID = 'COM061') D
				       	ON A.LEADER_STTUS = D.CODE
			 WHERE A.LEADER_ID = #{leaderId}
		]]>
	</select>
	
	<!-- 간부상태::입력  -->
	<insert id="insertLeaderSttus" >
	 	<![CDATA[
			INSERT INTO COMTN_LEADER_STTUS ( 
					LEADER_ID
				  ,	LEADER_STTUS
				  , FRST_REGISTER_ID 
				  , FRST_REGIST_PNTTM 
				  , LAST_UPDUSR_ID
				  , LAST_UPDT_PNTTM 
			)VALUES( 
					#{leaderId}
				  ,	#{leaderSttus}
				  , #{frstRegisterId}
				  , SYSDATE
				  , #{frstRegisterId} 
				  , SYSDATE
			)
	 	]]>
	</insert>
	
	<!-- 간부상태::중복 CHECK Count -->
	<select id="selectLeaderSttusCheck" resultType="int" >
	 	<![CDATA[
		 	SELECT COUNT(LEADER_ID) as cnt
			  FROM COMTN_LEADER_STTUS 
			 WHERE LEADER_ID = #{leaderId}
	 	]]>
	</select>
	
	<!-- 간부상태::수정  -->
	<update id="updateLeaderSttus" > 
	 	<![CDATA[
			UPDATE COMTN_LEADER_STTUS 
			   SET LEADER_STTUS		= #{leaderSttus}
			   	 , LAST_UPDUSR_ID 	= #{lastUpdusrId}
			   	 , LAST_UPDT_PNTTM  = SYSDATE
			 WHERE LEADER_ID = #{leaderId}
	 	]]>
	</update>
	
	<!-- 간부상태::삭제  -->
	<delete id="deleteLeaderSttus" > 
		<![CDATA[
			DELETE 
			  FROM COMTN_LEADER_STTUS 
			 WHERE LEADER_ID = #{leaderId}
		]]>
	</delete>
	
</mapper>