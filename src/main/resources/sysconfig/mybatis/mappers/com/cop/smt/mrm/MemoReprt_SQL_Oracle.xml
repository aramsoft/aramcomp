<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="aramframework.com.cop.smt.mrm.service.impl.MemoReprtMapper">

	<select id="selectReportrList" resultType="egovMap"  >
		<![CDATA[
            SELECT *
              FROM (
            SELECT ROWNUM RNUM, ALL_LIST.*
              FROM (
        ]]>
        /* 구현 Sql */
		<![CDATA[
			SELECT b.ORGNZT_NM				AS "orgnztNm" 
				 , a.ESNTL_ID 				AS "uniqId"
				 , a.USER_NM  				AS "emplyrNm" 
				 , a.EMPL_NO				AS "emplNo" 
				 , a.OFCPS_NM				AS "ofcpsNm" 
			  FROM COMTN_EMPLYR_INFO a
				   LEFT OUTER JOIN COMTN_ORGNZT_INFO b
						ON a.ORGNZT_ID = b.ORGNZT_ID
			 WHERE 1=1
		]]>
  	    <if test='searchKeyword != null and searchKeyword != ""'>
        <choose>
            <when test='searchCondition == "ORGNZT_NM"'>
             	<![CDATA[ AND NVL(b.ORGNZT_NM, ' ') LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
            <when test='searchCondition == "USER_NM"'>
             	<![CDATA[ AND NVL(a.USER_NM, ' ') LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
        </choose>
		</if>
		<![CDATA[
			 ORDER BY b.ORGNZT_NM, a.USER_NM ASC
		]]>		
        /* 구현 Sql */
        <![CDATA[
                   ) ALL_LIST
                   )
             WHERE RNUM BETWEEN #{firstIndex} + 1 AND #{firstIndex} + #{recordPerPage}
        ]]>			
	</select>
	
	<select id="selectReportrListCnt" resultType="int" >
		<![CDATA[
			SELECT COUNT(EMPLYR_ID) as cnt
			  FROM COMTN_EMPLYR_INFO a
				   LEFT OUTER JOIN COMTN_ORGNZT_INFO b
						ON a.ORGNZT_ID = b.ORGNZT_ID
			 WHERE 1=1
		]]>
   	    <if test='searchKeyword != null and searchKeyword != ""'>
        <choose>
            <when test='searchCondition == "ORGNZT_NM"'>
             	<![CDATA[ AND NVL(b.ORGNZT_NM, ' ') LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
            <when test='searchCondition == "USER_NM"'>
             	<![CDATA[ AND NVL(a.USER_NM, ' ') LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
        </choose>
		</if>
	</select>
	
	<!-- 사용자::조회 -->
	<select id="selectWrterClsfNm" resultType="String">
		 <![CDATA[
			SELECT OFCPS_NM 
			  FROM COMTN_EMPLYR_INFO
			 WHERE ESNTL_ID = #{wrterId}
		 ]]>
	</select>
	
	<!-- 메모보고::목록조회 -->
	<select id="selectMemoReprtList" resultType="egovMap" >
		<![CDATA[
            SELECT *
              FROM (
            SELECT ROWNUM RNUM, ALL_LIST.*
              FROM (
        ]]>
        /* 구현 Sql */
		 <![CDATA[
			SELECT A.REPRT_ID				AS "reprtId" 
				 , A.REPRT_SJ				AS "reprtSj" 
				 , A.REPORT_DE				AS "reportDe" 
				 , B.USER_NM 				AS "wrterNm" 
				 , (CASE WHEN NVL(A.DRCT_MATTER_REGIST_DT, ' ') = ' ' THEN '미등록' ELSE '등록' END) AS "drctMatterRegistDt" 
				 , (CASE WHEN NVL(A.REPORTR_INQIRE_DT, ' ') = ' ' THEN '미확인' ELSE '확인' END) AS "reportrInqireDt" 
			  FROM COMTN_MEMO_REPRT A
				   LEFT OUTER JOIN COMTN_EMPLYR_INFO B
						ON A.WRTER_ID = B.ESNTL_ID
			 WHERE (A.WRTER_ID = #{searchId} OR A.REPORTR_ID = #{searchId})
		]]>
   	    <if test='searchBgnDe != null and searchBgnDe != ""'>
				<![CDATA[ AND A.REPORT_DE BETWEEN #{searchBgnDe} AND #{searchEndDe}	]]>
		</if>
    	<if test='searchKeyword != null and searchKeyword != ""'>
        <choose>
            <when test='searchCondition == "REPRT_SJ"'>
             	<![CDATA[ AND A.REPRT_SJ LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
            <when test='searchCondition == "REPORT_CN"'>
             	<![CDATA[ AND A.REPORT_CN LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
            <when test='searchCondition == "USER_NM"'>
             	<![CDATA[ AND B.USER_NM LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
        </choose>
		</if>
        <choose>
            <when test='searchDrctMatter == "0"'>
             	<![CDATA[ AND NVL(A.DRCT_MATTER_REGIST_DT, ' ') = ' '  ]]>
            </when>
            <when test='searchDrctMatter == "1"'>
             	<![CDATA[ AND NVL(A.DRCT_MATTER_REGIST_DT, ' ') != ' ' 	]]>
            </when>
        </choose>
        <choose>
            <when test='searchSttus == "0"'>
             	<![CDATA[ AND NVL(A.REPORTR_INQIRE_DT, ' ') = ' '  ]]>
            </when>
            <when test='searchSttus == "1"'>
             	<![CDATA[ AND NVL(A.REPORTR_INQIRE_DT, ' ') != ' '  	]]>
            </when>
        </choose>
		<![CDATA[
			 ORDER BY A.FRST_REGIST_PNTTM DESC
		]]>	
        /* 구현 Sql */
        <![CDATA[
                   ) ALL_LIST
                   )
             WHERE RNUM BETWEEN #{firstIndex} + 1 AND #{firstIndex} + #{recordPerPage}
        ]]>			
	</select>
	
	<!-- 메모보고::목록조회 Count -->
	<select id="selectMemoReprtListCnt" resultType="int" >
	 	<![CDATA[
			SELECT COUNT(A.REPRT_ID) as cnt
			  FROM COMTN_MEMO_REPRT A
			 	   LEFT OUTER JOIN COMTN_EMPLYR_INFO B
						ON A.WRTER_ID = B.ESNTL_ID
			 WHERE (A.WRTER_ID = #{searchId} OR A.REPORTR_ID = #{searchId})
	 	]]>
   	    <if test='searchBgnDe != null and searchBgnDe != ""'>
				<![CDATA[ AND A.REPORT_DE BETWEEN #{searchBgnDe} AND #{searchEndDe}	]]>
		</if>
    	<if test='searchKeyword != null and searchKeyword != ""'>
        <choose>
            <when test='searchCondition == "REPRT_SJ"'>
             	<![CDATA[ AND A.REPRT_SJ LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
            <when test='searchCondition == "REPORT_CN"'>
             	<![CDATA[ AND A.REPORT_CN LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
            <when test='searchCondition == "USER_NM"'>
             	<![CDATA[ AND B.USER_NM LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
        </choose>
		</if>
        <choose>
            <when test='searchDrctMatter == "0"'>
             	<![CDATA[ AND NVL(A.DRCT_MATTER_REGIST_DT, ' ') = ' '  ]]>
            </when>
            <when test='searchDrctMatter == "1"'>
             	<![CDATA[ AND NVL(A.DRCT_MATTER_REGIST_DT, ' ') != ' ' 	]]>
            </when>
        </choose>
        <choose>
            <when test='searchSttus == "0"'>
             	<![CDATA[ AND NVL(A.REPORTR_INQIRE_DT, ' ') = ' '  ]]>
            </when>
            <when test='searchSttus == "1"'>
             	<![CDATA[ AND NVL(A.REPORTR_INQIRE_DT, ' ') != ' '  	]]>
            </when>
        </choose>
	</select>
	
	<!-- 메모보고::상세보기 -->
	<select id="selectMemoReprt" resultType="memoReprtVO" >
	 	<![CDATA[
			SELECT A.REPRT_ID
				 , A.REPRT_SJ
				 , A.REPORT_DE				AS "reprtDe"
				 , A.WRTER_ID
				 , B.USER_NM 				AS "wrterNm" 
				 , B.OFCPS_NM 				AS "wrterClsfNm" 
				 , A.REPORTR_ID
				 , C.USER_NM 				AS "reportrNm" 
				 , C.OFCPS_NM 				AS "reportrClsfNm"  
				 , A.REPORT_CN
				 , A.ATCH_FILE_ID
				 , A.DRCT_MATTER
				 , A.DRCT_MATTER_REGIST_DT
				 , A.REPORTR_INQIRE_DT
				 , A.FRST_REGIST_PNTTM		AS "frstRegisterPnttm"
				 , A.FRST_REGISTER_ID
				 , A.LAST_UPDT_PNTTM		AS "lastUpdusrPnttm"
				 , A.LAST_UPDUSR_ID 
			  FROM COMTN_MEMO_REPRT A
				   LEFT OUTER JOIN COMTN_EMPLYR_INFO B
						ON A.WRTER_ID = B.ESNTL_ID
				   LEFT OUTER JOIN COMTN_EMPLYR_INFO C
						ON A.REPORTR_ID = C.ESNTL_ID
			 WHERE A.REPRT_ID = #{reprtId}
	 	]]>
	</select>
	
	<!-- 메모보고::입력  -->
	<insert id="insertMemoReprt" >
	 	<![CDATA[
			INSERT INTO COMTN_MEMO_REPRT ( 
					REPRT_ID
				  ,	REPRT_SJ
				  ,	REPORT_DE
				  ,	WRTER_ID
				  ,	REPORTR_ID
				  ,	REPORT_CN
				  ,	ATCH_FILE_ID
				  ,	DRCT_MATTER
				  ,	DRCT_MATTER_REGIST_DT
				  ,	REPORTR_INQIRE_DT
				  , FRST_REGISTER_ID 
				  , FRST_REGIST_PNTTM 
				  , LAST_UPDUSR_ID
				  , LAST_UPDT_PNTTM 
			)VALUES( 
					#{reprtId}
				  ,	#{reprtSj}
				  ,	#{reprtDe}
				  ,	#{wrterId}
				  ,	#{reportrId}
				  ,	#{reprtCn}
				  ,	#{atchFileId, jdbcType=VARCHAR}
				  ,	''
				  ,	''
				  ,	''
				  , #{frstRegisterId}
				  , SYSDATE
				  , #{frstRegisterId} 
				  , SYSDATE
			)
	 	]]>
	</insert>

	<!-- 메모보고::수정  -->
	<update id="updateMemoReprt" > 
	 	<![CDATA[
			UPDATE COMTN_MEMO_REPRT 
			   SET REPRT_SJ			= #{reprtSj}
			   	 , REPORT_DE		= #{reprtDe}
			   	 , WRTER_ID			= #{wrterId}
			   	 , REPORTR_ID		= #{reportrId}
			   	 , REPORT_CN		= #{reprtCn}
			   	 , ATCH_FILE_ID		= #{atchFileId, jdbcType=VARCHAR}
			   	 , LAST_UPDUSR_ID 	= #{lastUpdusrId}
			   	 , LAST_UPDT_PNTTM = SYSDATE
			 WHERE REPRT_ID = #{reprtId}
	 	]]>
	</update>
	
	<!-- 메모보고::확인  -->
	<update id="readMemoReprt" > 
	 	<![CDATA[
			UPDATE COMTN_MEMO_REPRT 
			   SET REPORTR_INQIRE_DT = #{reportrInqireDt}
			 WHERE REPRT_ID = #{reprtId}
	 	]]>
	</update>
	
	<!-- 메모보고::지시/의견사항 등록  -->
	<update id="updateMemoReprtDrctMatter" > 
	 	<![CDATA[
			UPDATE COMTN_MEMO_REPRT 
			   SET DRCT_MATTER			 = #{drctMatter}
			   	 , DRCT_MATTER_REGIST_DT = #{drctMatterRegistDt}
			 WHERE REPRT_ID = #{reprtId}
	 	]]>
	</update>
	
	<!-- 메모보고::삭제  -->
	<delete id="deleteMemoReprt" > 
		<![CDATA[
			DELETE 
			  FROM COMTN_MEMO_REPRT 
			 WHERE REPRT_ID = #{reprtId}
		]]>
	</delete>
	
</mapper>