<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="aramframework.com.cop.smt.wmr.service.impl.WikMnthngReprtMapper">

	<select id="selectReportrList" resultType="egovMap" >
		<![CDATA[
            SELECT *
              FROM (
            SELECT ROWNUM RNUM, ALL_LIST.*
              FROM (
        ]]>
        /* 구현 Sql */
		<![CDATA[
			SELECT b.ORGNZT_NM				AS "orgnztNm" 
				 , a.ESNTL_ID 				AS "uniqId"
				 , a.USER_NM  				AS "emplyrNm" 
				 , a.EMPL_NO				AS "emplNo" 
				 , a.OFCPS_NM				AS "ofcpsNm" 
			  FROM COMTN_EMPLYR_INFO a
				   LEFT OUTER JOIN COMTN_ORGNZT_INFO b
						ON a.ORGNZT_ID = b.ORGNZT_ID
			 WHERE 1=1
		]]>
 	    <if test='searchKeyword != null and searchKeyword != ""'>
        <choose>
            <when test='searchCondition == "ORGNZT_NM"'>
             	<![CDATA[ AND NVL(b.ORGNZT_NM, ' ') LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
            <when test='searchCondition == "USER_NM"'>
             	<![CDATA[ AND NVL(a.USER_NM, ' ') LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
        </choose>
		</if>
		<![CDATA[
			 ORDER BY b.ORGNZT_NM, a.USER_NM ASC
		]]>				
        /* 구현 Sql */
        <![CDATA[
                   ) ALL_LIST
                   )
             WHERE RNUM BETWEEN #{firstIndex} + 1 AND #{firstIndex} + #{recordPerPage}
        ]]>			
	</select>	
	
	<select id="selectReportrListCnt" resultType="int" >
		<![CDATA[
			SELECT COUNT(EMPLYR_ID) as cnt
			  FROM COMTN_EMPLYR_INFO a
				   LEFT OUTER JOIN COMTN_ORGNZT_INFO b
						ON a.ORGNZT_ID = b.ORGNZT_ID
			 WHERE 1=1
		]]>
   	    <if test='searchKeyword != null and searchKeyword != ""'>
        <choose>
            <when test='searchCondition == "ORGNZT_NM"'>
             	<![CDATA[ AND NVL(b.ORGNZT_NM, ' ') LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
            <when test='searchCondition == "USER_NM"'>
             	<![CDATA[ AND NVL(a.USER_NM, ' ') LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
        </choose>
		</if>
	</select>
	
	<!-- 사용자::조회 -->
	<select id="selectWrterClsfNm" resultType="String">
	 	<![CDATA[
			SELECT OFCPS_NM 
			  FROM COMTN_EMPLYR_INFO
			 WHERE ESNTL_ID = #{wrterId}
	 	]]>
	</select>
	
	<!-- 주간/월간보고::목록조회 -->
	<select id="selectWikMnthngReprtList" resultType="egovMap">
		<![CDATA[
            SELECT *
              FROM (
            SELECT ROWNUM RNUM, ALL_LIST.*
              FROM (
        ]]>
        /* 구현 Sql */
		 <![CDATA[
			SELECT A.REPRT_ID				AS "reprtId"
				 , C.CODE_NM   				AS "reprtSe" 
				 , A.REPRT_SJ				AS "reprtSj"
				 , A.REPORT_DE				AS "reprtDe" 
				 , B.USER_NM 				AS "wrterNm" 
				 , A.REPORT_BGNDE			AS "reprtBgnde" 
				 , A.REPORT_ENDDE			AS "reprtEndde" 
				 , (CASE WHEN NVL(A.CONFM_DT, ' ') = ' ' THEN '미승인' ELSE '승인' END) AS "confmDt"
			  FROM COMTN_WIKMNTHNG_REPRT A
				   LEFT OUTER JOIN COMTN_EMPLYR_INFO B
						ON A.WRTER_ID = B.ESNTL_ID
				   LEFT OUTER JOIN (SELECT CODE, CODE_NM
					    	   		  FROM COMTC_CMMN_DETAIL_CODE  	
					    	  		 WHERE CODE_ID = 'COM060') C
				       	ON A.REPRT_SE = C.CODE
			 WHERE (A.WRTER_ID = #{searchId} OR A.REPORTR_ID = #{searchId})
		]]>
	    <if test='searchDe != null and searchDe != ""'>
        <choose>
            <when test='searchDe == "0"'>
	 			<![CDATA[ AND A.REPORT_DE  BETWEEN #{searchBgnDe} AND #{searchEndDe}		]]>
            </when>
            <when test='searchDe == "1"'>
		 		<![CDATA[	
		 			AND (A.REPORT_BGNDE BETWEEN #{searchBgnDe} AND #{searchEndDe}		
		 			     OR	A.REPORT_ENDDE BETWEEN #{searchBgnDe} AND #{searchEndDe}	)
	 			]]>
            </when>
        </choose>
		</if>
    	<if test='searchKeyword != null and searchKeyword != ""'>
        <choose>
            <when test='searchCondition == "REPRT_SJ"'>
             	<![CDATA[ AND A.REPRT_SJ LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
            <when test='searchCondition == "USER_NM"'>
             	<![CDATA[ AND B.USER_NM LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
        </choose>
		</if>
        <choose>
            <when test='searchSttus == "0"'>
             	<![CDATA[ AND NVL(A.CONFM_DT, ' ') = ' '  ]]>
            </when>
            <when test='searchSttus == "1"'>
             	<![CDATA[ AND NVL(A.CONFM_DT, ' ') != ' '  	]]>
            </when>
        </choose>
        <choose>
            <when test='searchSe == "1"'>
             	<![CDATA[ AND A.REPRT_SE = '1' ]]>
            </when>
            <when test='searchSe == "2"'>
             	<![CDATA[ AND A.REPRT_SE = '2' ]]>
            </when>
        </choose>
		<![CDATA[
			 ORDER BY A.FRST_REGIST_PNTTM DESC
		]]>	
        /* 구현 Sql */
        <![CDATA[
                   ) ALL_LIST
                   )
             WHERE RNUM BETWEEN #{firstIndex} + 1 AND #{firstIndex} + #{recordPerPage}
        ]]>			
	</select>
	
	<!-- 주간/월간보고::목록조회 Count -->
	<select id="selectWikMnthngReprtListCnt" resultType="int" >
	 	<![CDATA[
			SELECT COUNT(A.REPRT_ID) as cnt
			  FROM COMTN_WIKMNTHNG_REPRT A
				   LEFT OUTER JOIN COMTN_EMPLYR_INFO B
						ON  A.WRTER_ID = B.ESNTL_ID
				   LEFT OUTER JOIN (SELECT CODE, CODE_NM
					    	   		  FROM COMTC_CMMN_DETAIL_CODE  	
					    	  		 WHERE CODE_ID = 'COM060') C
				       	ON A.REPRT_SE = C.CODE
			 WHERE (A.WRTER_ID = #{searchId} OR A.REPORTR_ID = #{searchId})
	 	]]>
	    <if test='searchDe != null and searchDe != ""'>
        <choose>
            <when test='searchDe == "0"'>
	 			<![CDATA[ AND A.REPORT_DE  BETWEEN #{searchBgnDe} AND #{searchEndDe}		]]>
            </when>
            <when test='searchDe == "1"'>
		 		<![CDATA[	
		 			AND (A.REPORT_BGNDE BETWEEN #{searchBgnDe} AND #{searchEndDe}		
		 			     OR	A.REPORT_ENDDE BETWEEN #{searchBgnDe} AND #{searchEndDe}	)
	 			]]>
            </when>
        </choose>
		</if>
    	<if test='searchKeyword != null and searchKeyword != ""'>
        <choose>
            <when test='searchCondition == "REPRT_SJ"'>
             	<![CDATA[ AND A.REPRT_SJ LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
            <when test='searchCondition == "USER_NM"'>
             	<![CDATA[ AND B.USER_NM LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
        </choose>
		</if>
        <choose>
            <when test='searchSttus == "0"'>
             	<![CDATA[ AND NVL(A.CONFM_DT, ' ') = ' '  ]]>
            </when>
            <when test='searchSttus == "1"'>
             	<![CDATA[ AND NVL(A.CONFM_DT, ' ') != ' '  	]]>
            </when>
        </choose>
        <choose>
            <when test='searchSe == "1"'>
             	<![CDATA[ AND A.REPRT_SE = '1' ]]>
            </when>
            <when test='searchSe == "2"'>
             	<![CDATA[ AND A.REPRT_SE = '2' ]]>
            </when>
        </choose>
	</select>
	
	<!-- 주간/월간보고::상세보기 -->
	<select id="selectWikMnthngReprt" resultType="wikMnthngReprtVO" >
	 	<![CDATA[
			SELECT A.REPRT_ID
				 , A.REPRT_SE
				 , A.REPRT_SJ
				 , A.REPORT_DE				AS "reprtDe"
				 , A.WRTER_ID
				 , B.USER_NM 				AS "wrterNm" 
				 , B.OFCPS_NM 				AS "wrterClsfNm" 
				 , A.REPORTR_ID
				 , C.USER_NM 				AS "reportrNm" 
				 , C.OFCPS_NM 				AS "reportrClsfNm"
				 , A.REPORT_BGNDE			AS "reprtBgnDe" 
				 , A.REPORT_ENDDE			AS "reprtEndDe" 
				 , A.THSWIK_REPORT_CN		AS "reprtThswikCn" 
				 , A.NEXTWIK_REPORT_CN		AS "reprtLesseeCn" 
				 , A.PARTCLR_MATTER
				 , A.ATCH_FILE_ID
				 , A.CONFM_DT
				 , A.FRST_REGIST_PNTTM		AS "frstRegisterPnttm" 
				 , A.FRST_REGISTER_ID
				 , A.LAST_UPDT_PNTTM		AS "lastUpdusrPnttm" 
				 , A.LAST_UPDUSR_ID 
			  FROM COMTN_WIKMNTHNG_REPRT A
				   LEFT OUTER JOIN COMTN_EMPLYR_INFO B
						ON A.WRTER_ID = B.ESNTL_ID
				   LEFT OUTER JOIN COMTN_EMPLYR_INFO C
						ON A.REPORTR_ID = C.ESNTL_ID
			 WHERE A.REPRT_ID = #{reprtId}
	 	]]>
	</select>
	
	<!-- 주간/월간보고::입력  -->
	<insert id="insertWikMnthngReprt" >
	 	<![CDATA[
			INSERT INTO COMTN_WIKMNTHNG_REPRT ( 
					REPRT_ID
				  ,	REPRT_SE
				  ,	REPRT_SJ
				  ,	REPORT_DE
				  ,	WRTER_ID
				  ,	REPORTR_ID
				  ,	REPORT_BGNDE
				  ,	REPORT_ENDDE
				  ,	THSWIK_REPORT_CN
				  ,	NEXTWIK_REPORT_CN
				  ,	PARTCLR_MATTER
				  ,	ATCH_FILE_ID
				  ,	CONFM_DT
				  , FRST_REGISTER_ID 
				  , FRST_REGIST_PNTTM 
				  , LAST_UPDUSR_ID
				  , LAST_UPDT_PNTTM 
			)VALUES( 
					#{reprtId}
				  ,	#{reprtSe}
				  ,	#{reprtSj}
				  ,	#{reprtDe}
				  ,	#{wrterId}
				  ,	#{reportrId}
				  ,	#{reprtBgnDe}
				  ,	#{reprtEndDe}
				  ,	#{reprtThswikCn}
				  ,	#{reprtLesseeCn}
				  ,	#{partclrMatter}
				  ,	#{atchFileId, jdbcType=VARCHAR}
				  ,	''
				  , #{frstRegisterId}
				  , SYSDATE
				  , #{frstRegisterId} 
				  , SYSDATE
			)
	 	]]>
	</insert>

	<!-- 주간/월간보고::수정  -->
	<update id="updateWikMnthngReprt" > 
	 	<![CDATA[
			UPDATE COMTN_WIKMNTHNG_REPRT 
			   SET REPRT_SE				= #{reprtSe}
			     , REPRT_SJ				= #{reprtSj}
			     , REPORT_DE			= #{reprtDe}
			     , WRTER_ID				= #{wrterId}
			     , REPORTR_ID			= #{reportrId}
			     , REPORT_BGNDE			= #{reprtBgnDe}
			     , REPORT_ENDDE			= #{reprtEndDe}
			     , THSWIK_REPORT_CN		= #{reprtThswikCn}
			     , NEXTWIK_REPORT_CN	= #{reprtLesseeCn}
			     , PARTCLR_MATTER		= #{partclrMatter}
			     , ATCH_FILE_ID			= #{atchFileId, jdbcType=VARCHAR}
			     , LAST_UPDUSR_ID 		= #{lastUpdusrId}
			     , LAST_UPDT_PNTTM = SYSDATE
			 WHERE REPRT_ID = #{reprtId}
	 	]]>
	</update>
	
	<!-- 주간/월간보고::승인  -->
	<update id="confirmWikMnthngReprt" > 
	 	<![CDATA[
			UPDATE COMTN_WIKMNTHNG_REPRT 
			   SET CONFM_DT = #{confmDt}
			 WHERE REPRT_ID = #{reprtId}
	 	]]>
	</update>
	
	<!-- 주간/월간보고::삭제  -->
	<delete id="deleteWikMnthngReprt" > 
		<![CDATA[
			DELETE 
			  FROM COMTN_WIKMNTHNG_REPRT 
			 WHERE REPRT_ID = #{reprtId}
		]]>
	</delete>
	
</mapper>