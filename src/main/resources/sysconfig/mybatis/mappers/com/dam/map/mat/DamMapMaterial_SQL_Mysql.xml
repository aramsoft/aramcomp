<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="aramframework.com.dam.map.mat.dao.MapMaterialMapper">

	<select id="selectMapMaterialList" resultType="egovMap" >
        /* 구현 Sql */
		<![CDATA[
			SELECT B.ORGNZT_NM				AS "orgnztNm"
				 , A.KNWLDG_TY_CODE			AS "knoTypeCd"
			     , A.KNWLDG_TY_NM			AS "knoTypeNm"		     
                 , A.CL_DE					AS "clYmd"
			     , A.KNWLDG_URL				AS "knoUrl"
			  FROM COMTN_DAM_MAP_KNO A
				   LEFT OUTER JOIN COMTN_DAM_MAP_TEAM B
						ON A.ORGNZT_ID = B.ORGNZT_ID
			 WHERE 1=1
		]]>
    	<if test='searchVO.searchKeyword != null and searchVO.searchKeyword != ""'>
        <choose>
            <when test='searchVO.searchCondition == "ORGNZT_NM"'>
                 <![CDATA[ AND B.ORGNZT_NM LIKE '%'|| #{searchVO.searchKeyword} ||'%' ]]>
            </when>
            <when test='searchVO.searchCondition == "KNWLDG_TY_NM"'>
                 <![CDATA[ AND A.KNWLDG_TY_NM LIKE '%'|| #{searchVO.searchKeyword} ||'%' ]]>
            </when>
            <when test='searchVO.searchCondition == "ORGNZT_ID"'>
                 <![CDATA[ AND A.ORGNZT_ID = #{searchVO.searchKeyword} ]]>
            </when>
        </choose>
		</if>
        /* 구현 Sql */
        <![CDATA[
 			LIMIT  #{searchVO.recordPerPage} OFFSET #{searchVO.firstIndex}
        ]]>			
	</select>

	<select id="selectMapMaterialListCnt" resultType="java.lang.Integer">
		<![CDATA[
			SELECT COUNT(*) as totcnt 
			  FROM COMTN_DAM_MAP_KNO A
				   LEFT OUTER JOIN COMTN_DAM_MAP_TEAM B
						ON A.ORGNZT_ID = B.ORGNZT_ID
			 WHERE 1=1
		]]>
    	<if test='searchVO.searchKeyword != null and searchVO.searchKeyword != ""'>
        <choose>
            <when test='searchVO.searchCondition == "ORGNZT_NM"'>
                 <![CDATA[ AND B.ORGNZT_NM LIKE '%'|| #{searchVO.searchKeyword} ||'%' ]]>
            </when>
            <when test='searchVO.searchCondition == "KNWLDG_TY_NM"'>
                 <![CDATA[ AND A.KNWLDG_TY_NM LIKE '%'|| #{searchVO.searchKeyword} ||'%' ]]>
            </when>
            <when test='searchVO.searchCondition == "ORGNZT_ID"'>
                 <![CDATA[ AND A.ORGNZT_ID = #{searchVO.searchKeyword} ]]>
            </when>
        </choose>
		</if>
	</select>

	<select id="selectMapMaterial" resultType="mapMaterialVO">
		<![CDATA[
            SELECT A.KNWLDG_TY_CODE				AS "knoTypeCd"
				 , A.ORGNZT_ID					AS "orgnztId"
				 , B.ORGNZT_NM					AS "orgnztNm"
			     , A.EXPERT_ID					AS "speId"
			     , A.KNWLDG_TY_NM				AS "knoTypeNm"
                 , A.CL_DE						AS "clYmd"
                 , A.KNWLDG_URL					AS "knoUrl"
			     , A.FRST_REGISTER_ID			AS "frstRegisterId"
			     , A.FRST_REGIST_PNTTM			AS "frstRegisterPnttm"
			     , A.LAST_UPDUSR_ID				AS "lastUpdusrId"
			     , A.LAST_UPDT_PNTTM			AS "lastUpdusrPnttm"
			  FROM COMTN_DAM_MAP_KNO A
				   LEFT OUTER JOIN COMTN_DAM_MAP_TEAM B
						ON A.ORGNZT_ID = B.ORGNZT_ID
			 WHERE A.KNWLDG_TY_CODE = #{knoTypeCd}
		]]>
	</select>

	<insert id="insertMapMaterial">
		<![CDATA[
		    INSERT INTO COMTN_DAM_MAP_KNO ( 
		      	   KNWLDG_TY_CODE
		         , ORGNZT_ID
		         , EXPERT_ID
		         , KNWLDG_TY_NM
		         , CL_DE
		         , KNWLDG_URL
				 , FRST_REGISTER_ID 
				 , FRST_REGIST_PNTTM 
				 , LAST_UPDUSR_ID
				 , LAST_UPDT_PNTTM 
		    ) VALUES ( 
		    	   #{knoTypeCd}
		         , #{orgnztId}
		         , #{speId}
		         , #{knoTypeNm}	         		         
		         , #{clYmd}
		         , #{knoUrl}
				 , #{frstRegisterId}
				 , sysdate()
				 , #{frstRegisterId} 
				 , sysdate()
		    ) 
		]]>
	</insert>

	<update id="updateMapMaterial">
		<![CDATA[
            UPDATE COMTN_DAM_MAP_KNO 
               SET ORGNZT_ID         	= #{orgnztId}
                 , EXPERT_ID        	= #{speId}
                 , KNWLDG_TY_NM		  	= #{knoTypeNm}
                 , CL_DE  		  		= #{clYmd}
                 , KNWLDG_URL           = #{knoUrl}               
                 , LAST_UPDUSR_ID    	= #{lastUpdusrId}                 
                 , LAST_UPDT_PNTTM 		= sysdate()
             WHERE KNWLDG_TY_CODE       = #{knoTypeCd} 
		]]>
	</update>

	<delete id="deleteMapMaterial">
		<![CDATA[
            DELETE 
              FROM COMTN_DAM_MAP_KNO 
             WHERE KNWLDG_TY_CODE = #{knoTypeCd}
		]]>
	</delete>

</mapper>
          