<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="aramframework.com.sts.rst.dao.ReprtStatsMapper">

    <select id="selectReprtStatsList" resultType="reprtStatsVO">
        /* 구현 Sql */
        <![CDATA[
            SELECT REPRT_TY
                 , (SELECT CODE_NM 
                 	  FROM COMTC_CMMN_DETAIL_CODE
                     WHERE CODE_ID = 'COM040'
                       AND CODE = REPRT_TY
                   ) 						AS "reprtTyNm"
                 , REPRT_STTUS
                 , (SELECT CODE_NM 
                 	  FROM COMTC_CMMN_DETAIL_CODE
                     WHERE CODE_ID = 'COM036'
                       AND CODE = REPRT_STTUS
                   ) 						AS "reprtSttusNm"
                 , COUNT(*) AS CNT
              FROM COMTN_REPRT_STATS
             WHERE 1 = 1
        ]]>
       		<if test='pmReprtTy != null and pmReprtTy != "00"'>
	             <![CDATA[ AND REPRT_TY = #{pmReprtTy} ]]>
			</if>
        	<if test='pmFromDate != null and pmFromDate != ""'>
         		<if test='pmToDate != null and pmToDate != ""'>
                     AND DATE_FORMAT(FRST_REGIST_PNTTM, '%Y%m%d') BETWEEN #{pmFromDate} AND #{pmToDate}
              	</if>
  			</if>
        <![CDATA[
             GROUP BY REPRT_TY
                    , REPRT_STTUS
             ORDER BY REPRT_TY
                    , REPRT_STTUS
        ]]>
        /* 구현 Sql */
        <![CDATA[
 			LIMIT  #{searchVO.recordPerPage} OFFSET #{searchVO.firstIndex}
        ]]>			
    </select>

    <select id="selectReprtStatsListCnt" resultType="int">
            SELECT COUNT(*) totcnt
              FROM (SELECT REPRT_TY
                         , REPRT_STTUS
                      FROM COMTN_REPRT_STATS
                     WHERE 1 = 1
        		<if test='pmReprtTy != null and pmReprtTy != "00"'>
	             <![CDATA[ AND REPRT_TY = #{pmReprtTy} ]]>
				</if>
	        	<if test='pmFromDate != null and pmFromDate != ""'>
	         		<if test='pmToDate != null and pmToDate != ""'>
	                     AND DATE_FORMAT(FRST_REGIST_PNTTM, '%Y%m%d') BETWEEN #{pmFromDate} AND #{pmToDate}
	              	</if>
	  			</if>
                     GROUP BY REPRT_TY
                            , REPRT_STTUS) A
    </select>

     <select id="selectReprtStatsBarList" resultType="reprtStatsVO">
        <![CDATA[
            SELECT
        ]]>
	        <choose>
		        <when test='pmDateTy != null and pmDateTy != ""'>
		 	        <choose>
				        <when test='pmDateTy == "%Y"'>
	               			DATE_FORMAT(FRST_REGIST_PNTTM, '%Y') 		AS "grpRegDate"
			            </when>
				        <when test='pmDateTy == "%Y-%m"'>
	               			DATE_FORMAT(FRST_REGIST_PNTTM, '%Y%m') 	AS "grpRegDate"
		            	</when>
				        <when test='pmDateTy == "%Y-%m-%d"'>
	               			DATE_FORMAT(FRST_REGIST_PNTTM, '%Y%m%d') 	AS "grpRegDate"
		        		</when>
		    		</choose>
	       		</when>	
	        	<otherwise>
       		   		DATE_FORMAT(A.FRST_REGIST_PNTTM, '%Y') 		AS "grpRegDate"
 	        	</otherwise>
	        </choose>
 
         <![CDATA[
                 , COUNT(*) 			AS "grpCnt" 
              FROM COMTN_REPRT_STATS
             WHERE 1 = 1
        ]]>
      		<if test='pmReprtTy != null and pmReprtTy != "00"'>
             <![CDATA[ AND REPRT_TY = #{pmReprtTy} ]]>
			</if>
        	<if test='pmFromDate != null and pmFromDate != ""'>
         		<if test='pmToDate != null and pmToDate != ""'>
                     AND DATE_FORMAT(FRST_REGIST_PNTTM, '%Y%m%d') BETWEEN #{pmFromDate} AND #{pmToDate}
              	</if>
  			</if>

	        <choose>
		        <when test='pmDateTy != null and pmDateTy != ""'>
		 	        <choose>
				        <when test='pmDateTy == "%Y"'>
			               GROUP BY DATE_FORMAT(FRST_REGIST_PNTTM, '%Y')
			            </when>
				        <when test='pmDateTy == "%Y-%m"'>
			               GROUP BY DATE_FORMAT(FRST_REGIST_PNTTM, '%Y%m')
		            	</when>
				        <when test='pmDateTy == "%Y-%m-%d"'>
			               GROUP BY DATE_FORMAT(FRST_REGIST_PNTTM, '%Y%m%d')
		        		</when>
		    		</choose>
	       		</when>	
	        	<otherwise>
	        		   GROUP BY DATE_FORMAT(FRST_REGIST_PNTTM, '%Y')
	        	</otherwise>
	        </choose>
         <![CDATA[
             ORDER BY "grpRegDate" DESC
        ]]>
    </select>

    <select id="selectReprtStatsListBarListCnt" resultType="int">
            SELECT COUNT(*) totcnt
              FROM COMTN_REPRT_STATS
             WHERE 1 = 1
       		<if test='pmReprtTy != null and pmReprtTy != "00"'>
             <![CDATA[ AND REPRT_TY = #{pmReprtTy} ]]>
			</if>
        	<if test='pmFromDate != null and pmFromDate != ""'>
         		<if test='pmToDate != null and pmToDate != ""'>
                     AND DATE_FORMAT(FRST_REGIST_PNTTM, '%Y%m%d') BETWEEN #{pmFromDate} AND #{pmToDate}
              	</if>
  			</if>
    </select>

     <select id="selectReprtStatsByReprtTyList" resultType="reprtStatsVO">
            SELECT REPRT_TY					AS "grpReprtTy"  
                 , (SELECT CODE_NM 
                      FROM COMTC_CMMN_DETAIL_CODE
                     WHERE CODE_ID = 'COM040'
                       AND CODE = REPRT_TY) AS "grpReprtTyNm" 
                 , COUNT(*) 				AS "grpReprtTyCnt"	
              FROM COMTN_REPRT_STATS
             WHERE 1 = 1
       		<if test='pmReprtTy != null and pmReprtTy != "00"'>
             <![CDATA[ AND REPRT_TY = #{pmReprtTy} ]]>
			</if>
        	<if test='pmFromDate != null and pmFromDate != ""'>
         		<if test='pmToDate != null and pmToDate != ""'>
                     AND DATE_FORMAT(FRST_REGIST_PNTTM, '%Y%m%d') BETWEEN #{pmFromDate} AND #{pmToDate}
              	</if>
  			</if>
             GROUP BY REPRT_TY
             ORDER BY "grpReprtTy" 
    </select>

    <select id="selectReprtStatsByReprtSttusList" resultType="reprtStatsVO">
            SELECT REPRT_STTUS					AS "grpReprtSttus"
                 , (SELECT CODE_NM 
                      FROM COMTC_CMMN_DETAIL_CODE
                     WHERE CODE_ID = 'COM036'
                       AND CODE = REPRT_STTUS) 	AS "grpReprtSttusNm"
                 , COUNT(*) 					AS "grpReprtSttusCnt"
              FROM COMTN_REPRT_STATS
             WHERE 1 = 1
        	<if test='pmReprtTy != null and pmReprtTy != "00"'>
             <![CDATA[ AND REPRT_TY = #{pmReprtTy} ]]>
			</if>
        	<if test='pmFromDate != null and pmFromDate != ""'>
         		<if test='pmToDate != null and pmToDate != ""'>
                     AND DATE_FORMAT(FRST_REGIST_PNTTM, '%Y%m%d') BETWEEN #{pmFromDate} AND #{pmToDate}
              	</if>
  			</if>
             GROUP BY REPRT_STTUS
             ORDER BY "grpReprtSttus"
    </select>
 
    <select id="selectReprtStats" resultType="reprtStatsVO">
            SELECT REPRT_ID
                 , REPRT_NM
                 , REPRT_TY
                 , (SELECT CODE_NM 
                      FROM COMTC_CMMN_DETAIL_CODE
                     WHERE CODE_ID = 'COM040'
                       AND CODE = REPRT_TY
                   ) 						AS "reprtTyNm"
                 , REPRT_STTUS
                 , (SELECT CODE_NM 
                      FROM COMTC_CMMN_DETAIL_CODE
                     WHERE CODE_ID = 'COM036'
                       AND CODE = REPRT_STTUS
                   ) 						AS "reprtSttusNm"
                 , FRST_REGISTER_ID			AS "userId" 
                 , FRST_REGIST_PNTTM		AS "regDate"
              FROM COMTN_REPRT_STATS
             WHERE 1 = 1
               AND REPRT_TY = #{reprtTy}
               AND REPRT_STTUS = #{reprtSttus}
        	<if test='pmFromDate != null and pmFromDate != ""'>
         		<if test='pmToDate != null and pmToDate != ""'>
                     AND DATE_FORMAT(FRST_REGIST_PNTTM, '%Y%m%d') BETWEEN #{pmFromDate} AND #{pmToDate}
              	</if>
  			</if>
    </select>

    <insert id="insertReprtStats" >
            INSERT INTO COMTN_REPRT_STATS (
        			REPRT_ID
        		  , REPRT_NM
        		  , REPRT_TY
        		  , REPRT_STTUS
        		  , FRST_REGISTER_ID
        		  , FRST_REGIST_PNTTM
        		  , LAST_UPDUSR_ID
        		  , LAST_UPDT_PNTTM
            ) VALUES (
        			#{reprtId}
        		  , #{reprtNm}
        		  , #{reprtTy}
        		  , #{reprtSttus}
        		  , #{userId}
        		  , sysdate()
        		  , #{userId}
        		  , sysdate()
            )
    </insert>

    <update id="updateReprtStats" >
            UPDATE COMTN_REPRT_STATS
               SET REPRT_NM 		= #{reprtNm}
                 , REPRT_TY 		= #{reprtTy}
                 , REPRT_STTUS 		= #{reprtSttus}
                 , LAST_UPDUSR_ID 	= #{userId}
                 , LAST_UPDT_PNTTM 	= sysdate()
             WHERE REPRT_ID = #{reprtId}
    </update>

    <delete id="deleteReprtStats" >
        <![CDATA[
            DELETE 
              FROM COMTN_REPRT_STATS
             WHERE REPRT_ID = #{reprtId}
        ]]>
    </delete>

</mapper>