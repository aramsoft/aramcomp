<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="aramframework.com.sym.mnu.mcm.dao.MenuCreateMapper">
	
	<select id="selectMenuCreateList" resultType="egovMap">
		<![CDATA[
            SELECT *
              FROM (
            SELECT ROWNUM RNUM, ALL_LIST.*
              FROM (
        ]]>
        /* 구현 Sql */
		<![CDATA[
            SELECT AUTHOR_CODE   			AS "authorCode"
                 , AUTHOR_NM     			AS "authorNm"
                 , AUTHOR_DC     			AS "authorDc"
                 , AUTHOR_CREAT_DE 			AS "authorCreatDe"
                 , (SELECT COUNT(B.AUTHOR_CODE)
			          FROM COMTN_MENU_CREAT_DTLS B
			         WHERE B.AUTHOR_CODE = A.AUTHOR_CODE 
			       ) 						AS "chkYeoBu"
			  FROM COMTN_AUTHOR_INFO A
			 WHERE A.AUTHOR_CODE like '%'||#{searchKeyword}||'%'
        ]]>
        /* 구현 Sql */
        <![CDATA[
                   ) ALL_LIST
                   )
             WHERE RNUM BETWEEN #{firstIndex} + 1 AND #{firstIndex} + #{recordPerPage}
        ]]>			
	</select> 

	<select id="selectMenuCreateListCnt" resultType="int">
		<![CDATA[
			SELECT COUNT(AUTHOR_CODE) AS "totcnt"
			  FROM COMTN_AUTHOR_INFO A
			 WHERE A.AUTHOR_CODE like '%'||#{searchKeyword}||'%'
		]]>
	</select>

	<select id="selectMenuCreateDetailList" resultType="egovMap">
		<![CDATA[
		   SELECT A.MENU_NO 				AS "menuNo"
				, A.MENU_ORDR 				AS "menuOrdr"
				, A.MENU_NM 				AS "menuNm"
				, A.UPPER_MENU_NO 			AS "upperMenuId"
			    , (SELECT count(B.MENU_NO) 
			         FROM COMTN_MENU_CREAT_DTLS B   
			        WHERE B.MENU_NO  = A.MENU_NO 
			          AND B.AUTHOR_CODE = #{authorCode}
			      ) 						AS "chkYeoBu"
			 FROM COMTN_MENU_INFO A
			WHERE A.MENU_NO > 0
			ORDER BY A.MENU_ORDR
		 ]]>
	</select> 

	<select id="selectMenuCreateCnt" resultType="int">
		<![CDATA[
			SELECT COUNT(AUTHOR_CODE) AS "totcnt"
			  FROM COMTN_AUTHOR_INFO
			 WHERE AUTHOR_CODE = #{authorCode}
		]]>
	</select>

	<insert id="insertMenuCreate">
		<![CDATA[
			INSERT INTO COMTN_MENU_CREAT_DTLS ( 
					AUTHOR_CODE 
				  ,	MENU_NO 
			) VALUES ( 
					#{authorCode}
				  ,	#{menuNo} 
			)
		]]>
	</insert>

	<delete id="updateMenuCreate">
		<![CDATA[ 
		    UPDATE COMTN_MENU_CREAT_DTLS  
		       SET MAPNG_CREAT_ID = #{mapCreatId} 
		     WHERE AUTHOR_CODE    = #{authorCode}
		]]>                                
	</delete> 

	<delete id="deleteMenuCreate">
		<![CDATA[                          
			DELETE 
			  FROM COMTN_MENU_CREAT_DTLS              
			 WHERE AUTHOR_CODE = #{authorCode}                
		]]>                                
	</delete> 

	<select id="selectUsrByPk" resultType="int">
		<![CDATA[
			SELECT COUNT(AUTHOR_CODE) 
			  FROM COMTN_EMPLYR_SCRTY_ESTBS
			 WHERE SCRTY_DTRMN_TRGET_ID = (SELECT ESNTL_ID 
			 								 FROM COMVN_USER_MASTER
											WHERE USER_ID = #{searchKeyword} )
		]]>
	</select>

	<select id="selectAuthorByUsr" resultType="menuCreateVO">
		<![CDATA[
			SELECT AUTHOR_CODE AS "authorCode" 
			  FROM COMTN_EMPLYR_SCRTY_ESTBS
			 WHERE SCRTY_DTRMN_TRGET_ID = ( SELECT ESNTL_ID 
				     						  FROM COMVN_USER_MASTER
				    					 	 WHERE USER_ID = #{searchKeyword} )
		]]>
	</select>

</mapper>                            