<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="aramframework.com.sym.sym.srv.dao.ServerMapper">

    <select id="selectServerEqpmnList" resultType="egovMap">
        /* 구현 Sql */
        <![CDATA[ 
            SELECT SERVER_EQPMN_ID			AS "serverEqpmnId"
                 , SERVER_EQPMN_NM			AS "serverEqpmnNm"
                 , SERVER_EQPMN_IP			AS "serverEqpmnIp"
                 , SERVER_EQPMN_MNGR		AS "serverEqpmnMngrNm"
                 , RGSDE					AS "regstYmd"
              FROM COMTN_SERVER_EQPMN_INFO
             WHERE 1 = 1
        ]]>                               
   	    <if test='strServerEqpmnNm != null and strServerEqpmnNm != ""'>
				<![CDATA[ AND SERVER_EQPMN_NM LIKE '%'||#{strServerEqpmnNm}||'%' ]]>
		</if>
        <![CDATA[                    
             ORDER BY SERVER_EQPMN_ID
        ]]>             
        /* 구현 Sql */
        <![CDATA[
 			LIMIT  #{recordPerPage} OFFSET #{firstIndex}
        ]]>			
    </select>

    <select id="selectServerEqpmnListCnt" resultType="int">
        <![CDATA[ 
            SELECT COUNT(*) totcnt
              FROM COMTN_SERVER_EQPMN_INFO
             WHERE 1 = 1
        ]]>			
   	    <if test='strServerEqpmnNm != null and strServerEqpmnNm != ""'>
				<![CDATA[ AND SERVER_EQPMN_NM LIKE '%'||#{strServerEqpmnNm}||'%' ]]>
		</if>
    </select>
    
    <select id="selectServerEqpmn" resultType="serverEqpmnVO">
        <![CDATA[
            SELECT SERVER_EQPMN_ID
                 , SERVER_EQPMN_NM
                 , SERVER_EQPMN_IP
                 , SERVER_EQPMN_MNGR		AS "serverEqpmnMngrNm"
                 , MNGR_EMAIL_ADRES			AS "mngrEmailAddr"
                 , OPERSYSM_INFO
                 , CPU_INFO
                 , MORY_INFO
                 , HDDISK					AS "hdDisk"
                 , ETC_INFO
                 , RGSDE					AS "regstYmd"					
                 , FRST_REGIST_PNTTM 		AS "frstRegisterPnttm"
                 , FRST_REGISTER_ID
                 , LAST_UPDT_PNTTM 			AS "lastUpdusrPnttm"
                 , LAST_UPDUSR_ID
              FROM COMTN_SERVER_EQPMN_INFO
             WHERE 1 = 1
               AND SERVER_EQPMN_ID = #{serverEqpmnId}
        ]]>
    </select>

    <insert id="insertServerEqpmn" >
        <![CDATA[
             INSERT INTO COMTN_SERVER_EQPMN_INFO (
             		SERVER_EQPMN_ID
             	  , SERVER_EQPMN_NM
             	  , SERVER_EQPMN_IP
             	  , SERVER_EQPMN_MNGR
             	  , MNGR_EMAIL_ADRES
             	  , OPERSYSM_INFO
             	  , CPU_INFO
             	  , MORY_INFO
             	  , HDDISK
             	  , ETC_INFO
             	  , RGSDE
				  , FRST_REGISTER_ID 
				  , FRST_REGIST_PNTTM 
				  , LAST_UPDUSR_ID
				  , LAST_UPDT_PNTTM 
              ) VALUES (
             		#{serverEqpmnId}
             	  , #{serverEqpmnNm}
             	  , #{serverEqpmnIp}
             	  , #{serverEqpmnMngrNm}
             	  , #{mngrEmailAddr}
             	  , #{opersysmInfo}
             	  , #{cpuInfo}
             	  , #{moryInfo}
             	  , #{hdDisk}
             	  , #{etcInfo}
             	  , #{regstYmd}
				  , #{frstRegisterId}
				  , sysdate()
				  , #{frstRegisterId} 
				  , sysdate()
             )
        ]]>
    </insert>     

    <update id="updateServerEqpmn" >
        <![CDATA[
            UPDATE COMTN_SERVER_EQPMN_INFO
               SET SERVER_EQPMN_NM 		= #{serverEqpmnNm}
                 , SERVER_EQPMN_IP 		= #{serverEqpmnIp}
                 , SERVER_EQPMN_MNGR 	= #{serverEqpmnMngrNm}
                 , MNGR_EMAIL_ADRES 	= #{mngrEmailAddr}
                 , OPERSYSM_INFO 		= #{opersysmInfo}
                 , CPU_INFO 			= #{cpuInfo}
                 , MORY_INFO 			= #{moryInfo}
                 , HDDISK 				= #{hdDisk}
                 , ETC_INFO 			= #{etcInfo}
                 , RGSDE 				= #{regstYmd}
                 , LAST_UPDUSR_ID 		= #{lastUpdusrId}  
                 , LAST_UPDT_PNTTM 		= sysdate()
             WHERE SERVER_EQPMN_ID = #{serverEqpmnId}
        ]]>
    </update>    
    
    <delete id="deleteServerEqpmn" >
        <![CDATA[
            DELETE 
              FROM COMTN_SERVER_EQPMN_INFO
             WHERE SERVER_EQPMN_ID = #{serverEqpmnId}
        ]]>
    </delete>
    
    <select id="selectServerList" resultType="egovMap">
        /* 구현 Sql */
        <![CDATA[ 
            SELECT SERVER_ID				AS "serverId" 
                 , SERVER_NM				AS "serverNm" 
                 , (SELECT CD.CODE_NM 
                      FROM COMTC_CMMN_DETAIL_CODE CD
                     WHERE CD.CODE_ID = 'COM064' 
                       AND SERVER_KND = CD.CODE
                   ) 						AS "serverKndNm" 
                 , RGSDE					AS "regstYmd" 
              FROM COMTN_SERVER_INFO
             WHERE 1 = 1
        ]]>               
      	<if test='strServerNm != null and strServerNm != ""'>
			<![CDATA[ AND SERVER_NM LIKE '%'||#{strServerNm}||'%' ]]>
		</if>
        <![CDATA[   
             ORDER BY SERVER_ID
        ]]>             
        /* 구현 Sql */
        <![CDATA[
 			LIMIT  #{recordPerPage} OFFSET #{firstIndex}
        ]]>			
    </select>

    <select id="selectServerListCnt" resultType="int">
        <![CDATA[ 
            SELECT COUNT(*) totcnt
              FROM COMTN_SERVER_INFO
             WHERE 1 = 1
        ]]>             
      	<if test='strServerNm != null and strServerNm != ""'>
			<![CDATA[ AND SERVER_NM LIKE '%'||#{strServerNm}||'%' ]]>
		</if>
    </select>
    
    <select id="selectServer" resultType="serverVO">
        <![CDATA[
            SELECT SERVER_ID
                 , SERVER_NM
                 , SERVER_KND
                 , (SELECT CD.CODE_NM 
                      FROM COMTC_CMMN_DETAIL_CODE CD
                     WHERE CD.CODE_ID = 'COM064' 
                       AND SERVER_KND = CD.CODE
                   ) 						AS "serverKndNm"
                 , RGSDE					AS "regstYmd"
                 , FRST_REGIST_PNTTM		AS "frstRegisterPnttm"
                 , FRST_REGISTER_ID
                 , LAST_UPDT_PNTTM 			AS "lastUpdusrPnttm" 
                 , LAST_UPDUSR_ID
              FROM COMTN_SERVER_INFO
             WHERE 1 = 1
               AND SERVER_ID = #{serverId}
        ]]>
    </select>

    <insert id="insertServer" >
        <![CDATA[
             INSERT INTO COMTN_SERVER_INFO (
             		SERVER_ID
             	  , SERVER_NM
             	  , SERVER_KND
             	  , RGSDE
				  , FRST_REGISTER_ID 
				  , FRST_REGIST_PNTTM 
				  , LAST_UPDUSR_ID
				  , LAST_UPDT_PNTTM 
             ) VALUES (
             		#{serverId}
             	  , #{serverNm}
             	  , #{serverKnd}
             	  , #{regstYmd}
				  , #{frstRegisterId}
				  , sysdate()
				  , #{frstRegisterId} 
				  , sysdate()
             )
        ]]>
    </insert>     

    <update id="updateServer" >
        <![CDATA[
            UPDATE COMTN_SERVER_INFO
               SET SERVER_NM 		= #{serverNm}
                 , SERVER_KND 		= #{serverKnd}
                 , RGSDE 			= #{regstYmd}
                 , LAST_UPDUSR_ID 	= #{lastUpdusrId}  
                 , LAST_UPDT_PNTTM 	= sysdate()
             WHERE SERVER_ID = #{serverId}
        ]]>
    </update>

    <delete id="deleteServer" >
        <![CDATA[
            DELETE 
              FROM COMTN_SERVER_INFO
             WHERE SERVER_ID = #{serverId}
        ]]>
    </delete>   

    <select id="selectServerEqpmnRelateDetail" resultType="egovMap">
        <![CDATA[
            SELECT B.SERVER_EQPMN_ID   	AS "serverEqpmnId"
                 , B.SERVER_EQPMN_NM   	AS "serverEqpmnNm"
                 , B.SERVER_EQPMN_IP   	AS "serverEqpmnIp"
                 , B.SERVER_EQPMN_MNGR 	AS "serverEqpmnMngrNm"
                 , B.OPERSYSM_INFO     	AS "opersysmInfo"
                 , B.CPU_INFO          	AS "cpuInfo"
                 , B.MORY_INFO         	AS "moryInfo"
                 , B.HDDISK            	AS "hdDisk"
                 , B.ETC_INFO          	AS "etcInfo"
              FROM COMTN_SERVER_EQPMN_RELATE A
			   	   INNER JOIN COMTN_SERVER_EQPMN_INFO B
			   		     ON A.SERVER_EQPMN_ID = B.SERVER_EQPMN_ID
             WHERE A.SERVER_ID = #{serverId}
        ]]>
    </select>

    <select id="selectServerEqpmnRelateDetailTotCnt" resultType="int">
        <![CDATA[
            SELECT COUNT(*) totcnt
              FROM COMTN_SERVER_EQPMN_RELATE A
			   	   INNER JOIN COMTN_SERVER_EQPMN_INFO B
			   		     ON A.SERVER_EQPMN_ID = B.SERVER_EQPMN_ID
             WHERE A.SERVER_ID = #{serverId}
        ]]>
    </select> 

    <select id="selectServerEqpmnRelateList" resultType="egovMap">
        /* 구현 Sql */
        <![CDATA[ 
            SELECT A.SERVER_EQPMN_ID   		AS "serverEqpmnId"
                 , A.SERVER_EQPMN_NM   		AS "serverEqpmnNm"
                 , A.SERVER_EQPMN_IP   		AS "serverEqpmnIp"
                 , A.SERVER_EQPMN_MNGR 		AS "serverEqpmnMngrNm"
                 , CASE 
                      WHEN B.SERVER_EQPMN_ID IS NOT NULL THEN 'Y'
                      ELSE 'N' 
                   END 						AS "regYn"
              FROM COMTN_SERVER_EQPMN_INFO A
                   LEFT OUTER JOIN (SELECT SERVER_EQPMN_ID 
                                      FROM COMTN_SERVER_EQPMN_RELATE 
                                     WHERE SERVER_ID = #{serverId}) B
                 		ON A.SERVER_EQPMN_ID = B.SERVER_EQPMN_ID
        ]]>             
        /* 구현 Sql */
        <![CDATA[
 			LIMIT  #{recordPerPage} OFFSET #{firstIndex}
        ]]>			
    </select>

    <select id="selectServerEqpmnRelateListCnt" resultType="int">
        <![CDATA[ 
             SELECT COUNT(*) totcnt
               FROM COMTN_SERVER_EQPMN_INFO A
                    LEFT OUTER JOIN (SELECT SERVER_EQPMN_ID
                     				   FROM COMTN_SERVER_EQPMN_RELATE 
                     				  WHERE SERVER_ID = #{serverId}) B
                 		ON A.SERVER_EQPMN_ID = B.SERVER_EQPMN_ID 
        ]]>			
    </select>
    
    <insert id="insertServerEqpmnRelate" >
        <![CDATA[
             INSERT INTO COMTN_SERVER_EQPMN_RELATE (
             		SERVER_ID
             	  , SERVER_EQPMN_ID
             	  , LAST_UPDUSR_ID
             	  , LAST_UPDT_PNTTM
             ) VALUES (
             		#{serverId}
             	  , #{serverEqpmnId}
             	  , #{lastUpdusrId}
             	  , sysdate()
             )
        ]]>
    </insert>     

    <delete id="deleteServerEqpmnRelate" >
        <![CDATA[
            DELETE 
              FROM COMTN_SERVER_EQPMN_RELATE
             WHERE SERVER_ID = #{serverId}
               AND SERVER_EQPMN_ID = #{serverEqpmnId}
        ]]>
    </delete>     

</mapper>