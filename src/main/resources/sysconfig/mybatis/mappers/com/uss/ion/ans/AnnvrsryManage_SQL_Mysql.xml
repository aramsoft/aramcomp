<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="aramframework.com.uss.ion.ans.service.AnnvrsryManageMapper">

   <select id="selectAnnvrsryManageList" resultType="egovMap">
        <![CDATA[
           	SELECT A.* 
              FROM (
            SELECT ANNVRSRY_ID         	as "annId"             
                 , ANNVRSRY_NM          as "annvrsryNm"        
                 , ANNVRSRY          	as "annvrsryDe"        
                 , CLDR_SE              as "cldrSe"            
                 , ANNVRSRY_NTCN_SETUP  as "annvrsrySetup"     
                 , ANNVRSRY_NTCN_BGNDE  as "annvrsryBeginDe"   
                 , MEMO                 as "memo"              
                 , REPTIT_AT            as "reptitSe"          
              FROM COMTN_ANNVRSRY_MANAGE  
             WHERE REPTIT_AT IS NULL
               AND ANNVRSRY like  '%'||#{searchKeyword}||'%'
                  AND USER_ID = #{usid}
	         union all
            SELECT ANNVRSRY_ID          as "annId"             
                 , ANNVRSRY_NM          as "annvrsryNm"        
                 , ANNVRSRY          	as "annvrsryDe"        
                 , CLDR_SE              as "cldrSe"            
                 , ANNVRSRY_NTCN_SETUP  as "annvrsrySetup"     
                 , ANNVRSRY_NTCN_BGNDE  as "annvrsryBeginDe"   
                 , MEMO                 as "memo"              
                 , REPTIT_AT            as "reptitSe"          
              FROM COMTN_ANNVRSRY_MANAGE  
             WHERE REPTIT_AT = '1'
               AND USER_ID = #{usid}
                   ) A
             ORDER BY A.annvrsryDe DESC
			 LIMIT #{recordPerPage} OFFSET #{firstIndex}
        ]]>
    </select>
    
    <select id="selectAnnvrsryManageListCnt"  resultType="int">
        <![CDATA[
           	SELECT COUNT(*) totcnt
           	  FROM (SELECT *
	            	  FROM COMTN_ANNVRSRY_MANAGE
	            	 WHERE ANNVRSRY like  '%'||#{searchKeyword}||'%'
					   AND USER_ID = #{usid}
		             union all
	            	SELECT *
	            	  FROM COMTN_ANNVRSRY_MANAGE
	            	 WHERE REPTIT_AT = '1'
	            	   AND USER_ID = #{usid}) a
       ]]>
    </select>

    <select id="selectAnnvrsryManage" resultType="annvrsryManageVO">
        <![CDATA[
			SELECT ANNVRSRY_ID 			as "annId"           
			     , B.USER_ID 			as "usid"              
			     , ANNVRSRY_SE 			as "annvrsrySe" 
			     , ANNVRSRY_NM 			as "annvrsryNm" 
			     , ANNVRSRY 			as "annvrsryDe" 
			     , CLDR_SE  			as "cldrSe"         
			     , ANNVRSRY_NTCN_SETUP 	as "annvrsrySetup"   
			     , ANNVRSRY_NTCN_BGNDE 	as "annvrsryBeginDe"
			     , MEMO   				as "memo"          
			     , REPTIT_AT            as "reptitSe"          
			     , FRST_REGISTER_ID  	as "frstRegisterId"
			     , FRST_REGIST_PNTTM  	as "frstRegisterPnttm"
			     , LAST_UPDUSR_ID  		as "lastUpdusrId"  
			     , LAST_UPDT_PNTTM  	as "lastUpdusrPnttm"
			     , B.user_nm 			AS "usNm"
			     , (select info.ORGNZT_NM 
			          from COMTN_ORGNZT_INFO info 
			         where info.ORGNZT_ID = B.ORGNZT_ID 
			       )  						AS "orgnztNm"
			     , (select code_nm 
			          from COMTC_CMMN_DETAIL_CODE 
			         where code_id ='COM069'
			           and code = A.ANNVRSRY_SE
			       ) 						as "annvrsrySeNm"
			  FROM COMTN_ANNVRSRY_MANAGE A
				   LEFT OUTER JOIN COMVN_USER_MASTER B
			   		    ON A.USER_ID = B.esntl_id
			 WHERE A.ANNVRSRY_ID = #{annId}
        ]]>
    </select>

    <insert id="insertAnnvrsryManage" >
        <![CDATA[
            INSERT INTO COMTN_ANNVRSRY_MANAGE (
            		ANNVRSRY_ID             
            	  , USER_ID               
            	  , ANNVRSRY_SE        
            	  , ANNVRSRY_NM        
            	  , ANNVRSRY        
            	  , CLDR_SE            
            	  , ANNVRSRY_NTCN_SETUP     
            	  , ANNVRSRY_NTCN_BGNDE  
            	  , MEMO               
            	  , REPTIT_AT          
				  , FRST_REGISTER_ID 
				  , FRST_REGIST_PNTTM 
				  , LAST_UPDUSR_ID
				  , LAST_UPDT_PNTTM 
            ) VALUES (
            		#{annId}
            	  , #{usid} 
            	  , #{annvrsrySe}
            	  , #{annvrsryNm}
            	  , #{annvrsryDe}
            	  , #{cldrSe}
            	  , #{annvrsrySetup}
            	  , #{annvrsryBeginDe}
            	  , #{memo}
            	  , #{reptitSe, jdbcType=VARCHAR}
				  , #{frstRegisterId}
				  , sysdate()
				  , #{frstRegisterId} 
				  , sysdate()
             ) 
        ]]>
    </insert>     

    <update id="updateAnnvrsryManage" >
        <![CDATA[
            UPDATE COMTN_ANNVRSRY_MANAGE
               SET ANNVRSRY_NM     		= #{annvrsryNm}     
                 , ANNVRSRY_SE     		= #{annvrsrySe}      
                 , ANNVRSRY        		= #{annvrsryDe}      
                 , CLDR_SE            	= #{cldrSe}          
                 , ANNVRSRY_NTCN_SETUP 	= #{annvrsrySetup}   
                 , ANNVRSRY_NTCN_BGNDE  = #{annvrsryBeginDe} 
                 , MEMO               	= #{memo}            
                 , REPTIT_AT          	= #{reptitSe, jdbcType=VARCHAR}        
                 , LAST_UPDUSR_ID     	= #{lastUpdusrId}    
                 , LAST_UPDT_PNTTM  	= sysdate()    
             WHERE ANNVRSRY_ID          = #{annId}
        ]]>
    </update>    
    
    <delete id="deleteAnnvrsryManage" >
        <![CDATA[
            DELETE 
              FROM COMTN_ANNVRSRY_MANAGE
             WHERE ANNVRSRY_ID         = #{annId} 
        ]]>
    </delete>  
 
    <select id="selectAnnvrsryManageDplctAt" resultType="int">
        <![CDATA[
            SELECT COUNT(*) totcnt
              FROM COMTN_ANNVRSRY_MANAGE
             WHERE USER_ID         	= #{usid}
			   AND ANNVRSRY_SE  	= #{annvrsrySe}
			   AND ANNVRSRY  		= #{annvrsryDe}
			   AND ANNVRSRY_NM  	= #{annvrsryNm}
			   AND CLDR_SE       	= #{cldrSe} 
        ]]>
    </select>
 
    <select id="selectAnnvrsryGdcc" resultType="egovMap">
        <![CDATA[
			SELECT ANNVRSRY_ID 			as "annId"           
				 , USER_ID 				as "usid"              
				 , ANNVRSRY_NM 			as "annvrsryNm" 
				 , ANNVRSRY 			as "annvrsryDe" 
				 , CLDR_SE 				as "cldrSe" 
			  FROM COMTN_ANNVRSRY_MANAGE ans
			 where USER_ID = #{usid}
        ]]>
    </select>

<!-- 엑셀일괄 등록 처리  -->
    <select id="selectAnnvrsryManageBnde" resultType="annvrsryManageVO">
        <![CDATA[
		   select A.ESNTL_ID 	as "usid" 
		   	    , A.USER_NM 	as "usNm" 
		   	    , (select info.ORGNZT_NM 
		   	         from COMTN_ORGNZT_INFO info 
		   	        where  info.ORGNZT_ID = A.ORGNZT_ID 
		   	      )  			AS "orgnztNm"
		   	    , (select code_nm 
		   	         from COMTC_CMMN_DETAIL_CODE 
		   	        where code_id ='COM069' 
		   	          and code = #{annvrsrySe}
		   	     ) 				as "annvrsrySeNm"
		    from COMVN_USER_MASTER A
		   WHERE USER_ID   = #{usid}
	 	   LIMIT 1 
       ]]>
    </select>

</mapper>