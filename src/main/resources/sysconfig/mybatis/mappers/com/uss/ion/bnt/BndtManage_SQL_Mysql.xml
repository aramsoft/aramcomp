<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="aramframework.com.uss.ion.bnt.service.BndtManageMapper">

    <select id="selectBndtManageList" resultType="bndtManageVO">
        <![CDATA[
		   SELECT manage.BNDT_ID 		as "bndtId" 
		        , manage.BNDT_DE 		as "bndtDe" 
		        , (select user_nm 
		             from COMVN_USER_MASTER
                       where esntl_id = manage.BNDT_ID 
                     ) 					AS "bndtUserNm"
                   , (select count(diary.BNDT_ID) 
                        from COMTN_BNDT_DIARY diary
			        where diary.BNDT_ID = manage.BNDT_ID
			          and diary.BNDT_DE = manage.BNDT_DE
			      ) 					AS "bndtDiaryCnt"
		     FROM COMTN_BNDT_MANAGE manage
		    WHERE SUBSTR(BNDT_DE, 1, 6) like  '%'||#{bndtDe}||'%'
			ORDER BY FRST_REGIST_PNTTM DESC
        ]]>
    </select>
    
    <select id="selectBndtManage" resultType="bndtManageVO">
        <![CDATA[
		    SELECT BNDT_ID 				as "bndtId" 
		         , BNDT_DE 				as "bndtDe" 
		         , RM  					as "remark" 
		         , FRST_REGISTER_ID  	as "frstRegisterId"
		         , FRST_REGIST_PNTTM 	as "frstRegisterPnttm"
		         , LAST_UPDUSR_ID  		as "lastUpdusrId"  
		         , LAST_UPDT_PNTTM  		as "lastUpdusrPnttm"
		         , mst.user_nm   		AS "bndtUserNm"
		         , (select org.orgnzt_nm 
		              from COMTN_ORGNZT_INFO org 
		             where org.orgnzt_ID = mst.orgnzt_ID
		           ) 					AS "bndtOrgnztNm"
			  FROM COMTN_BNDT_MANAGE ans
				   LEFT OUTER JOIN COMVN_USER_MASTER mst
			   		    ON ans.BNDT_ID = mst.ESNTL_ID
		 	 WHERE BNDT_ID   = #{bndtId}
			   AND BNDT_DE   = #{bndtDe}
        ]]>
    </select>

    <insert id="insertBndtManage" >
        <![CDATA[
            INSERT INTO COMTN_BNDT_MANAGE (
            		BNDT_ID               
            	  , BNDT_DE        
            	  , RM        
				  , FRST_REGISTER_ID 
				  , FRST_REGIST_PNTTM 
				  , LAST_UPDUSR_ID
				  , LAST_UPDT_PNTTM 
            ) VALUES (
            		#{bndtId} 
            	  , #{bndtDe}
            	  , #{remark}
				  , #{frstRegisterId}
				  , sysdate()
				  , #{frstRegisterId}
				  , sysdate()
            ) 
        ]]>
    </insert>     

    <update id="updtBndtManage" >
        <![CDATA[
             UPDATE COMTN_BNDT_MANAGE
                SET RM             		= #{remark}          
                  , LAST_UPDUSR_ID     	= #{lastUpdusrId}    
                  , LAST_UPDT_PNTTM  	= sysdate()    
              WHERE BNDT_DE            	= #{bndtDe}
                AND BNDT_ID            	= #{bndtId}
        ]]>
    </update>    
    
    <delete id="deleteBndtManage" >
        <![CDATA[
             DELETE 
               FROM COMTN_BNDT_MANAGE
              WHERE BNDT_DE            = #{bndtDe}
                AND BNDT_ID            = #{bndtId}
        ]]>
    </delete>  

    <select id="selectBndtDiaryTotCnt" resultType="int">
        <![CDATA[
             SELECT count(*) 
               FROM COMTN_BNDT_DIARY
              WHERE BNDT_DE = #{bndtDe}
                AND BNDT_ID = #{bndtId}
        ]]>
    </select>
 
<!-- 당직체크관리 -->

   <select id="selectBndtCeckManageList"  resultType="egovMap">
        /* 구현 Sql */
       <![CDATA[
			SELECT BNDT_CECK_SE        		AS "bndtCeckSe"       
				 , BNDT_CECK_CODE       	AS "bndtCeckCd"       
				 , BNDT_CECK_CODE_NM    	AS "bndtCeckCdNm"     
				 , USE_AT              		AS "useAt"            
				 , (select code_nm 
				      from COMTC_CMMN_DETAIL_CODE
				     where code_id ='COM071'
				       and code = BNDT_CECK_SE
				   ) 						as "bndtCeckSeNm"
 			  FROM COMTN_BNDT_CECK_MANAGE 
			 WHERE 1=1
        ]]>
    	<if test='searchBndtCeckSe != null and searchBndtCeckSe != ""'>
           		<![CDATA[ AND BNDT_CECK_SE like  '%'||#{searchBndtCeckSe}||'%'  ]]>
		</if>
     	<if test='searchUseAt != null and searchUseAt != ""'>
           		<![CDATA[ AND USE_AT like  '%'||#{searchUseAt}||'%'  ]]>
		</if>
     	<if test='searchKeyword != null and searchKeyword != ""'>
           		<![CDATA[ AND BNDT_CECK_CODE_NM like  '%'||#{searchKeyword}||'%'  ]]>
		</if>
        <![CDATA[ 
        	 ORDER BY FRST_REGIST_PNTTM DESC
		]]>				
        /* 구현 Sql */
        <![CDATA[
 			LIMIT  #{recordPerPage} OFFSET #{firstIndex}
        ]]>			
    </select>

    <select id="selectBndtCeckManageListCnt" resultType="int">
        <![CDATA[
            SELECT COUNT(*) totcnt
              FROM COMTN_BNDT_CECK_MANAGE
             WHERE 1=1
        ]]>
    	<if test='searchBndtCeckSe != null and searchBndtCeckSe != ""'>
           		<![CDATA[ AND BNDT_CECK_SE like  '%'||#{searchBndtCeckSe}||'%'  ]]>
		</if>
     	<if test='searchUseAt != null and searchUseAt != ""'>
           		<![CDATA[ AND USE_AT like  '%'||#{searchUseAt}||'%'  ]]>
		</if>
     	<if test='searchKeyword != null and searchKeyword != ""'>
           		<![CDATA[ AND BNDT_CECK_CODE_NM like  '%'||#{searchKeyword}||'%'  ]]>
		</if>
    </select>
    
    <select id="selectBndtCeckManage" resultType="bndtCeckManageVO">
        <![CDATA[
			SELECT BNDT_CECK_SE        		AS "bndtCeckSe"       
			     , BNDT_CECK_CODE       	AS "bndtCeckCd"       
			     , BNDT_CECK_CODE_NM    	AS "bndtCeckCdNm"     
			     , USE_AT              		AS "useAt"            
			     , FRST_REGISTER_ID    		AS "frstRegisterId"   
			     , FRST_REGIST_PNTTM 		AS "frstRegisterPnttm" 
			     , LAST_UPDUSR_ID      		AS "lastUpdusrId"     
			     , LAST_UPDT_PNTTM   		AS "lastUpdusrPnttm"  
			     , (select code_nm 
			          from COMTC_CMMN_DETAIL_CODE
				     where code_id ='COM071'
				       and code = BNDT_CECK_SE
				   ) 						as "bndtCeckSeNm"
		 	  FROM COMTN_BNDT_CECK_MANAGE 
		  	 WHERE BNDT_CECK_SE       	= #{bndtCeckSe}
               AND BNDT_CECK_CODE       = #{bndtCeckCd}
        ]]>
    </select>

    <insert id="insertBndtCeckManage" >
        <![CDATA[
            INSERT INTO COMTN_BNDT_CECK_MANAGE (
            		BNDT_CECK_SE       
            	  , BNDT_CECK_CODE       
            	  , BNDT_CECK_CODE_NM    
            	  , USE_AT             
				  , FRST_REGISTER_ID 
				  , FRST_REGIST_PNTTM 
				  , LAST_UPDUSR_ID
				  , LAST_UPDT_PNTTM 
            ) VALUES (
            		#{bndtCeckSe}    
            	  , #{bndtCeckCd}    
            	  , #{bndtCeckCdNm}  
            	  , #{useAt}         
				  , #{frstRegisterId}
				  , sysdate()
				  , #{frstRegisterId}
				  , sysdate()
            )
        ]]>
    </insert>     

    <update id="updtBndtCeckManage" >
        <![CDATA[
             UPDATE COMTN_BNDT_CECK_MANAGE
                SET BNDT_CECK_CODE_NM   = #{bndtCeckCdNm} 
                  , USE_AT             	= #{useAt}        
                  , LAST_UPDUSR_ID     	= #{lastUpdusrId} 
                  , LAST_UPDT_PNTTM  	= sysdate()
              WHERE BNDT_CECK_SE       	= #{bndtCeckSe}
                AND BNDT_CECK_CODE      = #{bndtCeckCd}
   
        ]]>
    </update>    
    
    <delete id="deleteBndtCeckManage" >
        <![CDATA[
             DELETE 
               FROM COMTN_BNDT_CECK_MANAGE
              WHERE BNDT_CECK_SE    = #{bndtCeckSe}
                AND BNDT_CECK_CODE 	= #{bndtCeckCd}
			   
        ]]>
    </delete> 

    <select id="selectBndtCeckManageDplctAt" resultType="int">
        <![CDATA[
            SELECT COUNT(*) totcnt
              FROM COMTN_BNDT_CECK_MANAGE
             WHERE BNDT_CECK_SE 	= #{bndtCeckSe}
               AND BNDT_CECK_CODE 	= #{bndtCeckCd}
        ]]>
    </select>
    
<!-- 당직일지 -->
    <select id="selectBndtDiary" resultType="bndtDiaryVO">
        <![CDATA[
			 Select diary.BNDT_ID        	AS bndtId      
			      , diary.BNDT_DE        	AS bndtDe      
			      , ceck.BNDT_CECK_SE    	AS bndtCeckSe  
			      , ceck.BNDT_CECK_CODE  	AS bndtCeckCd  
			      , ceck.BNDT_CECK_CODE_NM 	AS bndtCeckCdNm
			      , diary.CHCK_STTUS     	AS chckSttus    
			   FROM COMTN_BNDT_CECK_MANAGE  ceck
                    LEFT OUTER JOIN (SELECT BNDT_ID, BNDT_DE, CHCK_STTUS 
                     				   FROM COMTN_BNDT_DIARY
                     				  WHERE BNDT_ID   = #{bndtId}
										AND BNDT_DE   = #{bndtDe} ) diary
                 		ON  diary.BNDT_CECK_SE   = ceck.BNDT_CECK_SE 
			        	AND diary.BNDT_CECK_CODE = ceck.BNDT_CECK_CODE
			  WHERE USE_AT = 'Y'
			  ORDER BY ceck.BNDT_CECK_SE, ceck.BNDT_CECK_CODE
        ]]>
    </select>

    <insert id="insertBndtDiary" >
        <![CDATA[
            INSERT INTO COMTN_BNDT_DIARY (
            		BNDT_ID            
            	  , BNDT_DE            
            	  , BNDT_CECK_SE       
            	  , BNDT_CECK_CODE       
            	  , CHCK_STTUS         
				  , FRST_REGISTER_ID 
				  , FRST_REGIST_PNTTM 
				  , LAST_UPDUSR_ID
				  , LAST_UPDT_PNTTM 
            ) VALUES (
            		#{bndtId}        
            	  , #{bndtDe}        
            	  , #{bndtCeckSe}    
            	  , #{bndtCeckCd}    
            	  , #{chckSttus}     
				  , #{frstRegisterId}
				  , sysdate()
				  , #{frstRegisterId} 
				  , sysdate()
            )
        ]]>
    </insert>     

    <update id="updtBndtDiary" >
        <![CDATA[
             UPDATE COMTN_BNDT_DIARY
                SET CHCK_STTUS         	= #{chckSttus}      
                  , LAST_UPDUSR_ID     	= #{lastUpdusrId}   
                  , LAST_UPDT_PNTTM  	= sysdate()    
              WHERE BNDT_DE            	= #{bndtDe}
                AND BNDT_ID            	= #{bndtId}
                AND BNDT_CECK_SE       	= #{bndtCeckSe}
                AND BNDT_CECK_CODE      = #{bndtCeckCd}
        ]]>
    </update>    
    
    <delete id="deleteBndtDiary" >
        <![CDATA[
             DELETE 
               FROM COMTN_BNDT_DIARY
              WHERE BNDT_DE            = #{bndtDe}
                AND BNDT_ID            = #{bndtId}
		   
        ]]>
    </delete>  

<!-- 엑셀일괄 등록 처리  -->

    <select id="selectBndtManageBnde" resultType="bndtManageVO">
        <![CDATA[
			select A.ESNTL_ID 		as bndtId 
			     , A.USER_NM 		as tempBndtNm 
			     , (select info.ORGNZT_NM 
			          from COMTN_ORGNZT_INFO info 
			         where info.ORGNZT_ID = A.ORGNZT_ID 
			       )  				AS tempOrgnztNm,
			       (select count(user_nm) 
			          from COMVN_USER_MASTER 
			         where user_nm = A.USER_NM
			       ) 				AS tempCount
			  from COMVN_USER_MASTER A
			 WHERE USER_ID   = #{tempBndtId}
			   AND USER_NM   = #{tempBndtNm}
	 	     LIMIT 1 
        ]]>
    </select>

    <select id="selectBndtManageMonthCnt" resultType="int">
        <![CDATA[
             SELECT count(BNDT_ID) 
               FROM COMTN_BNDT_MANAGE
              WHERE BNDT_DE like  '%'||#{searchKeyword}||'%'
        ]]>
    </select>
    
</mapper>