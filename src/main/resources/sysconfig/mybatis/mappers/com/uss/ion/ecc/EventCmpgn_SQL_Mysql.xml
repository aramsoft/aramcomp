<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="aramframework.com.uss.ion.ecc.dao.EventCmpgnMapper">

	<select id="selectEventCmpgnList" resultType="egovMap" >
        /* 구현 Sql */
       	<![CDATA[
			SELECT A.EVENT_ID				AS "eventId"
				 , A.EVENT_CN				AS "eventCn"
				 , A.EVENT_SVC_BGNDE	    AS "eventSvcBeginDe" 
				 , A.EVENT_SVC_ENDDE        AS "eventSvcEndDe" 
				 , A.FRST_REGIST_PNTTM		AS "frstRegisterPnttm"
				 , (SELECT USER_NM 
				      FROM COMTN_EMPLYR_INFO 
				     WHERE ESNTL_ID = A.FRST_REGISTER_ID
				   ) 						AS "frstRegisterNm" 
				 , A.EVENT_TY_CODE			AS "eventTyCode"
		      FROM COMTN_EVENT_INFO A
		     WHERE 1=1
	 	]]>
    	<if test='searchKeyword != null and searchKeyword != ""'>
        <choose>
            <when test='searchCondition == "EVENT_CN"'>
               	<![CDATA[ AND EVENT_CN LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
            <when test='searchCondition == "FRST_REGISTER_ID"'>
	 		   	<![CDATA[ 
	 		   		AND FRST_REGISTER_ID IN (SELECT ESNTL_ID 
	 		                              	   FROM COMTN_EMPLYR_INFO 
	 		                             	  WHERE USER_NM LIKE '%' || #{searchKeyword} || '%' )
 				]]>
            </when>
        </choose>
		</if>
	 	<![CDATA[
		     ORDER BY A.FRST_REGIST_PNTTM DESC
		]]>				
        /* 구현 Sql */
        <![CDATA[
 			LIMIT  #{recordPerPage} OFFSET #{firstIndex}
        ]]>			
	</select>

	<select id="selectEventCmpgnListCnt" resultType="int">
	 	<![CDATA[
			SELECT COUNT(*) totcnt
			  FROM COMTN_EVENT_INFO
			 WHERE 1=1
        ]]>			
    	<if test='searchKeyword != null and searchKeyword != ""'>
        <choose>
            <when test='searchCondition == "EVENT_CN"'>
               	<![CDATA[ AND EVENT_CN LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
            <when test='searchCondition == "FRST_REGISTER_ID"'>
	 		   	<![CDATA[ 
	 		   		AND FRST_REGISTER_ID IN (SELECT ESNTL_ID 
	 		                              	   FROM COMTN_EMPLYR_INFO 
	 		                             	  WHERE USER_NM LIKE '%' || #{searchKeyword} || '%' )
 				]]>
            </when>
        </choose>
		</if>
	</select>

	<select id="selectEventCmpgnDetail" resultType="eventCmpgnVO">
	 	<![CDATA[
			SELECT EVENT_ID
			     , EVENT_SVC_BGNDE		AS "eventSvcBeginDe"
			     , SVC_USE_NMPR_CO
			     , CHARGER_NM
			     , EVENT_CN
			     , EVENT_CONFM_AT
			     , EVENT_CONFM_DE
			     , FRST_REGIST_PNTTM	AS "frstRegisterPnttm"
			     , FRST_REGISTER_ID
			     , LAST_UPDT_PNTTM		AS "lastUpdusrPnttm"
			     , LAST_UPDUSR_ID
			     , EVENT_SVC_ENDDE		AS "eventSvcEndDe"
			     , EVENT_TY_CODE
			     , PRPARETG_CN
			  FROM COMTN_EVENT_INFO
		     WHERE EVENT_ID = #{eventId}
        ]]>			
	</select>

	<insert id="insertEventCmpgn">
	 	<![CDATA[
			INSERT INTO COMTN_EVENT_INFO (
					EVENT_ID
				  ,	EVENT_SVC_BGNDE
				  ,	SVC_USE_NMPR_CO
				  ,	CHARGER_NM
				  ,	EVENT_CN
				  ,	EVENT_SVC_ENDDE
				  ,	EVENT_TY_CODE
				  ,	PRPARETG_CN
				  ,	EVENT_CONFM_AT
				  ,	EVENT_CONFM_DE
				  , FRST_REGISTER_ID 
				  , FRST_REGIST_PNTTM 
				  , LAST_UPDUSR_ID
				  , LAST_UPDT_PNTTM 
			)VALUES(
					#{eventId}
				  ,	#{eventSvcBeginDe}
				  ,	#{svcUseNmprCo}
				  ,	#{chargerNm}
				  ,	#{eventCn}
				  ,	#{eventSvcEndDe}
				  ,	#{eventTyCode}
				  , #{prparetgCn}
				  ,	#{eventConfmAt}
				  ,	#{eventConfmDe}
				  , #{frstRegisterId}
				  , sysdate()
				  , #{frstRegisterId} 
				  , sysdate()
			)
	 	]]>
	</insert>

	<update id="updateEventCmpgn">
	 	<![CDATA[
			UPDATE COMTN_EVENT_INFO
			   SET EVENT_SVC_BGNDE	= #{eventSvcBeginDe}
			     , SVC_USE_NMPR_CO	= #{svcUseNmprCo}
			     , CHARGER_NM		= #{chargerNm}
			     , EVENT_CN			= #{eventCn}
			     , EVENT_SVC_ENDDE	= #{eventSvcEndDe}
			     , EVENT_TY_CODE	= #{eventTyCode}
			     , EVENT_CONFM_AT	= #{eventConfmAt}
			     , EVENT_CONFM_DE	= #{eventConfmDe}
			     , PRPARETG_CN		= #{prparetgCn}
			     , LAST_UPDUSR_ID	= #{lastUpdusrId}
			     , LAST_UPDT_PNTTM	= sysdate()
			 WHERE EVENT_ID = #{eventId}
	 	]]>
	</update>

	<delete id="deleteEventCmpgn">
		<![CDATA[
			DELETE 
			  FROM COMTN_EVENT_INFO
			 WHERE EVENT_ID = #{eventId}
		]]>
	</delete>

	<select id="selectTnextrlHrInfoList" resultType="egovMap">
        /* 구현 Sql */
       	<![CDATA[
			SELECT A.EXTRL_HR_ID			AS "extrlHrId"
			     , A.EXTRL_HR_NM			AS "extrlHrNm"
			     , A.SEXDSTN_CODE			AS "sexdstnCode"
			     , A.PSITN_INSTT_NM			AS "psitnInsttNm"
			     , A.FRST_REGIST_PNTTM		AS "frstRegisterPnttm" 
			     , (SELECT USER_NM 
			          FROM COMTN_EMPLYR_INFO 
			         WHERE ESNTL_ID = A.FRST_REGISTER_ID
			       ) 						AS "frstRegisterNm" 
		      FROM COMTN_EXTRL_HR_INFO A
		     WHERE 1=1
	 	]]>
    	<if test='searchKeyword != null and searchKeyword != ""'>
	    <choose>
	        <when test='searchCondition == "EXTRL_HR_NM"'>
	        	<![CDATA[ AND EXTRL_HR_NM LIKE '%'|| #{searchKeyword} ||'%' ]]>
	        </when>
	        <when test='searchCondition == "PSITN_INSTT_NM"'>
	            <![CDATA[ AND PSITN_INSTT_NM LIKE '%'|| #{searchKeyword} ||'%' ]]>
	        </when>
	    </choose>
		</if>
	 	<![CDATA[
		     ORDER BY A.FRST_REGIST_PNTTM DESC
		]]>				
        /* 구현 Sql */
        <![CDATA[
 			LIMIT  #{recordPerPage} OFFSET #{firstIndex}
        ]]>			
	</select>

	<select id="selectTnextrlHrInfoListCnt" resultType="int">
        <![CDATA[
			SELECT COUNT(*) totcnt
			  FROM COMTN_EXTRL_HR_INFO
			 WHERE 1=1
        ]]>			
    	<if test='searchKeyword != null and searchKeyword != ""'>
	    <choose>
	        <when test='searchCondition == "EXTRL_HR_NM"'>
	        	<![CDATA[ AND EXTRL_HR_NM LIKE '%'|| #{searchKeyword} ||'%' ]]>
	        </when>
	        <when test='searchCondition == "PSITN_INSTT_NM"'>
	            <![CDATA[ AND PSITN_INSTT_NM LIKE '%'|| #{searchKeyword} ||'%' ]]>
	        </when>
	    </choose>
		</if>
	</select>

	<select id="selectTnextrlHrInfoDetail" resultType="tnextrlHrInfoVO">
        <![CDATA[
			SELECT A.EXTRL_HR_ID
				 , A.EVENT_ID
				 , (SELECT EVENT_CN 
				 	  FROM COMTN_EVENT_INFO 
				 	 WHERE EVENT_ID=A.EVENT_ID 
				   ) 						AS "eventCn" 
				 , A.SEXDSTN_CODE
				 , A.EXTRL_HR_NM
				 , A.AREA_NO
				 , A.MIDDLE_TELNO
				 , A.END_TELNO
				 , A.EMAIL_ADRES
				 , A.FRST_REGIST_PNTTM		AS "frstRegisterPnttm"
				 , A.FRST_REGISTER_ID
				 , A.LAST_UPDT_PNTTM		AS "lastUpdusrPnttm"
				 , A.LAST_UPDUSR_ID
				 , A.OCCP_TY_CODE
				 , A.BRTHDY					AS "brth"
				 , A.PSITN_INSTT_NM
			  FROM COMTN_EXTRL_HR_INFO A
			 WHERE A.EXTRL_HR_ID = #{extrlHrId}
        ]]>			
	</select>

	<insert id="insertTnextrlHrInfo">
	 	<![CDATA[
			INSERT INTO COMTN_EXTRL_HR_INFO (
					EVENT_ID
				  , EXTRL_HR_ID
				  ,	SEXDSTN_CODE
				  ,	EXTRL_HR_NM
				  ,	AREA_NO
				  ,	MIDDLE_TELNO
				  ,	END_TELNO
				  ,	EMAIL_ADRES
				  ,	OCCP_TY_CODE
				  ,	BRTHDY
				  ,	PSITN_INSTT_NM
				  , FRST_REGISTER_ID 
				  , FRST_REGIST_PNTTM 
				  , LAST_UPDUSR_ID
				  , LAST_UPDT_PNTTM 
			)VALUES(
					#{eventId}
				  ,	#{extrlHrId}
				  ,	#{sexdstnCode}
				  ,	#{extrlHrNm}
				  ,	#{areaNo}
				  ,	#{middleTelno}
				  ,	#{endTelno}
				  ,	#{emailAdres}
				  ,	#{occpTyCode}
				  ,	#{brth}
				  ,	#{psitnInsttNm}
				  , #{frstRegisterId}
				  , sysdate()
				  , #{frstRegisterId} 
				  , sysdate()
			)
	 	]]>
	</insert>

	<update id="updateTnextrlHrInfo">
	 	<![CDATA[
			UPDATE COMTN_EXTRL_HR_INFO
			   SET SEXDSTN_CODE		= #{sexdstnCode}
			     , EXTRL_HR_NM		= #{extrlHrNm}
			     , AREA_NO			= #{areaNo}
			     , MIDDLE_TELNO		= #{middleTelno}
			     , END_TELNO		= #{endTelno}
			     , EMAIL_ADRES		= #{emailAdres}
			     , OCCP_TY_CODE		= #{occpTyCode}
			     , BRTHDY			= #{brth}
			     , PSITN_INSTT_NM	= #{psitnInsttNm}
			     , LAST_UPDUSR_ID 	= #{lastUpdusrId}
			     , LAST_UPDT_PNTTM 	= sysdate()
			 WHERE EXTRL_HR_ID = #{extrlHrId}
	 	]]>
	</update>

	<delete id="deleteTnextrlHrInfo">
		<![CDATA[
			DELETE 
			  FROM COMTN_EXTRL_HR_INFO
			 WHERE EXTRL_HR_ID = #{extrlHrId}
		]]>
	</delete>
	
	<delete id="deleteEventCmpgnTnextrlHrInfo">
		<![CDATA[
			DELETE 
			  FROM COMTN_EXTRL_HR_INFO
			 WHERE EVENT_ID = #{eventId}
		]]>
	</delete>

</mapper>