<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="aramframework.com.uss.ion.msi.dao.MainImageMapper">

    <select id="selectMainImageList" resultType="egovMap" >
		<![CDATA[
            SELECT *
              FROM (
            SELECT ROWNUM RNUM, ALL_LIST.*
              FROM (
        ]]>
        /* 구현 Sql */
       	<![CDATA[
            SELECT IMAGE_ID					AS "imageId"
                 , IMAGE_NM					AS "imageNm"
                 , IMAGE					AS "image"
                 , IMAGE_DC					AS "imageDc"
                 , REFLCT_AT				AS "reflctAt"
              FROM COMTN_MAIN_IMAGE
             WHERE 1=1
        ]]>
     	<if test='searchVO.searchKeyword != null and searchVO.searchKeyword != ""'>
        		<![CDATA[ AND IMAGE_NM LIKE '%'|| #{searchVO.searchKeyword} ||'%' ]]>
		</if>
        <![CDATA[
             ORDER BY FRST_REGIST_PNTTM DESC
		]]>				
        /* 구현 Sql */
        <![CDATA[
                   ) ALL_LIST
                   )
             WHERE RNUM BETWEEN #{searchVO.firstIndex} + 1 AND #{searchVO.firstIndex} + #{searchVO.recordPerPage}
        ]]>			
    </select>

    <select id="selectMainImageListCnt" resultType="int">
        <![CDATA[
            SELECT COUNT(*) totcnt
              FROM COMTN_MAIN_IMAGE
             WHERE 1=1
		]]>				
     	<if test='searchVO.searchKeyword != null and searchVO.searchKeyword != ""'>
        		<![CDATA[ AND IMAGE_NM LIKE '%'|| #{searchVO.searchKeyword} ||'%' ]]>
		</if>
    </select>

    <select id="selectMainImage" resultType="mainImageVO">
        <![CDATA[
            SELECT IMAGE_ID
                 , IMAGE_NM
                 , IMAGE
                 , IMAGE_FILE
                 , IMAGE_DC
                 , REFLCT_AT
                 , FRST_REGISTER_ID
                 , FRST_REGIST_PNTTM
              FROM COMTN_MAIN_IMAGE
             WHERE IMAGE_ID = #{imageId}
        ]]>
    </select>

    <insert id="insertMainImage" >
        <![CDATA[
            INSERT INTO COMTN_MAIN_IMAGE (
            		IMAGE_ID
            	  , IMAGE_NM
            	  , IMAGE
            	  , IMAGE_FILE
            	  , IMAGE_DC
            	  , REFLCT_AT
				  , FRST_REGISTER_ID 
				  , FRST_REGIST_PNTTM 
				  , LAST_UPDUSR_ID
				  , LAST_UPDT_PNTTM 
            ) VALUES (
           		#{imageId}
            	  , #{imageNm}
            	  , #{image}
            	  , #{imageFile}
            	  , #{imageDc}
            	  , #{reflctAt}
            	  , #{userId}
            	  , SYSDATE
            	  , #{userId}
            	  , SYSDATE
            )
        ]]>
    </insert>

    <update id="updateMainImage" >
        <![CDATA[
            UPDATE COMTN_MAIN_IMAGE
               SET IMAGE_NM 		= #{imageNm}
        ]]>
   	    	<if test='isAtchFile != null and isAtchFile == true'>
        <![CDATA[
                 , IMAGE 			= #{image}
                 , IMAGE_FILE 		= #{imageFile}
        ]]>
			</if>
        <![CDATA[
                 , IMAGE_DC 		= #{imageDc}
                 , REFLCT_AT 		= #{reflctAt}
                 , LAST_UPDUSR_ID 	= #{userId}
                 , LAST_UPDT_PNTTM = SYSDATE
             WHERE IMAGE_ID = #{imageId}
        ]]>
    </update>

    <delete id="deleteMainImage" >
        <![CDATA[
            DELETE 
              FROM COMTN_MAIN_IMAGE
             WHERE IMAGE_ID = #{imageId}
        ]]>
    </delete>

    <select id="selectMainImageResult" resultType="egovMap" >
        <![CDATA[
            SELECT IMAGE_FILE				AS "imageFile"
              FROM COMTN_MAIN_IMAGE
             WHERE REFLCT_AT = 'Y'
        ]]>
    </select>

    <select id="selectMainImageFile" resultType="fileVO">
        <![CDATA[
            SELECT B.FILE_STRE_COURS 		AS "fileStreCours"
                 , B.STRE_FILE_NM 			AS "streFileNm"
              FROM COMTN_MAIN_IMAGE A
                   INNER JOIN COMTN_FILE_DETAIL B
                 		 ON A.IMAGE_FILE = B.ATCH_FILE_ID
             WHERE IMAGE_ID = #{imageId}
        ]]>
    </select>

</mapper>