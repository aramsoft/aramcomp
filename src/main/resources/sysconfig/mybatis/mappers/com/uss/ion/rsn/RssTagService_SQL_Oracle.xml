<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="aramframework.com.uss.ion.rsn.service.impl.RssMapper">

	<!-- RSS서비스::목록조회 게시물정보 -->
	<select id="selectRssServiceList" resultType="egovMap">
		<![CDATA[
            SELECT *
              FROM (
            SELECT ROWNUM RNUM, ALL_LIST.*
              FROM (
        ]]>
        /* 구현 Sql */
       	<![CDATA[
			SELECT A.RSS_ID					AS "rssId"
			     , A.TRGET_SVC_NM			AS "trgetSvcNm"
			     , A.TRGET_SVC_TABLE		AS "trgetSvcTable"
			     , A.FRST_REGIST_PNTTM		AS "frstRegisterPnttm"
			     , (SELECT USER_NM 
			          FROM COMTN_EMPLYR_INFO 
			         WHERE ESNTL_ID = A.FRST_REGISTER_ID
			       ) 						AS "frstRegisterNm"
			  FROM COMTN_RSS A
			 WHERE 1=1
		]]>
 	    <if test='searchKeyword != null and searchKeyword != ""'>
        <choose>
            <when test='searchCondition == "TRGET_SVC_NM"'>
                <![CDATA[ AND A.TRGET_SVC_NM LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
            <when test='searchCondition == "TRGET_SVC_TABLE"'>
                <![CDATA[ AND A.TRGET_SVC_TABLE LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
        </choose>
		</if>
		<![CDATA[
			 ORDER BY A.FRST_REGIST_PNTTM DESC
		]]>				
        /* 구현 Sql */
        <![CDATA[
                   ) ALL_LIST
                   )
             WHERE RNUM BETWEEN #{firstIndex} + 1 AND #{firstIndex} + #{recordPerPage}
        ]]>			
	</select>
	
	<!-- RSS서비스::목록조회_게시물 총갯수  -->
	<select id="selectRssServiceListCnt" resultType="int">
		<![CDATA[
			SELECT COUNT(*) totcnt
			  FROM COMTN_RSS A
			 WHERE 1=1
        ]]>			
 	    <if test='searchKeyword != null and searchKeyword != ""'>
        <choose>
            <when test='searchCondition == "TRGET_SVC_NM"'>
                <![CDATA[ AND A.TRGET_SVC_NM LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
            <when test='searchCondition == "TRGET_SVC_TABLE"'>
                <![CDATA[ AND A.TRGET_SVC_TABLE LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
        </choose>
		</if>
	</select>
	
	<!-- RSS서비스::상세보기 -->
	<select id="selectRssServiceDetail" resultType="rssInfoVO">
		<![CDATA[
			SELECT RSS_ID
			     , TRGET_SVC_NM
			     , TRGET_SVC_TABLE
			     , TRGET_SVC_LIST_CO
			     , HDER_TITLE
			     , HDER_LINK
			     , HDER_DC 				AS "hderDescription"
			     , HDER_TAG
			     , HDER_ETC
			     , BDT_TITLE
			     , BDT_LINK
			     , BDT_DC 				AS "bdtDescription"
			     , BDT_TAG
			     , BDT_ETC_TAG 			AS "bdtEtc"
			     , FRST_REGIST_PNTTM 	AS "frstRegisterPnttm"
			     , FRST_REGISTER_ID
			     , LAST_UPDT_PNTTM 		AS "lastUpdusrPnttm"
			     , LAST_UPDUSR_ID
			  FROM COMTN_RSS
			 WHERE RSS_ID = #{rssId}
        ]]>			
	</select>

	<!-- RSS서비스::해당RSS서비스 조회 --> 
	<select id="selectRssServiceTable" resultType="java.util.HashMap" >
		<![CDATA[	
			SELECT *
			  FROM (SELECT * 
			          FROM ${trgetSvcTable}
			         ORDER BY FRST_REGIST_PNTTM DESC
				   ) 
			 WHERE ROWNUM <= ${trgetSvcListCo}
		]]>
	</select> 

</mapper>