<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="aramframework.com.uss.ion.rwd.dao.RwardManageMapper">

    <select id="selectRwardManageList"  resultType="egovMap">
		<![CDATA[
            SELECT *
              FROM (
            SELECT ROWNUM RNUM, ALL_LIST.*
              FROM (
        ]]>
        /* 구현 Sql */
       	<![CDATA[
            SELECT A.RWARD_ID            	AS "rwardId"          
                 , A.RWARD_DE            	AS "rwardDe"          
                 , A.RWARD_NM            	AS "rwardNm"          
                 , A.CONFM_AT            	AS "confmAt"          
                 , C.USER_NM             	AS "rwardManNm"       
                 , (select mst.USER_NM 
                      from COMVN_USER_MASTER mst 
                     where mst.ESNTL_ID = SANCTNER_ID
                   ) 						AS "sanctnerNm"  
                 , (select code_nm 
                      from COMTC_CMMN_DETAIL_CODE 
                     where code_id ='COM055' 
                       and code = A.RWARD_CODE
                   ) 						AS "rwardCdNm"   
                 , (select info.ORGNZT_NM 
                      from COMTN_ORGNZT_INFO info 
                     where info.ORGNZT_ID = C.ORGNZT_ID 
                   )  						AS "orgnztNm"
              FROM COMTN_RWARD_MANAGE A
				   LEFT OUTER JOIN COMVN_USER_MASTER C
				        ON A.RWARDWNR_ID = C.ESNTL_ID 
             WHERE 1=1 
        ]]>
     	<if test='searchVO.searchKeyword != null and searchVO.searchKeyword != ""'>
        		<![CDATA[ AND A.RWARD_CODE = #{searchVO.searchKeyword} ]]>
		</if>
    	<if test='searchFromDate != null and searchFromDate != ""'>
        		<![CDATA[ AND A.RWARD_DE BETWEEN #{searchFromDate} AND #{searchToDate} ]]>
		</if>
   	    <if test='searchNm != null and searchNm != ""'>
        		<![CDATA[ AND C.USER_NM like '%'||#{searchNm}||'%' ]]>
		</if>
        <![CDATA[
         	 ORDER BY FRST_REGIST_PNTTM DESC
		]]>				
        /* 구현 Sql */
        <![CDATA[
                   ) ALL_LIST
                   )
             WHERE RNUM BETWEEN #{searchVO.firstIndex} + 1 AND #{searchVO.firstIndex} + #{searchVO.recordPerPage}
        ]]>			
    </select> 

    <select id="selectRwardManageListCnt" resultType="int">
        <![CDATA[
            SELECT COUNT(*) totcnt
              FROM COMTN_RWARD_MANAGE A
				   LEFT OUTER JOIN COMVN_USER_MASTER C
				        ON A.RWARDWNR_ID = C.ESNTL_ID 
             WHERE 1=1 
        ]]>
     	<if test='searchVO.searchKeyword != null and searchVO.searchKeyword != ""'>
        		<![CDATA[ AND A.RWARD_CODE = #{searchVO.searchKeyword} ]]>
		</if>
    	<if test='searchFromDate != null and searchFromDate != ""'>
        		<![CDATA[ AND A.RWARD_DE BETWEEN #{searchFromDate} AND #{searchToDate} ]]>
		</if>
   	    <if test='searchNm != null and searchNm != ""'>
        		<![CDATA[ AND C.USER_NM like '%'||#{searchNm}||'%' ]]>
		</if>
    </select>

    <select id="selectRwardManage" resultType="rwardManageVO">
        <![CDATA[
            SELECT rwd.RWARD_ID            	AS "rwardId"          
                 , rwd.RWARDWNR_ID         	AS "rwardManId"       
                 , rwd.RWARD_CODE          	AS "rwardCd"          
                 , rwd.RWARD_DE            	AS "rwardDe"          
                 , rwd.RWARD_NM            	AS "rwardNm"          
                 , rwd.PBLEN_CN            	AS "pblenCn"          
                 , rwd.SANCTNER_ID         	AS "sanctnerId"       
                 , rwd.CONFM_AT            	AS "confmAt"          
                 , rwd.SANCTN_DT           	AS "sanctnDt"         
                 , rwd.RETURN_RESN         	AS "returnResn"       
                 , rwd.ATCH_FILE_ID        	AS "atchFileId"       
                 , rwd.INFRML_SANCTN_ID    	AS "infrmlSanctnId"   
                 , mst.USER_NM             	AS "rwardManNm"       
                 , (select info.ORGNZT_NM 
                      from COMTN_ORGNZT_INFO info 
                     where info.ORGNZT_ID = mst.ORGNZT_ID 
                   )   						AS "orgnztNm"    
                 , (select mst1.USER_NM 
                      from COMVN_USER_MASTER mst1 
                     where mst1.ESNTL_ID = SANCTNER_ID
                   )   						AS "sanctnerNm"  
                 , (select code_nm 
                      from COMTC_CMMN_DETAIL_CODE 
                     where code_id ='COM055' 
                       and code = rwd.RWARD_CODE
                   )  						AS "rwardCdNm"   
                 , (select info.ORGNZT_NM 
                      from COMVN_USER_MASTER mst_b
                         , COMTN_ORGNZT_INFO info 
                     where info.ORGNZT_ID = mst_b.ORGNZT_ID 
                       and mst_b.esntl_id= rwd.SANCTNER_ID
                   )  						AS "sanctnerOrgnztNm"
              FROM COMTN_RWARD_MANAGE rwd
				   LEFT OUTER JOIN COMVN_USER_MASTER mst
				        ON rwd.RWARDWNR_ID = mst.ESNTL_ID
             WHERE rwd.RWARD_ID     = #{rwardId}
        ]]>
    </select>

    <insert id="insertRwardManage" >
        <![CDATA[
            INSERT INTO COMTN_RWARD_MANAGE ( 
            		RWARD_ID         
            	  , RWARDWNR_ID      
            	  , RWARD_CODE       
            	  , RWARD_DE         
            	  , RWARD_NM         
            	  , PBLEN_CN         
            	  , SANCTNER_ID      
            	  , CONFM_AT         
            	  , SANCTN_DT        
            	  , ATCH_FILE_ID     
            	  , INFRML_SANCTN_ID 
				  , FRST_REGISTER_ID 
				  , FRST_REGIST_PNTTM 
				  , LAST_UPDUSR_ID
				  , LAST_UPDT_PNTTM 
            ) VALUES (
            		#{rwardId}
            	  , #{rwardManId}
            	  , #{rwardCd}
            	  , #{rwardDe}
            	  , #{rwardNm}
            	  , #{pblenCn}
            	  , #{sanctnerId}
            	  , #{confmAt}
            	  , #{sanctnDt, jdbcType=VARCHAR}
            	  , #{atchFileId, jdbcType=VARCHAR}
            	  , #{infrmlSanctnId}
				  , #{frstRegisterId}
				  , SYSDATE
				  , #{frstRegisterId} 
				  , SYSDATE
            )
        ]]>
    </insert>     

    <update id="updtRwardManage" >
        <![CDATA[
	         UPDATE COMTN_RWARD_MANAGE
	            SET RWARD_CODE          = #{rwardCd}
	              , RWARD_DE		     = #{rwardDe}
	              , RWARD_NM            = #{rwardNm}
	              , PBLEN_CN            = #{pblenCn}
	              , ATCH_FILE_ID        = #{atchFileId, jdbcType=VARCHAR}
	              , LAST_UPDUSR_ID      = #{lastUpdusrId}
	              , LAST_UPDT_PNTTM     = SYSDATE    
	          WHERE RWARD_ID            = #{rwardId}
        ]]>
    </update>    
    
    <delete id="deleteRwardManage" >
        <![CDATA[
	        DELETE 
	          FROM COMTN_RWARD_MANAGE
	         WHERE RWARD_ID            = #{rwardId}
        ]]>
    </delete>  
    
<!-- 포상 승인관련  -->
    <select id="selectRwardManageConfmList"  resultType="egovMap">
		<![CDATA[
            SELECT *
              FROM (
            SELECT ROWNUM RNUM, ALL_LIST.*
              FROM (
        ]]>
        /* 구현 Sql */
       <![CDATA[
            SELECT A.RWARD_ID            	AS "rwardId"          
                 , A.RWARD_DE            	AS "rwardDe"          
                 , A.RWARD_NM            	AS "rwardNm"          
                 , A.CONFM_AT            	AS "confmAt"          
                 , A.INFRML_SANCTN_ID    	AS "infrmlSanctnId"   
                 , C.USER_NM             	AS "rwardManNm"       
                 , (select code_nm 
                      from COMTC_CMMN_DETAIL_CODE 
                     where code_id ='COM055' 
                       and code = A.RWARD_CODE
                   ) 						AS "rwardCdNm"   
                 , (select info.ORGNZT_NM 
                      from COMTN_ORGNZT_INFO info 
                     where info.ORGNZT_ID = C.ORGNZT_ID 
                   )  						AS "orgnztNm"
              FROM COMTN_RWARD_MANAGE A
				   LEFT OUTER JOIN COMVN_USER_MASTER C
				        ON A.RWARDWNR_ID = C.ESNTL_ID 
             WHERE A.SANCTNER_ID = #{sanctnerId}
        ]]>
   	    <if test='searchVO.searchKeyword != null and searchVO.searchKeyword != ""'>
        		<![CDATA[ AND A.RWARD_CODE = #{searchVO.searchKeyword} ]]>
		</if>
    	<if test='searchFromDate != null and searchFromDate != ""'>
        		<![CDATA[ AND A.RWARD_DE BETWEEN #{searchFromDate} AND #{searchToDate} ]]>
		</if>
   	    <if test='searchNm != null and searchNm != ""'>
        		<![CDATA[ AND C.USER_NM like '%'||#{searchNm}||'%' ]]>
		</if>
  	    <if test='searchConfmAt != null and searchConfmAt != ""'>
        		<![CDATA[ AND A.CONFM_AT like '%'||#{searchConfmAt}||'%' ]]>
		</if>
        <![CDATA[
             ORDER BY FRST_REGIST_PNTTM DESC
		]]>				
        /* 구현 Sql */
        <![CDATA[
                   ) ALL_LIST
                   )
             WHERE RNUM BETWEEN #{searchVO.firstIndex} + 1 AND #{searchVO.firstIndex} + #{searchVO.recordPerPage}
        ]]>			
    </select> 

    <select id="selectRwardManageConfmListCnt" resultType="int">
         <![CDATA[
            SELECT COUNT(*) totcnt
              FROM COMTN_RWARD_MANAGE A
				   LEFT OUTER JOIN COMVN_USER_MASTER C
				        ON A.RWARDWNR_ID = C.ESNTL_ID 
             WHERE A.SANCTNER_ID = #{sanctnerId}
        ]]>
   	    <if test='searchVO.searchKeyword != null and searchVO.searchKeyword != ""'>
        		<![CDATA[ AND A.RWARD_CODE = #{searchVO.searchKeyword} ]]>
		</if>
    	<if test='searchFromDate != null and searchFromDate != ""'>
        		<![CDATA[ AND A.RWARD_DE BETWEEN #{searchFromDate} AND #{searchToDate} ]]>
		</if>
   	    <if test='searchNm != null and searchNm != ""'>
        		<![CDATA[ AND C.USER_NM like '%'||#{searchNm}||'%' ]]>
		</if>
  	    <if test='searchConfmAt != null and searchConfmAt != ""'>
        		<![CDATA[ AND A.CONFM_AT like '%'||#{searchConfmAt}||'%' ]]>
		</if>
    </select>

    <update id="updtRwardManageConfm" >
        <![CDATA[
	        UPDATE COMTN_RWARD_MANAGE
	           SET CONFM_AT           = #{confmAt}
	             , SANCTN_DT          = TO_DATE(#{sanctnDt}, 'YYYY-MM-DD HH24:MI:SS')
	             , RETURN_RESN        = #{returnResn}
	             , LAST_UPDUSR_ID     = #{lastUpdusrId}
	             , LAST_UPDT_PNTTM    = SYSDATE    
	         WHERE RWARD_ID           = #{rwardId}
        ]]>
    </update> 

</mapper>