<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="aramframework.com.uss.ion.sit.dao.SiteManageMapper">

	<select id="selectSiteList" resultType="egovMap">
        /* 구현 Sql */
		<![CDATA[
      		SELECT SITE_URL					AS "siteUrl"
                 , SITE_ID					AS "siteId"
                 , SITE_NM					AS "siteNm"
                 , B.CODE_NM  				AS "siteThemaClNm" 
                 , A.ACTVTY_AT				AS "actvtyAt"
                 , A.USE_AT					AS "useAt"
                 , USER_NM					AS "emplyrNm" 
                 , A.LAST_UPDT_PNTTM   		AS "lastUpdusrPnttm" 
		      FROM COMTN_SITE_LIST A
				   LEFT OUTER JOIN (SELECT CODE, CODE_NM
					    	   		  FROM COMTC_CMMN_DETAIL_CODE  	
					    	  		 WHERE CODE_ID = 'COM023') B
				       	ON A.SITE_THEMA_CL_CODE = B.CODE
		   		   LEFT OUTER JOIN COMTN_EMPLYR_INFO C     
		   		   		ON A.LAST_UPDUSR_ID = C.ESNTL_ID  									   
		     WHERE 1=1 								
		]]>					
   	    <if test='searchKeyword != null and searchKeyword != ""'>
        <choose>
            <when test='searchCondition == "SITE_NM"'>
                <![CDATA[ AND A.SITE_NM LIKE '%'|| #{searchKeyword} ||'%' ]]>	
            </when>
            <when test='searchCondition == "SITE_URL"'>
                <![CDATA[ AND A.SITE_URL LIKE '%'|| #{searchKeyword} ||'%' ]]>	
            </when>
        </choose>
		</if>
		<![CDATA[				
			 ORDER BY A.SITE_NM DESC								   
		]]>				
        /* 구현 Sql */
        <![CDATA[
 			LIMIT  #{recordPerPage} OFFSET #{firstIndex}
        ]]>			
	</select>
	
	<select id="selectSiteListCnt"  resultType="int">
		<![CDATA[
			SELECT COUNT(*) totcnt
		      FROM COMTN_SITE_LIST A
				   LEFT OUTER JOIN (SELECT CODE, CODE_NM
					    	   		  FROM COMTC_CMMN_DETAIL_CODE  	
					    	  		 WHERE CODE_ID = 'COM023') B
				       	ON A.SITE_THEMA_CL_CODE = B.CODE
		   		   LEFT OUTER JOIN COMTN_EMPLYR_INFO C     
		   		   		ON A.LAST_UPDUSR_ID = C.ESNTL_ID  									   
		     WHERE 1=1 								
		]]>					
   	    <if test='searchKeyword != null and searchKeyword != ""'>
        <choose>
            <when test='searchCondition == "SITE_NM"'>
                <![CDATA[ AND A.SITE_NM LIKE '%'|| #{searchKeyword} ||'%' ]]>	
            </when>
            <when test='searchCondition == "SITE_URL"'>
                <![CDATA[ AND A.SITE_URL LIKE '%'|| #{searchKeyword} ||'%' ]]>	
            </when>
        </choose>
		</if>
	</select>
	
	<select id="selectSiteDetail" resultType="siteManageVO">
		<![CDATA[				
			SELECT SITE_URL
			     , SITE_ID
			     , SITE_NM
			     , SITE_DC
			     , SITE_THEMA_CL_CODE
			     , B.CODE_NM  				AS "siteThemaClNm"
			     , A.ACTVTY_AT
			     , CASE	A.ACTVTY_AT
						WHEN	'Y'	THEN '활성'
						ELSE	'비활성'
					END						AS "actvtyAtNm"
			     , A.USE_AT
			     , CASE	A.USE_AT
						WHEN	'Y'	THEN '사용'
						ELSE	'미사용'
					END						AS "useAtNm"
			     , USER_NM					AS "emplyrNm"
			     , A.FRST_REGIST_PNTTM 		AS "frstRegisterPnttm"  
			     , A.FRST_REGISTER_ID
			     , A.LAST_UPDT_PNTTM   		AS "lastUpdusrPnttm"
			     , A.LAST_UPDUSR_ID			 			  			 			 
			  FROM COMTN_SITE_LIST A
				   LEFT OUTER JOIN (SELECT CODE, CODE_NM
					    	   		  FROM COMTC_CMMN_DETAIL_CODE  	
					    	  		 WHERE CODE_ID = 'COM023') B
				       	ON A.SITE_THEMA_CL_CODE = B.CODE
				   LEFT OUTER JOIN COMTN_EMPLYR_INFO C     	 
				   		ON A.LAST_UPDUSR_ID = C.ESNTL_ID 	 		
			 WHERE SITE_ID = #{siteId}								
		]]>
	</select>
	
	<insert id="insertSiteInfo">	
		<![CDATA[		
			INSERT INTO COMTN_SITE_LIST (
					SITE_ID
				  , SITE_URL 
 				  , SITE_NM 
				  , SITE_DC
				  , SITE_THEMA_CL_CODE 
				  , ACTVTY_AT 
				  , USE_AT
				  , FRST_REGISTER_ID 
				  , FRST_REGIST_PNTTM 
				  , LAST_UPDUSR_ID
				  , LAST_UPDT_PNTTM 
			) VALUES ( 
					#{siteId}
				  , #{siteUrl}
				  , #{siteNm}
				  , #{siteDc}
				  , #{siteThemaClCode}
				  , #{actvtyAt}
				  , #{useAt} 
				  , #{frstRegisterId}
				  , now()
				  , #{frstRegisterId} 
				  , now()
			)
		]]>
	</insert>
	
	<update id="updateSiteInfo">
		<![CDATA[
			UPDATE COMTN_SITE_LIST	
			   SET SITE_ID				= #{siteId}
				 , SITE_URL				= #{siteUrl} 
 				 , SITE_NM				= #{siteNm}
				 , SITE_DC				= #{siteDc}
				 , SITE_THEMA_CL_CODE	= #{siteThemaClCode} 
				 , ACTVTY_AT			= #{actvtyAt}
				 , USE_AT				= #{useAt}
				 , LAST_UPDUSR_ID		= #{lastUpdusrId}
				 , LAST_UPDT_PNTTM		= now()
 			 WHERE SITE_ID = #{siteId}
		]]>
	</update>
	
	<delete id="deleteSiteInfo">
		<![CDATA[
			DELETE 
			  FROM COMTN_SITE_LIST 
			 WHERE SITE_ID = #{siteId}
		]]>
	</delete>

</mapper>
