<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="aramframework.com.uss.ion.wik.bmk.dao.WikiBookmarkMapper">

	<!-- 위키북마크::목록조회 게시물정보 -->
	<select id="selectWikiBookmarkList" resultType="egovMap">
        /* 구현 Sql */
       	<![CDATA[
			SELECT A.WIKI_BKMK_ID
				 , A.USER_ID 				AS "usid"
				 , (SELECT USER_NM 
				      FROM COMTN_EMPLYR_INFO 
				     WHERE ESNTL_ID = A.USER_ID
				   ) 						AS "usnm"
				 , A.WIKI_BKMK_NM
				 , A.FRST_REGISTER_ID
				 , A.FRST_REGIST_PNTTM		AS "frstRegisterPnttm"
				 , (SELECT USER_NM 
				      FROM COMTN_EMPLYR_INFO 
				     WHERE ESNTL_ID = A.FRST_REGISTER_ID
				   ) 						AS "frstRegisterNm" 
			  FROM COMTN_WIKI_BKMK A
			 WHERE A.FRST_REGISTER_ID = #{frstRegisterId}
		]]>
  	    <if test='searchVO.searchKeyword != null and searchVO.searchKeyword != ""'>
        <choose>
            <when test='searchVO.searchCondition == "WIKI_BKMK_NM"'>
                <![CDATA[ AND A.WIKI_BKMK_NM LIKE '%'|| #{searchVO.searchKeyword} ||'%' ]]>
            </when>
            <when test='searchVO.searchCondition == "USER_ID"'>
	       		<![CDATA[ 
	       			AND A.FRST_REGISTER_ID = (SELECT ESNTL_ID 
	       	                                FROM COMTN_EMPLYR_INFO 
	       	                               WHERE EMPLYR_ID LIKE '%' || #{searchVO.searchKeyword} || '%')
 				]]>
            </when>
        </choose>
		</if>
		<![CDATA[
			 ORDER BY A.FRST_REGIST_PNTTM DESC
		]]>				
        /* 구현 Sql */
        <![CDATA[
 			LIMIT  #{searchVO.recordPerPage} OFFSET #{searchVO.firstIndex}
        ]]>			
	</select>
	
	<!-- 위키북마크::목록조회_게시물 총갯수  -->
	<select id="selectWikiBookmarkListCnt" resultType="int">
        <![CDATA[
			SELECT COUNT(*) totcnt
			  FROM COMTN_WIKI_BKMK A
			 WHERE A.FRST_REGISTER_ID = #{frstRegisterId}
        ]]>			
  	    <if test='searchVO.searchKeyword != null and searchVO.searchKeyword != ""'>
        <choose>
            <when test='searchVO.searchCondition == "WIKI_BKMK_NM"'>
                <![CDATA[ AND A.WIKI_BKMK_NM LIKE '%'|| #{searchVO.searchKeyword} ||'%' ]]>
            </when>
            <when test='searchVO.searchCondition == "USER_ID"'>
	       		<![CDATA[ 
	       			AND A.FRST_REGISTER_ID = (SELECT ESNTL_ID 
	       	                                FROM COMTN_EMPLYR_INFO 
	       	                               WHERE EMPLYR_ID LIKE '%' || #{searchVO.searchKeyword} || '%')
 				]]>
            </when>
        </choose>
		</if>
	</select>
	
	<!-- 위키북마크::북마크 중복 체크  -->
	<select id="selectWikiBookmarkDuplicationCnt" resultType="int">
        <![CDATA[
			SELECT COUNT(*) CTN
			  FROM COMTN_WIKI_BKMK A
			 WHERE A.USER_ID=(SELECT ESNTL_ID 
			   				    FROM COMTN_EMPLYR_INFO 
			   				   WHERE EMPLYR_ID = #{usid})
			   AND A.WIKI_BKMK_NM = #{wikiBkmkNm}
        ]]>			
	</select>
	
    <!-- 위키북마크::삭제  -->
	<delete id="deleteWikiBookmark">
		<![CDATA[
			DELETE 
			  FROM COMTN_WIKI_BKMK 
			 WHERE WIKI_BKMK_ID = #{wikiBkmkId} 
		]]>
	</delete>

	<!-- 위키북마크::입력  -->
	<insert id="insertWikiBookmark">	     
	 	<![CDATA[
			INSERT INTO COMTN_WIKI_BKMK ( 
					WIKI_BKMK_ID
				  ,	USER_ID
				  ,	WIKI_BKMK_NM
				  , FRST_REGISTER_ID 
				  , FRST_REGIST_PNTTM 
				  , LAST_UPDUSR_ID
				  , LAST_UPDT_PNTTM 
			)VALUES( 
					#{wikiBkmkId}
				  ,	#{usid}
				  ,	#{wikiBkmkNm}
				  , #{frstRegisterId}
				  , now()
				  , #{frstRegisterId} 
				  , now()
			)
	 	]]>
	</insert>
	
	<!-- 위키북마크::아이디조회  -->
	<select id="selectWikiBookmarkEmpUniqId" resultType="String">
	 	<![CDATA[
			SELECT ESNTL_ID 
			  FROM COMTN_EMPLYR_INFO 
			 WHERE EMPLYR_ID = #{usid}
	 	]]>
	</select>

</mapper>