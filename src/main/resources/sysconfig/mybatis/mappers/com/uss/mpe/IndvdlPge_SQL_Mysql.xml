<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="aramframework.com.uss.mpe.dao.IndvdlPgeMapper">

   	<!-- 마이페이지 콘텐츠 목록 -->

    <!-- 마이페이지에 콘텐츠 추가를 위해 콘텐츠 목록 조회 -->
    <select id="addIndvdlpgeCntntsList" resultType="egovMap">
		<![CDATA[
            SELECT CNTNTS_ID				AS "cntntsId"
            	 , CNTNTS_NM				AS "cntntsNm"
            	 , CNTNTS_LINK_URL			AS "cntntsLinkUrl"
            	 , CNTNTS_DC 				AS "cntntsDc"
              FROM COMTN_INDVDL_PGE_CNTNTS
             WHERE CNTNTS_USE_AT = 'Y' 
               AND CNTNTS_ID NOT IN (
				   		SELECT CNTNTS_ID 
				   		  FROM COMTN_CNTNTS_LIST 
				   		 WHERE EMPLYR_ID = #{userId}
				   )
        ]]>
     	<if test='searchVO.searchKeyword != null and searchVO.searchKeyword != ""'>
        <choose>
            <when test='searchVO.searchCondition == "CNTNTS_NM"'>
                <![CDATA[ AND CNTNTS_NM LIKE '%'|| #{searchVO.searchKeyword} ||'%' ]]>
            </when>
        </choose>
		</if>
        <![CDATA[
        	ORDER BY CNTNTS_ID DESC
        ]]>			
         /* 구현 Sql */
        <![CDATA[
			LIMIT  #{searchVO.recordPerPage} OFFSET #{searchVO.firstIndex}
         ]]>			
    </select>
    
    <!-- 마이페이지에 콘텐츠 추가를 위해 콘텐츠 개수조회 -->
    <select id="addIndvdlpgeCntntsListCnt" resultType="int">
		<![CDATA[
            SELECT count(*) totcnt 
              FROM COMTN_INDVDL_PGE_CNTNTS
             WHERE CNTNTS_USE_AT = 'Y' 
               AND CNTNTS_ID NOT IN (
						SELECT CNTNTS_ID 
						  FROM COMTN_CNTNTS_LIST 
						 WHERE EMPLYR_ID = #{userId}
				   )
        ]]>
     	<if test='searchVO.searchKeyword != null and searchVO.searchKeyword != ""'>
        <choose>
            <when test='searchVO.searchCondition == "CNTNTS_NM"'>
                <![CDATA[ AND CNTNTS_NM LIKE '%'|| #{searchVO.searchKeyword} ||'%' ]]>
            </when>
        </choose>
		</if>
    </select>    
    
    <select id="selectIndvdlpgeResultDetail" resultType="egovMap">
		<![CDATA[
            SELECT A.CNTNTS_ID				AS "cntntsId"
                 , B.CNTNTS_NM				AS "cntntsNm"
                 , B.CNTC_URL				AS "cntcUrl"
                 , B.CNTNTS_LINK_URL		AS "cntntsLinkUrl"
              FROM COMTN_CNTNTS_LIST A
				   LEFT OUTER JOIN (SELECT CNTNTS_ID, CNTNTS_NM, CNTC_URL, CNTNTS_LINK_URL
					    	   		  FROM COMTN_INDVDL_PGE_CNTNTS 	
					    	  		 WHERE CNTNTS_USE_AT = 'Y') B
				       	ON A.CNTNTS_ID = B.CNTNTS_ID
              WHERE A.EMPLYR_ID = #{userId}
        ]]>
    </select>
    
    <select id="selectIndvdlpgeResultDetailCnt" resultType="int">
 		<![CDATA[
            SELECT COUNT(*) AS tot_cnt
              FROM COMTN_CNTNTS_LIST A
				   LEFT OUTER JOIN (SELECT CNTNTS_ID, CNTNTS_NM, CNTC_URL, CNTNTS_LINK_URL
					    	   		  FROM COMTN_INDVDL_PGE_CNTNTS 	
					    	  		 WHERE CNTNTS_USE_AT = 'Y') B
				       	ON A.CNTNTS_ID = B.CNTNTS_ID
              WHERE A.EMPLYR_ID = #{userId}
        ]]>
    </select>
    
    <!-- 마이페이지에  콘텐츠를 바로 추가 -->
    <insert id="addIndvdlpgeCntnts" >
        <![CDATA[
            INSERT INTO COMTN_CNTNTS_LIST (
                	CNTNTS_ID
                  , EMPLYR_ID
            ) VALUES (
            		#{cntntsId}
            	  , #{userId}
            )
        ]]>
    </insert>
      
    <!-- 마이페이지에서  콘텐츠를 바로 삭제 -->
    <delete id="delIndvdlpgeCntnts" >
        <![CDATA[
            DELETE 
              FROM COMTN_CNTNTS_LIST 
             WHERE EMPLYR_ID = #{userId} 
               AND CNTNTS_ID = #{cntntsId}
        ]]>
    </delete>    
      
    <!-- 마이페이지 설정정보 -->
    
    <!-- 마이페이지 설정정보 조회 -->
    <select id="selectIndvdlpgeConfDetail" resultType="indvdlPgeConfVO">
		<![CDATA[
            SELECT EMPLYR_ID				AS "userId"
                 , TITLEBAR_COLOR			AS "titleBarColor"
                 , ALGN_MTHD				AS "sortMthd"
                 , ALGN_CO 					AS "sortCnt"
              FROM COMTN_INDVDL_PGE_ESTBS
             WHERE EMPLYR_ID = #{userId}
        ]]>
    </select>
    
    <!-- 마이페이지 설정정보 존재 체크 -->
    <select id="selectIndvdlpgeConfCnt" resultType="int">
        <![CDATA[
            SELECT COUNT(*) confcnt 
              FROM COMTN_INDVDL_PGE_ESTBS 
             WHERE EMPLYR_ID = #{userId}
        ]]>            
    </select>
    
    <!-- 마이페이지 설정정보 추가 -->
    <insert id="insertIndvdlpgeConf" >
        <![CDATA[
            INSERT INTO COMTN_INDVDL_PGE_ESTBS (
                    EMPLYR_ID
                  , TITLEBAR_COLOR
                  , ALGN_MTHD
                  , ALGN_CO
            ) VALUES (
            		#{userId}
            	  , #{titleBarColor}
            	  , #{sortMthd}
            	  , #{sortCnt}
            )
        ]]>
    </insert>
    
    <!-- 마이페이지 설정정보 수정 -->
    <update id="updateIndvdlpgeConf" >
        <![CDATA[
            UPDATE COMTN_INDVDL_PGE_ESTBS
               SET TITLEBAR_COLOR 	= #{titleBarColor}
                 , ALGN_MTHD 		= #{sortMthd}
                 , ALGN_CO 			= #{sortCnt}	             
             WHERE EMPLYR_ID = #{userId}
        ]]>
    </update>

    <!-- 마이페이지 콘텐츠 -->

    <!-- 마이페이지 콘텐츠 목록 -->
    <select id="selectIndvdlpgeCntntsList" resultType="egovMap">
		<![CDATA[
            SELECT CNTNTS_ID				AS "cntntsId"
                 , CNTNTS_NM				AS "cntntsNm"
                 , CNTC_URL					AS "cntcUrl"
                 , CNTNTS_USE_AT			AS "cntntsUseAt"
              FROM COMTN_INDVDL_PGE_CNTNTS
             WHERE 1=1 
        ]]>
     	<if test='searchVO.searchKeyword != null and searchVO.searchKeyword != ""'>
        <choose>
            <when test='searchVO.searchCondition == "CNTNTS_NM"'>
                <![CDATA[ AND CNTNTS_NM LIKE '%'|| #{searchVO.searchKeyword} ||'%' ]]>
            </when>
            <when test='searchVO.searchCondition == "CNTNTS_USE_AT"'>
                <![CDATA[ AND CNTNTS_USE_AT LIKE '%'|| #{searchVO.searchKeyword} ||'%' ]]>
            </when>
        </choose>
		</if>
        <![CDATA[
            ORDER BY CNTNTS_ID DESC
        ]]>			
         /* 구현 Sql */
        <![CDATA[
			LIMIT  #{searchVO.recordPerPage} OFFSET #{searchVO.firstIndex}
         ]]>			
    </select>
    
    <!-- 마이페이지 콘텐츠 개수 -->
    <select id="selectIndvdlpgeCntntsListCnt" resultType="int">
        <![CDATA[
            SELECT COUNT(*) totcnt 
              FROM COMTN_INDVDL_PGE_CNTNTS 
             WHERE 1=1
        ]]>
     	<if test='searchVO.searchKeyword != null and searchVO.searchKeyword != ""'>
        <choose>
            <when test='searchVO.searchCondition == "CNTNTS_NM"'>
                <![CDATA[ AND CNTNTS_NM LIKE '%'|| #{searchVO.searchKeyword} ||'%' ]]>
            </when>
            <when test='searchVO.searchCondition == "CNTNTS_USE_AT"'>
                <![CDATA[ AND CNTNTS_USE_AT LIKE '%'|| #{searchVO.searchKeyword} ||'%' ]]>
            </when>
        </choose>
		</if>
    </select>
    
    <!-- 마이페이지 콘텐츠 상세보기 -->
	<select id="selectIndvdlpgeCntnts" resultType="indvdlPgeCntntsVO">
        <![CDATA[
            SELECT CNTNTS_ID
                 , CNTNTS_NM
                 , CNTC_URL
                 , CNTNTS_USE_AT
                 , CNTNTS_LINK_URL
                 , CNTNTS_DC 
              FROM COMTN_INDVDL_PGE_CNTNTS
             WHERE CNTNTS_ID = #{cntntsId}
        ]]>
    </select>
    
	<!-- 마이페이지 콘텐츠 등록 -->
    <insert id="insertIndvdlpgeCntnts">
        <![CDATA[
            INSERT INTO COMTN_INDVDL_PGE_CNTNTS (
                	CNTNTS_ID
                  , CNTNTS_NM
                  , CNTC_URL
                  , CNTNTS_USE_AT
                  , CNTNTS_LINK_URL
                  , CNTNTS_DC
            ) VALUES (
            		#{cntntsId}
            	  , #{cntntsNm}
            	  , #{cntcUrl}
            	  , #{cntntsUseAt}
            	  , #{cntntsLinkUrl}
            	  , #{cntntsDc}
            )
        ]]>
    </insert>
    
    <!-- 마이페이지 콘텐츠 수정 -->
	<update id="updateIndvdlpgeCntnts">
        <![CDATA[
            UPDATE COMTN_INDVDL_PGE_CNTNTS
               SET CNTNTS_NM 		= #{cntntsNm}
                 , CNTC_URL 		= #{cntcUrl}
                 , CNTNTS_USE_AT 	= #{cntntsUseAt}
                 , CNTNTS_LINK_URL 	= #{cntntsLinkUrl}
                 , CNTNTS_DC = #{cntntsDc}
             WHERE CNTNTS_ID = #{cntntsId}
        ]]>
    </update>
    
    <!-- 마이페이지 콘텐츠 삭제 -->
	<update id="deleteIndvdlpgeCntnts" >
        <![CDATA[
            UPDATE COMTN_INDVDL_PGE_CNTNTS
               SET CNTNTS_USE_AT = 'N' 
             WHERE CNTNTS_ID = #{cntntsId}
        ]]>
    </update>
    
    <!-- 마이페이지 콘텐츠를 DB에서 완전 삭제 -->
	<delete id="deleteIndvdlpgeCntntsDB" >
        <![CDATA[
            DELETE 
              FROM COMTN_INDVDL_PGE_CNTNTS 
             WHERE CNTNTS_ID = #{cntntsId}
        ]]>
    </delete>
    
</mapper>
