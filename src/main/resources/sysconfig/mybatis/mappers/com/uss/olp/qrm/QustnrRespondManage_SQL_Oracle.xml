<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="aramframework.com.uss.olp.qrm.dao.QustnrRespondManageMapper">

	<!-- 응답자결과(설문조사)::목록조회_게시물정보 -->
	<select id="selectQustnrRespondManageList" resultType="egovMap">
		<![CDATA[
            SELECT *
              FROM (
            SELECT ROWNUM RNUM, ALL_LIST.*
              FROM (
        ]]>
	 	<![CDATA[
			SELECT A.QESTNR_ID				AS "qestnrId"
				 , (SELECT QUSTNR_SJ 
					  FROM COMTN_QESTNR_INFO
					 WHERE QESTNR_ID = A.QESTNR_ID
				   ) 						AS "qestnrSj"  
				 , A.QUSTNR_RESPOND_ID	    AS "qestnrRespondId" 
				 , A.RESPOND_NM				AS "respondNm"
				 , A.FRST_REGIST_PNTTM	 	AS "frstRegisterPnttm" 
				 , (SELECT USER_NM 
				      FROM COMVN_USER_MASTER 
				     WHERE ESNTL_ID = A.FRST_REGISTER_ID
				   ) 						AS "frstRegisterNm" 
		      FROM COMTN_QUSTNR_RESPOND_INFO A
		     WHERE 1=1
	 	]]>
   	    <if test='searchKeyword != null and searchKeyword != ""'>
        <choose>
            <when test='searchCondition == "RESPOND_NM"'>
               	<![CDATA[ AND A.RESPOND_NM LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
            <when test='searchCondition == "BRTHDY"'>
               	<![CDATA[ AND A.BRTHDY LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
            <when test='searchCondition == "QESTNR_ID"'>
               	<![CDATA[ AND A.QESTNR_ID = #{searchKeyword} ]]>
            </when>
	    </choose>
		</if>
	 	<![CDATA[
			 ORDER BY A.FRST_REGIST_PNTTM DESC
		]]>
		<![CDATA[
                   ) ALL_LIST
                   )
             WHERE RNUM BETWEEN #{firstIndex} + 1 AND #{firstIndex} + #{recordPerPage}
	]]>
	</select>

	<!-- 응답자결과(설문조사)::목록조회_게시물 총갯수  -->
	<select id="selectQustnrRespondManageListCnt" resultType="int">
	 	<![CDATA[
			SELECT COUNT(*) totcnt
			  FROM COMTN_QUSTNR_RESPOND_INFO A
			 WHERE 1=1
 		]]>
   	    <if test='searchKeyword != null and searchKeyword != ""'>
        <choose>
            <when test='searchCondition == "RESPOND_NM"'>
               	<![CDATA[ AND A.RESPOND_NM LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
            <when test='searchCondition == "BRTHDY"'>
               	<![CDATA[ AND A.BRTHDY LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
            <when test='searchCondition == "QESTNR_ID"'>
               	<![CDATA[ AND A.QESTNR_ID = #{searchKeyword} ]]>
            </when>
	    </choose>
		</if>
	</select>

	<!-- 응답자결과(설문조사)::상세보기 -->
	<select id="selectQustnrRespondManageDetail" resultType="qustnrRespondManageVO">
	 	<![CDATA[
			SELECT (SELECT QUSTNR_SJ 
					  FROM COMTN_QESTNR_INFO
					 WHERE QESTNR_ID = A.QESTNR_ID
				   ) 						AS "qestnrSj"
				 , A.QESTNR_ID				AS "qestnrId"
				 , A.QUSTNR_RESPOND_ID	    AS "qestnrRespondId"
				 , A.SEXDSTN_CODE			AS "sexdstnCode"
				 , A.OCCP_TY_CODE			AS "occpTyCode"
				 , A.RESPOND_NM				AS "respondNm"
				 , A.BRTHDY					AS "brth"
				 , A.AREA_NO				AS "areaNo"
				 , A.MIDDLE_TELNO			AS "middleTelno"
				 , A.END_TELNO				AS "endTelno"
				 , A.FRST_REGIST_PNTTM	 	AS "frstRegisterPnttm"
				 , A.FRST_REGISTER_ID		AS "frstRegisterId"
				 , A.LAST_UPDT_PNTTM		AS "lastUpdusrPnttm"
				 , A.LAST_UPDUSR_ID			AS "lastUpdusrId"
			  FROM COMTN_QUSTNR_RESPOND_INFO A
			 WHERE QUSTNR_RESPOND_ID = #{qestnrRespondId}
 		]]>
	</select>

	<!-- 응답자결과(설문조사)::입력  -->
	<insert id="insertQustnrRespondManage">
	 	<![CDATA[
			INSERT INTO COMTN_QUSTNR_RESPOND_INFO (
					QESTNR_ID
				  , QUSTNR_RESPOND_ID
				  ,	SEXDSTN_CODE
				  ,	OCCP_TY_CODE
				  ,	RESPOND_NM
				  ,	BRTHDY
				  ,	AREA_NO
				  ,	MIDDLE_TELNO
				  ,	END_TELNO
				  , FRST_REGISTER_ID 
				  , FRST_REGIST_PNTTM 
				  , LAST_UPDUSR_ID
				  , LAST_UPDT_PNTTM 
			)VALUES(
					#{qestnrId}
				  ,	#{qestnrRespondId}
				  ,	#{sexdstnCode}
				  ,	#{occpTyCode}
				  ,	#{respondNm}
				  ,	#{brth}
				  ,	#{areaNo}
				  ,	#{middleTelno}
				  ,	#{endTelno}
				  , #{frstRegisterId}
				  , SYSDATE
				  , #{frstRegisterId} 
				  , SYSDATE
			)
	 	]]>
	</insert>

	<!-- 응답자결과(설문조사)::수정  -->
	<update id="updateQustnrRespondManage">
	 	<![CDATA[
			UPDATE COMTN_QUSTNR_RESPOND_INFO
			   SET SEXDSTN_CODE		= #{sexdstnCode}
			     , OCCP_TY_CODE		= #{occpTyCode}
			     , RESPOND_NM		= #{respondNm}
			     , BRTHDY			= #{brth}
			     , AREA_NO			= #{areaNo}
			     , MIDDLE_TELNO		= #{middleTelno}
			     , END_TELNO		= #{endTelno}
			     , LAST_UPDUSR_ID 	= #{lastUpdusrId}
			     , LAST_UPDT_PNTTM 	= SYSDATE
			 WHERE QUSTNR_RESPOND_ID = #{qestnrRespondId}
	 	]]>
	</update>

	<!-- 응답자결과(설문조사)::삭제  -->
	<delete id="deleteQustnrRespondManage">
		<![CDATA[
			DELETE 
			  FROM COMTN_QUSTNR_RESPOND_INFO
			 WHERE QUSTNR_RESPOND_ID = #{qestnrRespondId}
		]]>
	</delete>

</mapper>