<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="aramframework.com.utl.sys.fsm.dao.FileSysMntrngMapper">

	<!-- 파일시스템모니터링관리::목록조회 -->
	<select id="selectFileSysMntrngList" resultType="fileSysMntrngVO" >
        /* 구현 Sql */
       	<![CDATA[
			SELECT A.FILE_SYS_ID			
				 , A.FILE_SYS_NM			
				 , A.FILE_SYS_MANAGE_NM		
				 , A.FILE_SYS_SIZE			AS "fileSysMg"
				 , A.FILE_SYS_THRHLD		
				 , ROUND((A.FILE_SYS_THRHLD / A.FILE_SYS_SIZE) * 100)		AS "fileSysThrhldRt" 
				 , A.FILE_SYS_USGQTY		AS "fileSysUsgQty"
				 , ROUND((A.FILE_SYS_USGQTY / A.FILE_SYS_SIZE) * 1000) / 10	AS "fileSysUsgRt" 
				 , B.CODE_NM 				AS "mntrngSttus" 
				 , A.MNGR_NM				
				 , A.MNGR_EMAIL_ADRES		AS "mngrEmailAddr"
			  FROM COMTN_FILESYS_MNTRNG A
				   LEFT OUTER JOIN (SELECT CODE, CODE_NM
					    	   		  FROM COMTC_CMMN_DETAIL_CODE  	
					    	  		 WHERE CODE_ID = 'COM046') B
				       	ON A.MNTRNG_STTUS = B.CODE
			 WHERE 1 = 1
		]]>
      	<if test='searchKeyword != null and searchKeyword != ""'>
        <choose>
            <when test='searchCondition == "FILE_SYS_NM"'>
                <![CDATA[ AND A.FILE_SYS_NM LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
            <when test='searchCondition == "FILE_SYS_MANAGE_NM"'>
                <![CDATA[ AND A.FILE_SYS_MANAGE_NM LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
            <when test='searchCondition == "MNGR_NM"'>
                <![CDATA[ AND A.MNGR_NM LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
            <when test='searchCondition == "MNTRNG_STTUS"'>
                <![CDATA[ AND B.CODE_NM LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
        </choose>
		</if>
		 <![CDATA[
			ORDER BY A.FRST_REGIST_PNTTM DESC
		]]>				
        /* 구현 Sql */
        <![CDATA[
 			LIMIT  #recordPerPage# OFFSET #firstIndex#
        ]]>			
	</select>
	
	<!-- 파일시스템모니터링관리::목록조회 Count -->
	<select id="selectFileSysMntrngListCnt" resultType="int" >
	 	<![CDATA[
			SELECT COUNT(A.FILE_SYS_ID) as cnt
			  FROM COMTN_FILESYS_MNTRNG A
				   LEFT OUTER JOIN (SELECT CODE, CODE_NM
					    	   		  FROM COMTC_CMMN_DETAIL_CODE  	
					    	  		 WHERE CODE_ID = 'COM046') B
				       	ON A.MNTRNG_STTUS = B.CODE
			 WHERE 1 = 1
	 	]]>
      	<if test='searchKeyword != null and searchKeyword != ""'>
        <choose>
            <when test='searchCondition == "FILE_SYS_NM"'>
                <![CDATA[ AND A.FILE_SYS_NM LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
            <when test='searchCondition == "FILE_SYS_MANAGE_NM"'>
                <![CDATA[ AND A.FILE_SYS_MANAGE_NM LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
            <when test='searchCondition == "MNGR_NM"'>
                <![CDATA[ AND A.MNGR_NM LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
            <when test='searchCondition == "MNTRNG_STTUS"'>
                <![CDATA[ AND B.CODE_NM LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
        </choose>
		</if>
	</select>
	
	<!-- 파일시스템모니터링관리::상세보기 -->
	<select id="selectFileSysMntrng" resultType="fileSysMntrngVO" >
	 	<![CDATA[
			SELECT A.FILE_SYS_ID
				 , A.FILE_SYS_NM
				 , A.FILE_SYS_MANAGE_NM
				 , A.FILE_SYS_SIZE			AS FILE_SYS_MG
				 , A.FILE_SYS_THRHLD
				 , ROUND((A.FILE_SYS_THRHLD / A.FILE_SYS_SIZE) * 100) 		FILE_SYS_THRHLD_RT
				 , A.FILE_SYS_USGQTY
				 , ROUND((A.FILE_SYS_USGQTY / A.FILE_SYS_SIZE) * 1000) / 10 FILE_SYS_USG_RT
				 , A.MNGR_NM
				 , A.MNGR_EMAIL_ADRES		AS MNGR_EMAIL_ADDR
				 , B.CODE_NM 				AS MNTRNG_STTUS
				 , A.CREAT_DT
				 , A.FRST_REGIST_PNTTM
				 , A.FRST_REGISTER_ID
				 , A.LAST_UPDT_PNTTM
				 , A.LAST_UPDUSR_ID 
			  FROM COMTN_FILESYS_MNTRNG A
				   LEFT OUTER JOIN (SELECT CODE, CODE_NM
					    	   		  FROM COMTC_CMMN_DETAIL_CODE  	
					    	  		 WHERE CODE_ID = 'COM046') B
				       	ON A.MNTRNG_STTUS = B.CODE
			 WHERE A.FILE_SYS_ID = #{fileSysId}
	 	]]>
	</select>
	
	<!-- 파일시스템모니터링관리::입력  -->
	<insert id="insertFileSysMntrng" >
	 	<![CDATA[
			INSERT INTO COMTN_FILESYS_MNTRNG ( 
					FILE_SYS_ID
				  ,	FILE_SYS_NM
				  , FILE_SYS_MANAGE_NM
				  ,	FILE_SYS_SIZE
				  ,	FILE_SYS_THRHLD
				  ,	FILE_SYS_USGQTY
				  ,	MNGR_NM
				  ,	MNGR_EMAIL_ADRES
				  , MNTRNG_STTUS		
				  , CREAT_DT 
				  , FRST_REGISTER_ID 
				  , FRST_REGIST_PNTTM 
				  , LAST_UPDUSR_ID
				  , LAST_UPDT_PNTTM 
			) VALUES ( 
					#{fileSysId}
				  ,	#{fileSysNm}
				  , #{fileSysManageNm}
				  ,	#{fileSysMg}
				  ,	#{fileSysThrhld}
				  ,	#{fileSysUsgQty}
				  ,	#{mngrNm}
				  ,	#{mngrEmailAddr}
				  ,	'01'
				  , sysdate()
				  , #{frstRegisterId}
				  , sysdate()
				  , #{frstRegisterId} 
				  , sysdate()
			)
	 	]]>
	</insert>
	
	<!-- 파일시스템모니터링관리::수정  -->
	<update id="updateFileSysMntrng" > 
	 	<![CDATA[
			UPDATE COMTN_FILESYS_MNTRNG 
			   SET FILE_SYS_NM			= #{fileSysNm}
			     , FILE_SYS_MANAGE_NM	= #{fileSysManageNm}
			     , FILE_SYS_SIZE		= #{fileSysMg}
			     , FILE_SYS_THRHLD		= #{fileSysThrhld}
			     , FILE_SYS_USGQTY		= #{fileSysUsgQty}
			     , MNGR_NM				= #{mngrNm}
			     , MNGR_EMAIL_ADRES		= #{mngrEmailAddr}
			     , LAST_UPDUSR_ID 		= #{lastUpdusrId}
			     , LAST_UPDT_PNTTM 		= sysdate()
			 WHERE FILE_SYS_ID = #{fileSysId}
	 	]]>
	</update>
	
	<!-- 파일시스템모니터링관리::삭제  -->
	<delete id="deleteFileSysMntrng" > 
		<![CDATA[
			DELETE 
			  FROM COMTN_FILESYS_MNTRNG 
			 WHERE FILE_SYS_ID = #{fileSysId}
		]]>
	</delete>
	
	<!-- 파일시스템모니터링관리::모니터링결과수정  -->
	<update id="updateFileSysMntrngSttus" > 
	 	<![CDATA[
			UPDATE COMTN_FILESYS_MNTRNG 
			   SET FILE_SYS_SIZE		= #{fileSysMg}
			     , FILE_SYS_USGQTY		= #{fileSysUsgQty}
			     , MNTRNG_STTUS			= #{mntrngSttus}
			     , CREAT_DT 			= STR_TO_DATE(#{creatDt}, '%Y%m%d%H%i%S')
			     , LAST_UPDUSR_ID 		= #{lastUpdusrId}
			     , LAST_UPDT_PNTTM 		= sysdate()
			 WHERE FILE_SYS_ID = #{fileSysId}
		]]>
	</update>
	
	<!-- 파일시스템모니터링결과::목록조회 -->
	<select id="selectFileSysMntrngLogList" resultType="fileSysMntrngLogVO" >
        /* 구현 Sql */
       	<![CDATA[
	 		SELECT A.FILE_SYS_ID			
				 , A.LOG_ID					
				 , A.FILE_SYS_NM			
				 , A.FILE_SYS_MANAGE_NM		
				 , A.FILE_SYS_SIZE			AS "fileSysMg"
				 , A.FILE_SYS_THRHLD		
				 , ROUND((A.FILE_SYS_THRHLD / A.FILE_SYS_SIZE) * 100)		AS "fileSysThrhldRt" 
				 , A.FILE_SYS_USGQTY		AS "fileSysUsgQty"
				 , ROUND((A.FILE_SYS_USGQTY / A.FILE_SYS_SIZE) * 1000) / 10	AS "fileSysUsgRt" 
				 , C.CODE_NM 				AS "mntrngSttus" 
				 , A.CREAT_DT				
			  FROM COMTN_FILESYS_MNTRNG_LOG A
			       LEFT OUTER JOIN COMTN_FILESYS_MNTRNG B
						ON A.FILE_SYS_ID = B.FILE_SYS_ID
				   LEFT OUTER JOIN (SELECT CODE, CODE_NM
					    	   		  FROM COMTC_CMMN_DETAIL_CODE  	
					    	  		 WHERE CODE_ID = 'COM046') C
				       	ON A.MNTRNG_STTUS = C.CODE
			 WHERE 1 = 1
		]]>
        <if test='searchBgnDt != null and searchBgnDt != ""'>
				<![CDATA[ AND DATE_FORMAT(A.CREAT_DT, '%Y-%m-%d %H:%i') BETWEEN #{searchBgnDt} AND #{searchEndDt} ]]>	
		</if>
      	<if test='searchKeyword != null and searchKeyword != ""'>
        <choose>
            <when test='searchCondition == "FILE_SYS_NM"'>
                <![CDATA[ AND A.FILE_SYS_NM LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
            <when test='searchCondition == "FILE_SYS_MANAGE_NM"'>
                <![CDATA[ AND A.FILE_SYS_MANAGE_NM LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
            <when test='searchCondition == "MNGR_NM"'>
                <![CDATA[ AND B.MNGR_NM LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
            <when test='searchCondition == "MNTRNG_STTUS"'>
                <![CDATA[ AND C.CODE_NM LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
        </choose>
		</if>
		<![CDATA[
			 ORDER BY A.CREAT_DT DESC
		]]>				
        /* 구현 Sql */
        <![CDATA[
 			LIMIT  #{recordPerPage} OFFSET #{firstIndex}
        ]]>			
	</select>
	
	<!-- 파일시스템모니터링결과::목록조회 Count -->
	<select id="selectFileSysMntrngLogListCnt" resultType="int" >
	 	<![CDATA[
			SELECT COUNT(A.FILE_SYS_ID) as cnt
			  FROM COMTN_FILESYS_MNTRNG_LOG A
				   LEFT OUTER JOIN COMTN_FILESYS_MNTRNG B
						ON A.FILE_SYS_ID = B.FILE_SYS_ID
				   LEFT OUTER JOIN (SELECT CODE, CODE_NM
					    	   		  FROM COMTC_CMMN_DETAIL_CODE  	
					    	  		 WHERE CODE_ID = 'COM046') C
				       	ON A.MNTRNG_STTUS = C.CODE
			 WHERE 1 = 1
	 	]]>
        <if test='searchBgnDt != null and searchBgnDt != ""'>
				<![CDATA[ AND DATE_FORMAT(A.CREAT_DT, '%Y-%m-%d %H:%i') BETWEEN #{searchBgnDt} AND #{searchEndDt} ]]>	
		</if>
      	<if test='searchKeyword != null and searchKeyword != ""'>
        <choose>
            <when test='searchCondition == "FILE_SYS_NM"'>
                <![CDATA[ AND A.FILE_SYS_NM LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
            <when test='searchCondition == "FILE_SYS_MANAGE_NM"'>
                <![CDATA[ AND A.FILE_SYS_MANAGE_NM LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
            <when test='searchCondition == "MNGR_NM"'>
                <![CDATA[ AND B.MNGR_NM LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
            <when test='searchCondition == "MNTRNG_STTUS"'>
                <![CDATA[ AND C.CODE_NM LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
        </choose>
		</if>
	</select>
	
	<!-- 파일시스템모니터링결과::상세보기 -->
	<select id="selectFileSysMntrngLog" resultType="fileSysMntrngLogVO" >
	 	<![CDATA[
			SELECT A.FILE_SYS_ID
				 , A.LOG_ID
				 , A.FILE_SYS_NM
				 , A.FILE_SYS_MANAGE_NM
				 , A.FILE_SYS_SIZE					AS FILE_SYS_MG
				 , A.FILE_SYS_THRHLD
				 , ROUND((A.FILE_SYS_THRHLD / A.FILE_SYS_SIZE) * 100) 		AS FILE_SYS_THRHLD_RT
				 , A.FILE_SYS_USGQTY				AS FILE_SYS_USG_QTY
				 , ROUND((A.FILE_SYS_USGQTY / A.FILE_SYS_SIZE) * 1000) / 10 AS FILE_SYS_USG_RT
				 , B.CODE_NM 						AS MNTRNG_STTUS
				 , A.LOG_INFO
				 , A.CREAT_DT
				 , A.FRST_REGIST_PNTTM
				 , A.FRST_REGISTER_ID
				 , A.LAST_UPDT_PNTTM
				 , A.LAST_UPDUSR_ID 
			  FROM COMTN_FILESYS_MNTRNG_LOG A
				   LEFT OUTER JOIN (SELECT CODE, CODE_NM
					    	   		  FROM COMTC_CMMN_DETAIL_CODE  	
					    	  		 WHERE CODE_ID = 'COM046') B
				       	ON A.MNTRNG_STTUS = B.CODE
			 WHERE A.FILE_SYS_ID = #{fileSysId}
			   AND A.LOG_ID = #{logId}
	 	]]>
	</select>
	
	<!-- 파일시스템모니터링결과::입력  -->
	<insert id="insertFileSysMntrngLog">
	 	<![CDATA[
			INSERT INTO COMTN_FILESYS_MNTRNG_LOG ( 
					FILE_SYS_ID
				  ,	LOG_ID
				  ,	FILE_SYS_NM
				  ,	FILE_SYS_MANAGE_NM
				  ,	FILE_SYS_SIZE
				  ,	FILE_SYS_THRHLD
				  , FILE_SYS_USGQTY
				  ,	MNTRNG_STTUS
				  ,	LOG_INFO
				  ,	CREAT_DT
				  , FRST_REGISTER_ID 
				  , FRST_REGIST_PNTTM 
				  , LAST_UPDUSR_ID
				  , LAST_UPDT_PNTTM 
			)VALUES( 
					#{fileSysId}
				  ,	#{logId}
				  ,	#{fileSysNm}
				  ,	#{fileSysManageNm}
				  ,	#{fileSysMg}
				  ,	#{fileSysThrhld}
				  ,	#{fileSysUsgQty}
				  ,	#{mntrngSttus}
				  ,	#{logInfo, jdbcType=VARCHAR}
				  ,	STR_TO_DATE(#{creatDt}, '%Y%m%d%H%i%S')
				  , #{frstRegisterId}
				  , sysdate()
				  , #{frstRegisterId} 
				  , sysdate()
			)
	 	]]>
	</insert>
	
</mapper>