<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="aramframework.com.utl.sys.nsm.dao.NtwrkSvcMntrngMapper">
	
	<!-- 네트워크서비스모니터링관리::목록조회 -->
	<select id="selectNtwrkSvcMntrngList" resultType="ntwrkSvcMntrngVO">
        /* 구현 Sql */
       	<![CDATA[
			SELECT A.SYS_IP
				 , A.SYS_PORT
				 , A.SYS_NM
				 , B.CODE_NM 				MNTRNG_STTUS
				 , A.MNGR_NM
				 , A.MNGR_EMAIL_ADRES		MNGR_EMAIL_ADDR
			  FROM COMTN_NTWRK_SVC_MNTRNG A
				   LEFT OUTER JOIN (SELECT CODE, CODE_NM
					    	   		  FROM COMTC_CMMN_DETAIL_CODE  	
					    	  		 WHERE CODE_ID = 'COM046') B
				       	ON A.MNTRNG_STTUS = B.CODE
			 WHERE 1 = 1
		]]>
      	<if test='searchVO.searchKeyword != null and searchVO.searchKeyword != ""'>
        <choose>
            <when test='searchVO.searchCondition == "SYS_NM"'>
                <![CDATA[ AND A.SYS_NM LIKE '%'|| #{searchVO.searchKeyword} ||'%' ]]>
            </when>
            <when test='searchVO.searchCondition == "SYS_IP"'>
                <![CDATA[ AND A.SYS_IP LIKE '%'|| #{searchVO.searchKeyword} ||'%' ]]>
            </when>
            <when test='searchVO.searchCondition == "MNGR_NM"'>
                <![CDATA[ AND A.MNGR_NM LIKE '%'|| #{searchVO.searchKeyword} ||'%' ]]>
            </when>
            <when test='searchVO.searchCondition == "MNTRNG_STTUS"'>
                <![CDATA[ AND B.CODE_NM LIKE '%'|| #{searchVO.searchKeyword} ||'%' ]]>
            </when>
        </choose>
		</if>
		<![CDATA[
			 ORDER BY A.FRST_REGIST_PNTTM DESC
		]]>				
        /* 구현 Sql */
        <![CDATA[
 			LIMIT  #{searchVO.recordPerPage} OFFSET #{searchVO.firstIndex}
        ]]>			
	</select>
	
	<!-- 네트워크서비스모니터링관리::목록조회 Count -->
	<select id="selectNtwrkSvcMntrngListCnt" resultType="int" >
	 	<![CDATA[
			SELECT COUNT(A.SYS_IP) as cnt
			  FROM COMTN_NTWRK_SVC_MNTRNG A
				   LEFT OUTER JOIN (SELECT CODE, CODE_NM
					    	   		  FROM COMTC_CMMN_DETAIL_CODE  	
					    	  		 WHERE CODE_ID = 'COM046') B
				       	ON A.MNTRNG_STTUS = B.CODE
			 WHERE 1 = 1
	 	]]>
      	<if test='searchVO.searchKeyword != null and searchVO.searchKeyword != ""'>
        <choose>
            <when test='searchVO.searchCondition == "SYS_NM"'>
                <![CDATA[ AND A.SYS_NM LIKE '%'|| #{searchVO.searchKeyword} ||'%' ]]>
            </when>
            <when test='searchVO.searchCondition == "SYS_IP"'>
                <![CDATA[ AND A.SYS_IP LIKE '%'|| #{searchVO.searchKeyword} ||'%' ]]>
            </when>
            <when test='searchVO.searchCondition == "MNGR_NM"'>
                <![CDATA[ AND A.MNGR_NM LIKE '%'|| #{searchVO.searchKeyword} ||'%' ]]>
            </when>
            <when test='searchVO.searchCondition == "MNTRNG_STTUS"'>
                <![CDATA[ AND B.CODE_NM LIKE '%'|| #{searchVO.searchKeyword} ||'%' ]]>
            </when>
        </choose>
		</if>
	</select>
	
	<!-- 네트워크서비스모니터링관리::상세보기 -->
	<select id="selectNtwrkSvcMntrng" resultType="ntwrkSvcMntrngVO" >
	 	<![CDATA[
			SELECT A.SYS_IP
			     , A.SYS_PORT
			     , A.SYS_NM
			     , A.MNGR_NM
			     , A.MNGR_EMAIL_ADRES		MNGR_EMAIL_ADDR
			     , B.CODE_NM 				MNTRNG_STTUS
			     , A.CREAT_DT
			     , A.FRST_REGIST_PNTTM
			     , A.FRST_REGISTER_ID
			     , A.LAST_UPDT_PNTTM
			     , A.LAST_UPDUSR_ID 
			  FROM COMTN_NTWRK_SVC_MNTRNG A
				   LEFT OUTER JOIN (SELECT CODE, CODE_NM
					    	   		  FROM COMTC_CMMN_DETAIL_CODE  	
					    	  		 WHERE CODE_ID = 'COM046') B
				       	ON A.MNTRNG_STTUS = B.CODE
			 WHERE A.SYS_IP = #{sysIp}
			   AND A.SYS_PORT = #{sysPort}
	 	]]>
	</select>
	
	<!-- 네트워크서비스모니터링관리::입력  -->
	<insert id="insertNtwrkSvcMntrng" >
	 	<![CDATA[
			INSERT INTO COMTN_NTWRK_SVC_MNTRNG ( 
					SYS_IP
				  ,	SYS_PORT
				  ,	SYS_NM
				  ,	MNGR_NM
				  ,	MNGR_EMAIL_ADRES
				  , MNTRNG_STTUS
				  , CREAT_DT
				  , FRST_REGISTER_ID 
				  , FRST_REGIST_PNTTM 
				  , LAST_UPDUSR_ID
				  , LAST_UPDT_PNTTM 
			)VALUES( 
					#{sysIp}
				  ,	#{sysPort}
				  ,	#{sysNm}
				  ,	#{mngrNm}
				  ,	#{mngrEmailAddr}
				  ,	'01'
				  ,	now()
				  , #{frstRegisterId}
				  , now()
				  , #{frstRegisterId} 
				  , now()
			)
	 	]]>
	</insert>
	
	<!-- 네트워크서비스모니터링관리::수정  -->
	<update id="updateNtwrkSvcMntrng" > 
	 	<![CDATA[
			UPDATE COMTN_NTWRK_SVC_MNTRNG 
			   SET SYS_IP = #{sysIp}
			   	 , SYS_PORT = #{sysPort}
			   	 , SYS_NM = #{sysNm}
			   	 , MNGR_NM = #{mngrNm}
			   	 , MNGR_EMAIL_ADRES =#{mngrEmailAddr}
			   	 , LAST_UPDUSR_ID = #{lastUpdusrId}
			   	 , LAST_UPDT_PNTTM = now()
			 WHERE SYS_IP = #{oldSysIp}
			   AND SYS_PORT = #{oldSysPort}
	 	]]>
	</update>
	
	<!-- 네트워크서비스모니터링관리::삭제  -->
	<delete id="deleteNtwrkSvcMntrng" > 
		<![CDATA[
			DELETE 
			  FROM COMTN_NTWRK_SVC_MNTRNG 
			 WHERE SYS_IP = #{sysIp}
			   AND SYS_PORT = #{sysPort}
		]]>
	</delete>
	
	<!-- 네트워크서비스모니터링관리::중복 CHECK Count -->
	<select id="selectNtwrkSvcMntrngCheck" resultType="int" >
	 	<![CDATA[
		 	SELECT COUNT(SYS_IP) as cnt
			  FROM COMTN_NTWRK_SVC_MNTRNG 
			 WHERE SYS_IP = #{sysIp}
			   AND SYS_PORT = #{sysPort}
		]]>
	</select>
	
	<!-- 네트워크서비스모니터링관리::모니터링결과수정  -->
	<update id="updateNtwrkSvcMntrngSttus" > 
	 	<![CDATA[
			UPDATE COMTN_NTWRK_SVC_MNTRNG 
			   SET MNTRNG_STTUS = #{mntrngSttus}
			     , CREAT_DT = STR_TO_DATE(#{creatDt}, '%Y%m%d%H%i%S')
			     , LAST_UPDUSR_ID = #{lastUpdusrId}
			     , LAST_UPDT_PNTTM = now()
			 WHERE SYS_IP = #{sysIp}
			   AND SYS_PORT = #{sysPort}
		]]>
	</update>
	
	<!-- 네트워크서비스모니터링결과::목록조회 -->
	<select id="selectNtwrkSvcMntrngLogList" resultType="ntwrkSvcMntrngLogVO">
        /* 구현 Sql */
       	<![CDATA[
			SELECT A.SYS_IP
			     , A.SYS_PORT
			     , A.LOG_ID
			     , A.SYS_NM
			     , C.CODE_NM 				MNTRNG_STTUS
			     , A.CREAT_DT
			  FROM COMTN_NTWRK_SVC_MNTRNG_LOG A
				   LEFT OUTER JOIN COMTN_NTWRK_SVC_MNTRNG B
						ON  A.SYS_IP   = B.SYS_IP
						AND A.SYS_PORT = B.SYS_PORT
				   LEFT OUTER JOIN (SELECT CODE, CODE_NM
					    	   		  FROM COMTC_CMMN_DETAIL_CODE  	
					    	  		 WHERE CODE_ID = 'COM046') C
				       	ON A.MNTRNG_STTUS = C.CODE
			 WHERE 1 = 1
		]]>
        <if test='searchBgnDt != null and searchBgnDt != ""'>
				<![CDATA[ AND DATE_FORMAT(A.CREAT_DT, '%Y-%m-%d %H:%i') BETWEEN #{searchBgnDt} AND #{searchEndDt} ]]>	
		</if>
      	<if test='searchVO.searchKeyword != null and searchVO.searchKeyword != ""'>
        <choose>
            <when test='searchVO.searchCondition == "SYS_NM"'>
                <![CDATA[ AND A.SYS_NM LIKE '%'|| #{searchVO.searchKeyword} ||'%' ]]>
            </when>
            <when test='searchVO.searchCondition == "SYS_IP"'>
                <![CDATA[ AND A.SYS_IP LIKE '%'|| #{searchVO.searchKeyword} ||'%' ]]>
            </when>
            <when test='searchVO.searchCondition == "MNGR_NM"'>
                <![CDATA[ AND B.MNGR_NM LIKE '%'|| #{searchVO.searchKeyword} ||'%' ]]>
            </when>
            <when test='searchVO.searchCondition == "MNTRNG_STTUS"'>
                <![CDATA[ AND C.CODE_NM LIKE '%'|| #{searchVO.searchKeyword} ||'%' ]]>
            </when>
        </choose>
		</if>
		<![CDATA[
			 ORDER BY A.CREAT_DT DESC
		]]>				
        /* 구현 Sql */
        <![CDATA[
 			LIMIT  #{searchVO.recordPerPage} OFFSET #{searchVO.firstIndex}
        ]]>			
	</select>
	
	<!-- 네트워크서비스모니터링결과::목록조회 Count -->
	<select id="selectNtwrkSvcMntrngLogListCnt" resultType="int" >
	 	<![CDATA[
			SELECT COUNT(A.SYS_IP) as cnt
			  FROM COMTN_NTWRK_SVC_MNTRNG_LOG A
				   LEFT OUTER JOIN COMTN_NTWRK_SVC_MNTRNG B
						ON  A.SYS_IP   = B.SYS_IP
						AND A.SYS_PORT = B.SYS_PORT
				   LEFT OUTER JOIN (SELECT CODE, CODE_NM
					    	   		  FROM COMTC_CMMN_DETAIL_CODE  	
					    	  		 WHERE CODE_ID = 'COM046') C
				       	ON A.MNTRNG_STTUS = C.CODE
			 WHERE 1 = 1
	 	]]>
        <if test='searchBgnDt != null and searchBgnDt != ""'>
				<![CDATA[ AND DATE_FORMAT(A.CREAT_DT, '%Y-%m-%d %H:%i') BETWEEN #{searchBgnDt} AND #{searchEndDt} ]]>	
		</if>
      	<if test='searchVO.searchKeyword != null and searchVO.searchKeyword != ""'>
        <choose>
            <when test='searchVO.searchCondition == "SYS_NM"'>
                <![CDATA[ AND A.SYS_NM LIKE '%'|| #{searchVO.searchKeyword} ||'%' ]]>
            </when>
            <when test='searchVO.searchCondition == "SYS_IP"'>
                <![CDATA[ AND A.SYS_IP LIKE '%'|| #{searchVO.searchKeyword} ||'%' ]]>
            </when>
            <when test='searchVO.searchCondition == "MNGR_NM"'>
                <![CDATA[ AND B.MNGR_NM LIKE '%'|| #{searchVO.searchKeyword} ||'%' ]]>
            </when>
            <when test='searchVO.searchCondition == "MNTRNG_STTUS"'>
                <![CDATA[ AND C.CODE_NM LIKE '%'|| #{searchVO.searchKeyword} ||'%' ]]>
            </when>
        </choose>
		</if>
	</select>
	
	<!-- 네트워크서비스모니터링결과::상세보기 -->
	<select id="selectNtwrkSvcMntrngLog" resultType="ntwrkSvcMntrngLogVO" >
	 	<![CDATA[
			SELECT A.SYS_IP
				 , A.SYS_PORT
				 , A.LOG_ID
				 , A.SYS_NM
				 , B.CODE_NM 				MNTRNG_STTUS
				 , A.LOG_INFO
				 , A.CREAT_DT
				 , A.FRST_REGIST_PNTTM
				 , A.FRST_REGISTER_ID
				 , A.LAST_UPDT_PNTTM
				 , A.LAST_UPDUSR_ID 
			  FROM COMTN_NTWRK_SVC_MNTRNG_LOG A
				   LEFT OUTER JOIN (SELECT CODE, CODE_NM
					    	   		  FROM COMTC_CMMN_DETAIL_CODE  	
					    	  		 WHERE CODE_ID = 'COM046') B
				       	ON A.MNTRNG_STTUS = B.CODE
			 WHERE A.SYS_IP = #{sysIp}
			   AND A.SYS_PORT = #{sysPort}
			   AND A.LOG_ID = #{logId}
	 	]]>
	</select>
	
	<!-- 네트워크서비스모니터링결과::입력  -->
	<insert id="insertNtwrkSvcMntrngLog" >
	 	<![CDATA[
			INSERT INTO COMTN_NTWRK_SVC_MNTRNG_LOG ( 
					SYS_IP
				  ,	SYS_PORT
				  ,	LOG_ID
				  ,	SYS_NM
				  ,	MNTRNG_STTUS
				  ,	LOG_INFO
				  ,	CREAT_DT
				  , FRST_REGISTER_ID 
				  , FRST_REGIST_PNTTM 
				  , LAST_UPDUSR_ID
				  , LAST_UPDT_PNTTM 
			)VALUES( 
					#{sysIp}
				  ,	#{sysPort}
				  ,	#{logId}
				  ,	#{sysNm}
				  ,	#{mntrngSttus}
				  ,	#{logInfo, jdbcType=VARCHAR}
				  ,	STR_TO_DATE(#creatDt}, '%Y%m%d%H%i%S')
				  , #{frstRegisterId}
				  , now()
				  , #{frstRegisterId} 
				  , now()
			)
	 	]]>
	</insert>
	
</mapper>