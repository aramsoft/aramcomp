<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="aramframework.com.utl.sys.pxy.service.impl.ProxySvcMapper">

    <select id="selectProxySvcList" resultType="proxySvcVO">
		<![CDATA[
            SELECT *
              FROM (
            SELECT ROWNUM RNUM, ALL_LIST.*
              FROM (
        ]]>
        /* 구현 Sql */
       	<![CDATA[
            SELECT A.PROXY_ID
                 , A.PROXY_NM
                 , A.PROXY_IP
                 , A.PROXY_PORT
                 , A.TRGET_SVC_NM
                 , A.SVC_DC
                 , A.SVC_IP
                 , A.SVC_PORT
                 , A.SVC_STTUS
                 , (SELECT CODE_NM 
                      FROM COMTC_CMMN_DETAIL_CODE 
                     WHERE CODE_ID = 'COM072' 
                       AND CODE = A.SVC_STTUS
                   ) 						AS SVC_STTUS_NM
                 , A.FRST_REGIST_PNTTM 		AS "frstRegisterPnttm"
                 , A.FRST_REGISTER_ID
                 , A.LAST_UPDT_PNTTM 		AS "lastUpdusrPnttm"
                 , A.LAST_UPDUSR_ID
              FROM COMTN_PROXY_INFO A 
             WHERE 1 = 1
       	]]>              
      	<if test='strProxyNm != null and strProxyNm != ""'>
                <![CDATA[ AND A.PROXY_NM LIKE '%'|| #{strProxyNm} ||'%' ]]>
		</if>
        <![CDATA[                
             ORDER BY A.PROXY_ID DESC
		]]>				
        /* 구현 Sql */
        <![CDATA[
                   ) ALL_LIST
                   )
             WHERE RNUM BETWEEN #{firstIndex} + 1 AND #{firstIndex} + #{recordPerPage}
        ]]>			
    </select>

    <select id="selectProxySvcListCnt" resultType="int">
        <![CDATA[
             SELECT COUNT(*) totcnt
               FROM COMTN_PROXY_INFO
              WHERE 1 = 1
        ]]>			
      	<if test='strProxyNm != null and strProxyNm != ""'>
                <![CDATA[ AND A.PROXY_NM LIKE '%'|| #{strProxyNm} ||'%' ]]>
		</if>
    </select>

    <select id="selectProxySvc" resultType="proxySvcVO">
        <![CDATA[
             SELECT A.PROXY_ID
             	  , A.PROXY_NM
             	  , A.PROXY_IP
             	  , A.PROXY_PORT
             	  , A.TRGET_SVC_NM
             	  , A.SVC_DC
             	  , A.SVC_IP
             	  , A.SVC_PORT
             	  , A.SVC_STTUS
             	  ,(SELECT CODE_NM 
                       FROM COMTC_CMMN_DETAIL_CODE 
                      WHERE CODE_ID = 'COM072' 
                        AND CODE = A.SVC_STTUS
                    ) 						AS SVC_STTUS_NM
                  , A.FRST_REGIST_PNTTM 	AS "lastUpdusrPnttm"
                  , A.FRST_REGISTER_ID
                  , A.LAST_UPDT_PNTTM 		AS "lastUpdusrPnttm"
                  , A.LAST_UPDUSR_ID
               FROM COMTN_PROXY_INFO A             
              WHERE A.PROXY_ID = #{proxyId}    
        ]]>
    </select>

    <insert id="insertProxySvc" >
        <![CDATA[
             INSERT INTO COMTN_PROXY_INFO (
             	    PROXY_ID
             	  , PROXY_NM
             	  , PROXY_IP
             	  , PROXY_PORT
             	  , TRGET_SVC_NM
             	  , SVC_DC
             	  , SVC_IP
             	  , SVC_PORT
             	  , SVC_STTUS
				  , FRST_REGISTER_ID 
				  , FRST_REGIST_PNTTM 
				  , LAST_UPDUSR_ID
				  , LAST_UPDT_PNTTM 
             ) VALUES (
             		#{proxyId}
             	  , #{proxyNm}
             	  , #{proxyIp}
             	  , #{proxyPort}
             	  , #{trgetSvcNm}
             	  , #{svcDc}
             	  , #{svcIp}
             	  , #{svcPort}
             	  , #{svcSttus}
				  , #{frstRegisterId}
				  , SYSDATE
				  , #{frstRegisterId} 
				  , SYSDATE
             )
        ]]>
    </insert>

    <update id="updateProxySvc" >
        <![CDATA[
            UPDATE COMTN_PROXY_INFO
               SET PROXY_NM = #{proxyNm}
                 , PROXY_IP = #{proxyIp}
                 , PROXY_PORT = #{proxyPort}
                 , TRGET_SVC_NM = #{trgetSvcNm}
                 , SVC_DC = #{svcDc}
                 , SVC_IP = #{svcIp}
                 , SVC_PORT = #{svcPort}
                 , SVC_STTUS = #{svcSttus}
                 , LAST_UPDUSR_ID = #{lastUpdusrId}
                 , LAST_UPDT_PNTTM = SYSDATE
             WHERE PROXY_ID = #{proxyId}
        ]]>
    </update>    
    
    <delete id="deleteProxySvc" >
        <![CDATA[
            DELETE 
              FROM COMTN_PROXY_INFO
             WHERE PROXY_ID = #{proxyId}
        ]]>
    </delete>

    <select id="selectProxySvcLogList" resultType="proxySvcVO">
		<![CDATA[
            SELECT *
              FROM (
            SELECT ROWNUM RNUM, ALL_LIST.*
              FROM (
        ]]>
        /* 구현 Sql */
       	<![CDATA[
            SELECT A.PROXY_ID
            	 , A.LOG_ID
            	 , B.PROXY_NM
            	 , A.CLNT_PORT
            	 , A.CLNT_IP
            	 , TO_CHAR(A.CONECT_TIME, 'YYYY-MM-DD HH24:MI:SS') AS CONECT_TIME
            	 , A.FRST_REGIST_PNTTM 		AS "lastUpdusrPnttm"
            	 , A.FRST_REGISTER_ID
            	 , A.LAST_UPDT_PNTTM 		AS "lastUpdusrPnttm"
            	 , A.LAST_UPDUSR_ID
              FROM COMTN_PROXY_LOG A
                   LEFT OUTER JOIN COMTN_PROXY_INFO B
                   		ON A.PROXY_ID = B.PROXY_ID 		
             WHERE 1=1       
       	]]>               
        <if test='strStartDate != null and strStartDate != ""'>
				<![CDATA[ AND TO_CHAR(A.CONECT_TIME, 'YYYYMMDD') BETWEEN #{strStartDate} AND #{strEndDate} ]]>		
		</if>
       	<![CDATA[                      
             ORDER BY A.LAST_UPDT_PNTTM DESC
		]]>				
        /* 구현 Sql */
        <![CDATA[
                   ) ALL_LIST
                   )
             WHERE RNUM BETWEEN #{firstIndex} + 1 AND #{firstIndex} + #{recordPerPage}
        ]]>			
    </select>
    
    <select id="selectProxySvcLogListCnt" resultType="int">
        <![CDATA[
             SELECT COUNT(*) totcnt
              FROM COMTN_PROXY_LOG A
                   LEFT OUTER JOIN COMTN_PROXY_INFO B
                   		ON A.PROXY_ID = B.PROXY_ID 		
             WHERE 1=1       
        ]]>			
        <if test='strStartDate != null and strStartDate != ""'>
				<![CDATA[ AND TO_CHAR(A.CONECT_TIME, 'YYYYMMDD') BETWEEN #{strStartDate} AND #{strEndDate} ]]>		
		</if>
    </select>    
    
    <insert id="insertProxySvcLog" >
        <![CDATA[
             INSERT INTO COMTN_PROXY_LOG (
             		PROXY_ID
             	  , LOG_ID
             	  , CLNT_IP
             	  , CLNT_PORT
             	  , CONECT_TIME
				  , FRST_REGISTER_ID 
				  , FRST_REGIST_PNTTM 
				  , LAST_UPDUSR_ID
				  , LAST_UPDT_PNTTM 
             ) VALUES (
             		#{proxyId}
             	  , #{logId}
             	  , #{clntIp}
             	  , #{clntPort}
             	  , SYSDATE
				  , #{frstRegisterId}
				  , SYSDATE
				  , #{frstRegisterId} 
				  , SYSDATE
             )
        ]]>
    </insert>  
      
</mapper>