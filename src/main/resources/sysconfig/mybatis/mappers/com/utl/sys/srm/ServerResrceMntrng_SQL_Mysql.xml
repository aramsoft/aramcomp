<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="aramframework.com.utl.sys.srm.service.impl.ServerResrceMntrngMapper">

    <select id="selectMntrngServerList" resultType="egovMap">
		<![CDATA[
            SELECT A.SERVER_ID
           	  	 , A.SERVER_EQPMN_ID
            	 , B.SERVER_EQPMN_NM
             	 , B.SERVER_EQPMN_IP
             	 , B.MNGR_EMAIL_ADRES		MNGR_EMAIL_ADDR
              FROM COMTN_SERVER_EQPMN_RELATE A
                   LEFT OUTER JOIN COMTN_SERVER_EQPMN_INFO B
                   	 	ON A.SERVER_EQPMN_ID = B.SERVER_EQPMN_ID	
             WHERE 1=1     
		]]>				
      	<if test='strServerNm != null and strServerNm != ""'>
        		<![CDATA[ AND B.SERVER_EQPMN_NM LIKE '%'|| #{strServerNm} ||'%' ]]>
		</if>
    </select>

    <select id="selectMntrngServerListCnt" resultType="int">
		<![CDATA[
            SELECT COUNT(*) totcnt
              FROM COMTN_SERVER_EQPMN_RELATE A
                   LEFT OUTER JOIN COMTN_SERVER_EQPMN_INFO B
                   	 	ON A.SERVER_EQPMN_ID = B.SERVER_EQPMN_ID	
             WHERE 1=1     
		]]>				
      	<if test='strServerNm != null and strServerNm != ""'>
        		<![CDATA[ AND B.SERVER_EQPMN_NM LIKE '%'|| #{strServerNm} ||'%' ]]>
		</if>
    </select>
    
    <select id="selectServerResrceMntrngList" resultType="egovMap">
        /* 구현 Sql */
		<![CDATA[
            SELECT A.SERVER_ID
                 , A.SERVER_EQPMN_ID
                 , A.LOG_ID
                 , C.SERVER_EQPMN_NM 		AS SERVER_NM
                 , C.SERVER_EQPMN_IP
                 , A.CPU_USE_RT
                 , A.MORY_USE_RT
                 , A.SVC_STTUS
                 , (SELECT CODE_NM 
                      FROM COMTC_CMMN_DETAIL_CODE
                     WHERE CODE_ID = 'COM072' 
                       AND CODE = A.SVC_STTUS
                   ) 						AS SVC_STTUS_NM
                 , A.LOG_INFO
                 , C.MNGR_EMAIL_ADRES
                 , DATE_FORMAT(A.CREAT_DT, '%Y-%m-%d %H%i%S') AS CREAT_DT
                 , A.FRST_REGIST_PNTTM 		AS "frstRegisterPnttm" 
                 , C.FRST_REGISTER_ID
                 , A.LAST_UPDT_PNTTM 		AS "lastUpdusrPnttm"
                 , C.LAST_UPDUSR_ID
              FROM COMTN_SERVER_RESRCE_LOG A
                   LEFT OUTER JOIN COMTN_SERVER_INFO B
                   	 	ON A.SERVER_ID = B.SERVER_ID	
                   LEFT OUTER JOIN COMTN_SERVER_EQPMN_INFO C
                    	ON A.SERVER_EQPMN_ID = C.SERVER_EQPMN_ID
             WHERE 1=1
       	]]>                      
        <if test='strStartDt != null and strStartDt != ""'>
			 	<![CDATA[ AND DATE_FORMAT(A.CREAT_DT, '%Y%m%d') BETWEEN #{strStartDt} AND #{strEndDt} ]]> 	
		</if>
      	<if test='strServerNm != null and strServerNm != ""'>
                <![CDATA[ AND C.SERVER_EQPMN_NM LIKE '%'|| #{strServerNm} ||'%' ]]> 
		</if>
       	<![CDATA[              
             ORDER BY A.LOG_ID DESC
		]]>				
        /* 구현 Sql */
        <![CDATA[
 			LIMIT  #{recordPerPage} OFFSET #{firstIndex}
        ]]>			
    </select>

    <select id="selectServerResrceMntrngListCnt" resultType="int">
       	<![CDATA[              
            SELECT COUNT(*) totcnt
              FROM COMTN_SERVER_RESRCE_LOG A
                   LEFT OUTER JOIN COMTN_SERVER_INFO B
                   	 	ON A.SERVER_ID = B.SERVER_ID	
                   LEFT OUTER JOIN COMTN_SERVER_EQPMN_INFO C
                    	ON A.SERVER_EQPMN_ID = C.SERVER_EQPMN_ID
             WHERE 1=1
        ]]>			
        <if test='strStartDt != null and strStartDt != ""'>
			 	<![CDATA[ AND DATE_FORMAT(A.CREAT_DT, '%Y%m%d') BETWEEN #{strStartDt} AND #{strEndDt} ]]> 	
		</if>
      	<if test='strServerNm != null and strServerNm != ""'>
                <![CDATA[ AND C.SERVER_EQPMN_NM LIKE '%'|| #{strServerNm} ||'%' ]]> 
		</if>
    </select>

    <select id="selectServerResrceMntrng" resultType="serverResrceMntrngVO">
        <![CDATA[
            SELECT A.SERVER_ID
            	 , A.SERVER_EQPMN_ID
            	 , A.LOG_ID
            	 , C.SERVER_EQPMN_NM 		AS SERVER_NM
            	 , C.SERVER_EQPMN_IP
            	 , A.CPU_USE_RT
            	 , A.MORY_USE_RT
            	 , A.SVC_STTUS
            	 , (SELECT CODE_NM 
                      FROM COMTC_CMMN_DETAIL_CODE 
                     WHERE CODE_ID = 'COM072' 
                       AND CODE = A.SVC_STTUS
                   ) 						AS SVC_STTUS_NM
                 , A.LOG_INFO
                 , C.MNGR_EMAIL_ADRES
                 , DATE_FORMAT(A.CREAT_DT, '%Y-%m-%d %H%i%S') AS CREAT_DT
                 , A.FRST_REGIST_PNTTM 		AS "frstRegisterPnttm" 
                 , A.FRST_REGISTER_ID
                 , A.LAST_UPDT_PNTTM 		AS "lastUpdusrPnttm" 
                 , A.LAST_UPDUSR_ID
              FROM COMTN_SERVER_RESRCE_LOG A
                   LEFT OUTER JOIN COMTN_SERVER_INFO B
                   	 	ON A.SERVER_ID = B.SERVER_ID	
                   LEFT OUTER JOIN COMTN_SERVER_EQPMN_INFO C
                    	ON A.SERVER_EQPMN_ID = C.SERVER_EQPMN_ID
              FROM A.LOG_ID = #{logId}   
        ]]>
    </select>

    <insert id="insertServerResrceMntrng">
        <![CDATA[
             INSERT INTO COMTN_SERVER_RESRCE_LOG (
             	    SERVER_ID
             	  , SERVER_EQPMN_ID
             	  , LOG_ID
             	  , CPU_USE_RT
             	  , MORY_USE_RT
             	  , SVC_STTUS
             	  , LOG_INFO
             	  , CREAT_DT
				  , FRST_REGISTER_ID 
				  , FRST_REGIST_PNTTM 
				  , LAST_UPDUSR_ID
				  , LAST_UPDT_PNTTM 
             ) VALUES (
             	    #{serverId}
             	  , #{serverEqpmnId}
             	  , #{logId}
             	  , #{cpuUseRt}
             	  , #{moryUseRt}
             	  , #{svcSttus}
             	  , #{logInfo, jdbcType=VARCHAR}
             	  , sysdate()
				  , #{frstRegisterId}
				  , sysdate()
				  , #{frstRegisterId} 
				  , sysdate()
             )
        ]]>
    </insert>

</mapper>