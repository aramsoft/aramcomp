<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="aramframework.mbl.com.mpa.service.PhotoMapper">

	<select id="selectPhotoList" resultType="egovMap">
		<![CDATA[
            SELECT *
              FROM (
            SELECT ROWNUM RNUM, ALL_LIST.*
              FROM (
        ]]>
        /* 구현 Sql */
       	<![CDATA[
			SELECT SN
			     , MBER_ID
			     , PHOTO_SJ
			     , ATCH_FILE_ID
			     , CREAT_DT
			     , UPDT_DT		 
			  FROM MBLTN_PHOTO_ALBUM
			 WHERE 1=1
		]]>					
  	    <if test='searchKeyword != null and searchKeyword != ""'>
        <choose>
            <when test='searchCondition == "MBER_ID"'>
             	<![CDATA[ AND MBER_ID LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
            <when test='searchCondition == "PHOTO_SJ"'>
             	<![CDATA[ AND PHOTO_SJ LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
        </choose>
		</if>
		<![CDATA[
			 ORDER BY SN DESC			
		]]>				
        /* 구현 Sql */
        <![CDATA[
                   ) ALL_LIST
                   )
             WHERE RNUM BETWEEN #{firstIndex} + 1 AND #{firstIndex} + #{recordPerPage}
        ]]>			
	</select>
	
	<select id="selectPhotoListCnt" resultType="int">
		<![CDATA[
			SELECT COUNT(*) totcnt
			  FROM MBLTN_PHOTO_ALBUM
			 WHERE 1=1
		]]>					
  	    <if test='searchKeyword != null and searchKeyword != ""'>
        <choose>
            <when test='searchCondition == "MBER_ID"'>
             	<![CDATA[ AND MBER_ID LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
            <when test='searchCondition == "PHOTO_SJ"'>
             	<![CDATA[ AND PHOTO_SJ LIKE '%'|| #{searchKeyword} ||'%' ]]>
            </when>
        </choose>
		</if>
	</select>
	
	<select id="selectPhoto" resultType="photoVO">
		<![CDATA[		
			SELECT SN
			     , MBER_ID
			     , PHOTO_SJ
			     , ATCH_FILE_ID
			     , CREAT_DT
			     , UPDT_DT	 			  			 			  
			  FROM MBLTN_PHOTO_ALBUM		
			 WHERE SN = #{sn}					
		]]>
	</select>
	
	<insert id="insertPhoto">
		<![CDATA[	
			INSERT INTO MBLTN_PHOTO_ALBUM (
					SN
				  , MBER_ID
				  , PHOTO_SJ
				  , ATCH_FILE_ID
				  , CREAT_DT
				  , UPDT_DT
			) VALUES ( 
					#{sn}
				  , #{mberId}
				  , #{photoSj}
				  , #{atchFileId}
				  , SYSDATE
				  , SYSDATE 
			)
		]]>
	</insert>

	<update id="updatePhoto">
		<![CDATA[
			UPDATE MBLTN_PHOTO_ALBUM 
			   SET SN			= #{sn} 
				 , PHOTO_SJ		= #{photoSj}
				 , ATCH_FILE_ID	= #{atchFileId}	
				 , UPDT_DT		= SYSDATE
 			 WHERE SN = #{sn}
		]]>
     	<if test='mberId != null and mberId != ""'>
 			   <![CDATA[ AND MBER_ID = #{mberId} ]]>
		</if>
	</update>
	
	<delete id="deletePhoto">
		<![CDATA[
			DELETE 
			  FROM MBLTN_PHOTO_ALBUM 
			 WHERE SN = #{sn}
		]]>
     	<if test='mberId != null and mberId != ""'>
 			   <![CDATA[ AND MBER_ID = #{mberId} ]]>
		</if>
	</delete>
	
</mapper>
