<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="aramframework.mbl.com.oas.dao.OpenApiMapper">

	<select id="selectOpenApiInquiryHistoryList" resultType="egovMap" >
        /* 구현 Sql */
       	<![CDATA[
			SELECT a.SN
			     , b.CODE_NM as OPEN_API_SVC_NM
			     , c.CODE_NM as OPEN_API_PROVD_INSTT_NM
			     , a.COLLECT_DT
			  FROM MBLTN_OPENAPI a
				   LEFT OUTER JOIN COMTC_CMMN_DETAIL_CODE b
						ON  a.OPEN_API_SVC_CODE_ID = b.CODE_ID
						AND a.OPEN_API_SVC_CODE = b.CODE
				   LEFT OUTER JOIN COMTC_CMMN_DETAIL_CODE c
						ON  a.OPENAPI_PROVD_INSTT_CODE_ID = c.CODE_ID
						AND a.OPENAPI_PROVD_INSTT_CODE = c.CODE
			 WHERE 1=1
		]]>
  	    <if test='searchVO.searchKeyword != null and searchVO.searchKeyword != ""'>
        <choose>
            <when test='searchVO.searchCondition == "OPENAPI_PROVD_INSTT_CODE"'>
             	<![CDATA[ AND c.OPENAPI_PROVD_INSTT_CODE LIKE '%'|| #{searchVO.searchKeyword} ||'%' ]]>
            </when>
            <when test='searchVO.searchCondition == "OPEN_API_SVC_CODE"'>
             	<![CDATA[ AND B.OPEN_API_SVC_CODE LIKE '%'|| #{searchVO.searchKeyword} ||'%' ]]>
            </when>
        </choose>
		</if>
		<![CDATA[
			 ORDER BY a.SN DESC
		]]>				
        /* 구현 Sql */
        <![CDATA[
 			LIMIT  #{searchVO.recordPerPage} OFFSET #{searchVO.firstIndex}
        ]]>			
	</select>	
	
	<select id="selectOpenApiInquiryHistoryListCnt" resultType="int" >
		<![CDATA[
			SELECT COUNT(a.SN)
			  FROM MBLTN_OPENAPI a
				   LEFT OUTER JOIN COMTC_CMMN_DETAIL_CODE b
						ON  a.OPEN_API_SVC_CODE_ID = b.CODE_ID
						AND a.OPEN_API_SVC_CODE = b.CODE
				   LEFT OUTER JOIN COMTC_CMMN_DETAIL_CODE c
						ON  a.OPENAPI_PROVD_INSTT_CODE_ID = c.CODE_ID
						AND a.OPENAPI_PROVD_INSTT_CODE = c.CODE
			 WHERE 1=1
		]]>
  	    <if test='searchVO.searchKeyword != null and searchVO.searchKeyword != ""'>
        <choose>
            <when test='searchVO.searchCondition == "OPENAPI_PROVD_INSTT_CODE"'>
             	<![CDATA[ AND c.OPENAPI_PROVD_INSTT_CODE LIKE '%'|| #{searchVO.searchKeyword} ||'%' ]]>
            </when>
            <when test='searchVO.searchCondition == "OPEN_API_SVC_CODE"'>
             	<![CDATA[ AND B.OPEN_API_SVC_CODE LIKE '%'|| #{searchVO.searchKeyword} ||'%' ]]>
            </when>
        </choose>
		</if>
	</select>	
 
 	<select id="selectOpenApiInquiryHistory" resultType="openApiVO" >
		<![CDATA[
			SELECT a.SN
			     , a.MBER_ID
			     , b.CODE_NM as OPEN_API_SVC_NM
			     , c.CODE_NM as OPEN_API_PROVD_INSTT_NM
			     , a.OPEN_API_SVC_CN
			     , a.COLLECT_DT
			  FROM MBLTN_OPENAPI a
				   LEFT OUTER JOIN COMTC_CMMN_DETAIL_CODE b
						ON  a.OPEN_API_SVC_CODE_ID = b.CODE_ID
						AND a.OPEN_API_SVC_CODE = b.CODE
				   LEFT OUTER JOIN COMTC_CMMN_DETAIL_CODE c
						ON  a.OPENAPI_PROVD_INSTT_CODE_ID = c.CODE_ID
						AND a.OPENAPI_PROVD_INSTT_CODE = c.CODE
			 WHERE a.SN = #{sn}
		]]>				
	</select>
 
 	<insert id="insertOpenApiInquiryHistory" >
		<![CDATA[
			INSERT INTO MBLTN_OPENAPI (
					SN
				  , MBER_ID
				  , OPEN_API_SVC_CODE_ID
				  ,	OPEN_API_SVC_CODE
				  , OPEN_API_SVC_CN
				  , OPENAPI_PROVD_INSTT_CODE_ID
				  ,	OPENAPI_PROVD_INSTT_CODE
				  , COLLECT_DT
			) VALUES (
					#{sn}
				  ,	#{mberId}
				  , (SELECT CODE_ID
					   FROM COMTC_CMMN_DETAIL_CODE
					  WHERE CODE_NM = #{openApiSvcNm})
				  ,	(SELECT CODE
					   FROM COMTC_CMMN_DETAIL_CODE
					  WHERE CODE_NM = #{openApiSvcNm})
				  ,	#openApiSvcCn#
				  ,	(SELECT CODE_ID
					   FROM COMTC_CMMN_DETAIL_CODE
					  WHERE CODE_NM = #{openApiProvdInsttNm})
				  ,	(SELECT CODE
					   FROM COMTC_CMMN_DETAIL_CODE
					  WHERE CODE_NM = #{openApiProvdInsttNm})
				  ,	sysdate()
			)
		]]>
	</insert>
	
</mapper>