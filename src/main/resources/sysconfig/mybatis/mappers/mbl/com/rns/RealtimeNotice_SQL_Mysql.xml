<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="aramframework.mbl.com.rns.dao.RealtimeNoticeMapper">

	<!-- 1. 실시간 공지서비스 관리자 목록 조회  -->
	<select id="selectRealtimeNoticeList" resultType="egovMap">
        /* 구현 Sql */
       	<![CDATA[
		    SELECT A.SN
		         , A.NOTICE_SJ
		         , A.CREAT_DT
		      FROM MBLTN_REALTIME_NOTICE A
		     ORDER BY A.SN DESC
        ]]>
        <![CDATA[
			 LIMIT #{fetchRow}     
		]]>
	</select>
	
	<!-- 2. 실시간 공지서비스 메시지 조회	-->
	<select id="selectRealtimeNoticeMsg" resultType="egovMap">
		<![CDATA[
			SELECT A.SN AS SN
			     , A.NOTICE_SJ AS NOTICE_SJ
			     , A.NOTICE_CN AS NOTICE_CN
	          FROM MBLTN_REALTIME_NOTICE A
	         WHERE A.SN = (SELECT MAX(SN) 
	                         FROM MBLTN_REALTIME_NOTICE)         
	           AND TO_DATE( A.NOTICE_BGNDT, 'YYYY-MM-DD') <= TO_DATE( sysdate(), 'YYYY-MM-DD')
	           AND TO_DATE( A.NOTICE_ENDDT, 'YYYY-MM-DD') >= TO_DATE( sysdate(), 'YYYY-MM-DD')         
		]]>
	</select>
	
	<!-- 3. 실시간 공지서비스 관리자 / 사용자 상세조회  -->
	<select id="selectRealtimeNotice" resultType="realtimeNoticeVO">
		<![CDATA[		
			SELECT A.SN AS SN
			     , A.MBER_ID AS MBER_ID
			     , A.NOTICE_SJ AS NOTICE_SJ
			     , A.NOTICE_CN AS NOTICE_CN
			     , A.NOTICE_BGNDT
			     , A.NOTICE_ENDDT
				 , A.RECENT_CODE_ID
				 , A.RECENT_CODE		      
			     , A.CREAT_DT AS CREAT_DT
			  FROM MBLTN_REALTIME_NOTICE A
			 WHERE A.SN = #{sn}
		]]>
      	<if test='mberId != null and mberId != ""'>
 			   <![CDATA[ AND MBER_ID = #{mberId} ]]>
		</if>
	</select>
	
	<!-- 4. 실시간공지서비스 NEW 일련번호 조회 -->
	<select id="selectRealtimeNoticeNewSn" resultType="int">
		<![CDATA[
			SELECT CASE WHEN A.CNT = 0 THEN 1
	                    ELSE (SELECT MAX(A.SN) + 1 
	                            FROM MBLTN_REALTIME_NOTICE A
	                         )
	                END AS SN 
	  		  FROM (
			        SELECT COUNT(SN) AS CNT
			          FROM MBLTN_REALTIME_NOTICE
	               ) A
		]]>
	</select>

	<!-- 5.실시간 공지서비스 등록 -->
	<insert id="insertRealtimeNotice">
		<![CDATA[	
			INSERT INTO MBLTN_REALTIME_NOTICE (
					SN
				  ,	MBER_ID
				  ,	NOTICE_SJ
				  ,	NOTICE_CN
				  ,	RECENT_CODE_ID
				  ,	RECENT_CODE
				  ,	NOTICE_BGNDT
				  ,	NOTICE_ENDDT
				  ,	CREAT_DT
				  ,	UPDT_DT
			) VALUES (
					#{sn}
				  ,	#{mberId}
				  ,	#{noticeSj}
				  ,	#{noticeCn}
				  ,	#{recentCodeId}
				  ,	#{recentCode}
				  ,	TO_DATE( #{noticeBgnDt}, 'YYYY-MM-DD')
				  ,	TO_DATE( #{noticeEndDt}, 'YYYY-MM-DD')
				  ,	sysdate()
				  ,	sysdate()
			)
		]]>
	</insert>
	
	<!-- 6. 실시간 공지서비스 삭제 -->
	<delete id="deleteRealtimeNotice">
		<![CDATA[
			DELETE 
			  FROM MBLTN_REALTIME_NOTICE
			 WHERE SN = #{sn}
		]]>
      	<if test='mberId != null and mberId != ""'>
 			   <![CDATA[ AND MBER_ID = #{mberId} ]]>
		</if>
	</delete>	
	
</mapper>
