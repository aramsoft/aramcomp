<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="aramframework.mbl.com.syn.dao.SyncMapper">
	
	<!-- 동기화 서비스 목록 조회 -->
	<select id="selectSyncList" resultType="egovMap">
		<![CDATA[
            SELECT *
              FROM (
            SELECT ROWNUM RNUM, ALL_LIST.*
              FROM (
        ]]>
        /* 구현 Sql */
       	<![CDATA[
			SELECT A.SN
			     , A.MBER_ID
			     , A.SYNC_SJ
			     , A.SYNC_CN
			     , TO_CHAR( A.SYNC_DT, 'YYYY-MM-DD') AS SYNC_DT
			     , TO_CHAR( A.CREAT_DT, 'YYYY-MM-DD') AS CREAT_DT
			     , TO_CHAR( A.UPDT_DT, 'YYYY-MM-DD') AS UPDT_DT
			  FROM MBLTN_SYNC A
			 WHERE 1 = 1
		]]>
 	    <if test='searchVO.searchKeyword != null and searchVO.searchKeyword != ""'>
        <choose>
            <when test='searchVO.searchCondition == "MBER_ID"'>
             	<![CDATA[ AND A.MBER_ID LIKE '%'|| #{searchVO.searchKeyword} ||'%' ]]>
            </when>
            <when test='searchVO.searchCondition == "SYNC_SJ"'>
             	<![CDATA[ AND A.SYNC_SJ LIKE '%'|| #{searchVO.searchKeyword} ||'%' ]]>
            </when>
            <when test='searchVO.searchCondition == "SYNCALL"'>
				<![CDATA[ AND ( (A.MBER_ID LIKE '%' || #{searchVO.searchKeyword} || '%') 
				              OR (A.SYNC_SJ LIKE '%' || #{searchVO.searchKeyword} || '%') 
				              OR (A.SYNC_CN LIKE '%' || #{searchVO.searchKeyword} || '%'))	
				]]>
            </when>
        </choose>
		</if>
		<![CDATA[
			 ORDER BY SN DESC
		]]>				
        /* 구현 Sql */
        <![CDATA[
                   ) ALL_LIST
                   )
             WHERE RNUM BETWEEN #{searchVO.firstIndex} + 1 AND #{searchVO.firstIndex} + #{searchVO.recordPerPage}
        ]]>			
	</select>
	
	<!-- 동기화 서비스 글 목록 Total count -->
	<select id="selectSyncListCnt" resultType="int">
		<![CDATA[
			SELECT COUNT(A.SN) AS TOT_CNT
			  FROM MBLTN_SYNC A
			 WHERE 1 = 1		   
		]]>
 	    <if test='searchVO.searchKeyword != null and searchVO.searchKeyword != ""'>
        <choose>
            <when test='searchVO.searchCondition == "MBER_ID"'>
             	<![CDATA[ AND A.MBER_ID LIKE '%'|| #{searchVO.searchKeyword} ||'%' ]]>
            </when>
            <when test='searchVO.searchCondition == "SYNC_SJ"'>
             	<![CDATA[ AND A.SYNC_SJ LIKE '%'|| #{searchVO.searchKeyword} ||'%' ]]>
            </when>
            <when test='searchVO.searchCondition == "SYNCALL"'>
				<![CDATA[ AND ( (A.MBER_ID LIKE '%' || #{searchVO.searchKeyword} || '%') 
				              OR (A.SYNC_SJ LIKE '%' || #{searchVO.searchKeyword} || '%') 
				              OR (A.SYNC_CN LIKE '%' || #{searchVO.searchKeyword} || '%'))	
				]]>
            </when>
        </choose>
		</if>
	</select>
	
	<!-- 동기화 서비스 글 상세 조회 -->
	<select id="selectSync" resultType="syncVO">
		<![CDATA[		
			SELECT A.SN
			     , A.MBER_ID
			     , A.SYNC_SJ
			     , A.SYNC_CN
			     , CASE WHEN TO_CHAR(A.SYNC_DT) IS NULL THEN ''
			            ELSE TO_CHAR( A.SYNC_DT, 'YYYY-MM-DD') 
			       END AS SYNC_DT
			     , TO_CHAR( A.CREAT_DT, 'YYYY-MM-DD') AS CREAT_DT
			     , TO_CHAR( A.UPDT_DT, 'YYYY-MM-DD') AS UPDT_DT
			  FROM MBLTN_SYNC A
			 WHERE 1 = 1
			   AND A.SN = #{sn}
		]]>
	</select>
	
	<!-- 동기화 서비스 신규 일련번호 -->
	<select id="selectSyncNewSn" resultType="int">
		<![CDATA[
			SELECT CASE WHEN A.CNT = 0 THEN 1
	                    ELSE (SELECT MAX(A.SN) + 1 
	                            FROM MBLTN_SYNC A
	                         )
	                END AS SN 
	  		  FROM (
			        SELECT COUNT(SN) AS CNT
			          FROM MBLTN_SYNC
	               ) A
		]]>
	</select>	

	<!-- 동기화 서비스 글 등록 -->
	<insert id="insertSync">
		<![CDATA[	
			INSERT INTO MBLTN_SYNC (
					SN
				  , MBER_ID
				  ,	SYNC_SJ
				  ,	SYNC_CN
				  , CREAT_DT
				  ,	UPDT_DT
			) VALUES (
					#{sn}
				  ,	#{mberId}
				  ,	#{syncSj}
				  ,	#{syncCn}
				  ,	SYSDATE
				  ,	SYSDATE
			)
		]]>
	</insert>
	
	<!-- 동기화서비스 글 수정 -->
	<update id="updateSync">
		<![CDATA[
			UPDATE MBLTN_SYNC
			   SET MBER_ID = #{mberId}
			     , SYNC_SJ = #{syncSj}
			     , SYNC_CN = #{syncCn}
			     , UPDT_DT = SYSDATE
			 WHERE SN = #{sn}	   
		]]>
      	<if test='mberId != null and mberId != ""'>
 			   <![CDATA[ AND MBER_ID = #{mberId} ]]>
		</if>
	</update>		

	<!-- 동기화서비스 글 삭제 -->
	<delete id="deleteSync">
		<![CDATA[
			DELETE 
			  FROM MBLTN_SYNC
			 WHERE SN = #{sn}
		]]>
      	<if test='mberId != null and mberId != ""'>
 			   <![CDATA[ AND MBER_ID = #{mberId} ]]>
		</if>
	</delete>		
	
</mapper>
