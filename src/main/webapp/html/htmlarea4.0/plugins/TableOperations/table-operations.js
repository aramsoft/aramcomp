// Table Operations Plugin for HTMLArea-4.0
// Maintained and developed by SF_chris, http://Inferior-Products.com
// Original implementation by Mihai Bazon.  Initiated by http://www.bloki.com
//
// HTMLArea (c) 2005-2013 Inferior-Products.com
// HTMLArea 3.0 is (c) Dynarch.com, 2003-2005
//
// Visit us at http://Inferior-Products.com
//
// $Id: table-operations.js,v 1.24 2013-07-29 20:36:38 sfchris Exp $
 function TableOperations(editor){this.editor=editor;var cfg=editor.config;var tt=TableOperations.I18N;var bl=TableOperations.btnList;var self=this;var toolbar=["linebreak"];for(var i=0;i<bl.length;++i){var btn=bl[i];if(!btn){toolbar.push("separator");}else{var id="TO-"+btn[0];cfg.registerButton(id,tt[id],editor.imgURL(btn[0]+".gif","TableOperations"),false,function(editor,id){self.buttonPress(editor,id);},btn[1]);toolbar.push(id);}}cfg.toolbar.push(toolbar);};TableOperations._pluginInfo={name:"TableOperations",version:"1.1",developer:"SF_chris",developer_url:"http://Inferior-Products.com/",c_owner:"Inferior-Products",sponsor:"Zapatec Inc.",sponsor_url:"http://www.bloki.com",license:"htmlArea"};TableOperations.prototype.getClosest=function(tagName){var editor=this.editor;var ancestors=editor.getAllAncestors();var ret=null;tagName=(""+tagName).toLowerCase();for(var i=0;i<ancestors.length;++i){var el=ancestors[i];if(el.tagName.toLowerCase()==tagName){ret=el;break;}}return ret;};TableOperations.prototype.dialogTableProperties=function(){var i18n=TableOperations.I18N;var table=this.getClosest("table");var dialog=new PopupWin(this.editor,i18n["Table Properties"],function(dialog,params){TableOperations.processStyle(params,table);for(var i in params){var val=params[i];switch(i){case "f_caption":if(/\S/.test(val)){var caption=table.getElementsByTagName("caption")[0];if(!caption){caption=dialog.editor._doc.createElement("caption");table.insertBefore(caption,table.firstChild);}caption.innerHTML=val;}else{var caption=table.getElementsByTagName("caption")[0];if(caption){caption.parentNode.removeChild(caption);}}break;case "f_summary":table.summary=val;break;case "f_width":table.style.width=(""+val)+params.f_unit;break;case "f_align":table.align=val;break;case "f_spacing":table.cellSpacing=val;break;case "f_padding":table.cellPadding=val;break;case "f_borders":table.border=val;break;case "f_frames":table.frame=val;break;case "f_rules":table.rules=val;break;}}dialog.editor.forceRedraw();dialog.editor.focusEditor();dialog.editor.updateToolbar();var save_collapse=table.style.borderCollapse;table.style.borderCollapse="collapse";table.style.borderCollapse="separate";table.style.borderCollapse=save_collapse;},function(dialog){var f_caption="";var capel=table.getElementsByTagName("caption")[0];if(capel){f_caption=capel.innerHTML;}var f_summary=table.summary;var f_width=parseInt(table.style.width);isNaN(f_width)&&(f_width="");var f_unit=/%/.test(table.style.width)?'percent':'pixels';var f_align=table.align;var f_spacing=table.cellSpacing;var f_padding=table.cellPadding;var f_borders=table.border;var f_frames=table.frame;var f_rules=table.rules;function selected(val){return val?" selected":"";};dialog.content.style.width="450px";dialog.content.innerHTML=" \
<div class='title'\
 style='background: url("+dialog.baseURL+dialog.editor.imgURL("table-prop.gif","TableOperations")+") #fff 98% 50% no-repeat'>"+i18n["Table Properties"]+"\
</div> \
<table style='width:100%'> \
  <tr> \
    <td> \
      <fieldset><legend>"+i18n["Description"]+"</legend> \
       <table style='width:100%'> \
        <tr> \
          <td class='label'>"+i18n["Caption"]+":</td> \
          <td class='value'><input"+(HTMLArea.is_ie?" style='width: 30em'":"")+" type='text' name='f_caption' value='"+f_caption+"'/></td> \
        </tr><tr> \
          <td class='label'>"+i18n["Summary"]+":</td> \
          <td class='value'><input"+(HTMLArea.is_ie?" style='width: 30em'":"")+" type='text' name='f_summary' value='"+f_summary+"'/></td> \
        </tr> \
       </table> \
      </fieldset> \
    </td> \
  </tr> \
  <tr><td id='--HA-layout'></td></tr> \
  <tr> \
    <td> \
      <fieldset><legend>"+i18n["Spacing and padding"]+"</legend> \
       <table style='width:100%'> \
        <tr> \
          <td class='label'>"+i18n["Spacing"]+":</td> \
          <td><input type='text' name='f_spacing' size='5' value='"+f_spacing+"' /> &nbsp;"+i18n["Padding"]+":\
            <input type='text' name='f_padding' size='5' value='"+f_padding+"' /> &nbsp;&nbsp;"+i18n["pixels"]+"\
          </td> \
        </tr> \
       </table> \
      </fieldset> \
    </td> \
  </tr> \
  <tr> \
    <td id='--HA-style'></td> \
  </tr> \
</table> \
";var p=dialog.doc.getElementById("--HA-style");var st_prop=TableOperations.createStyleFieldset(p,dialog.doc,dialog.editor,table);var st_layout=TableOperations.createStyleLayoutFieldset(dialog.doc,dialog.editor,table);p=dialog.doc.getElementById("--HA-layout");p.appendChild(st_layout);dialog.modal=true;dialog.addButtons("ok","cancel");dialog.showAtElement(dialog.editor._iframe,"c");});};TableOperations.prototype.dialogRowCellProperties=function(cell){var i18n=TableOperations.I18N;var element=this.getClosest(cell?"td":"tr");var table=this.getClosest("table");var dialog=new PopupWin(this.editor,i18n[cell?"Cell Properties":"Row Properties"],function(dialog,params){TableOperations.processStyle(params,element);for(var i in params){var val=params[i];switch(i){case "f_align":element.align=val;break;case "f_char":element.ch=val;break;case "f_valign":element.vAlign=val;break;}}dialog.editor.forceRedraw();dialog.editor.focusEditor();dialog.editor.updateToolbar();var save_collapse=table.style.borderCollapse;table.style.borderCollapse="collapse";table.style.borderCollapse="separate";table.style.borderCollapse=save_collapse;},function(dialog){var f_align=element.align;var f_valign=element.vAlign;var f_char=element.ch;function selected(val){return val?" selected":"";};dialog.content.style.width="450px";dialog.content.innerHTML=" \
<div class='title'\
 style='background: url("+dialog.baseURL+dialog.editor.imgURL(cell?"cell-prop.gif":"row-prop.gif","TableOperations")+") #fff 98% 50% no-repeat'>"+i18n[cell?"Cell Properties":"Row Properties"]+"</div> \
<table style='width:100%'> \
  <tr> \
    <td id='--HA-layout'> \
    </td> \
  </tr> \
  <tr> \
    <td id='--HA-style'></td> \
  </tr> \
</table> \
";var p=dialog.doc.getElementById("--HA-style");var st_prop=TableOperations.createStyleFieldset(p,dialog.doc,dialog.editor,element);var st_layout=TableOperations.createStyleLayoutFieldset(dialog.doc,dialog.editor,element);p=dialog.doc.getElementById("--HA-layout");p.appendChild(st_layout);dialog.modal=true;dialog.addButtons("ok","cancel");dialog.showAtElement(dialog.editor._iframe,"c");});};TableOperations.prototype.buttonPress=function(editor,button_id){this.editor=editor;var mozbr=HTMLArea.is_gecko?"<br />":"";var i18n=TableOperations.I18N;function clearRow(tr){var tds=tr.getElementsByTagName("td");for(var i=tds.length;--i>=0;){var td=tds[i];td.rowSpan=1;td.innerHTML=mozbr;}};function splitRow(td){var n=parseInt(""+td.rowSpan);var nc=parseInt(""+td.colSpan);td.rowSpan=1;tr=td.parentNode;var itr=tr.rowIndex;var trs=tr.parentNode.rows;var index=td.cellIndex;while(--n>0){tr=trs[++itr];var otd=td.cloneNode(false);otd.removeAttribute("rowspan");otd.colSpan=td.colSpan;otd.innerHTML=mozbr;tr.insertBefore(otd,tr.cells[index]);}editor.forceRedraw();editor.updateToolbar();};function splitCol(td){var nc=parseInt(""+td.colSpan);td.colSpan=1;tr=td.parentNode;var ref=td.nextSibling;while(--nc>0){var otd=td.cloneNode(false);otd.removeAttribute("colspan");otd.rowSpan=td.rowSpan;otd.innerHTML=mozbr;tr.insertBefore(otd,ref);}editor.forceRedraw();editor.updateToolbar();};function splitCell(td){var nc=parseInt(""+td.colSpan);splitCol(td);var items=td.parentNode.cells;var index=td.cellIndex;while(nc-->0){splitRow(items[index++]);}};function selectNextNode(el){var node=el.nextSibling;while(node&&node.nodeType!=1){node=node.nextSibling;}if(!node){node=el.previousSibling;while(node&&node.nodeType!=1){node=node.previousSibling;}}if(!node){node=el.parentNode;}editor.selectNodeContents(node);};switch(button_id){case "TO-row-insert-above":case "TO-row-insert-under":var tr=this.getClosest("tr");if(!tr){break;}var otr=tr.cloneNode(true);clearRow(otr);tr.parentNode.insertBefore(otr,/under/.test(button_id)?tr.nextSibling:tr);editor.selectNodeContents(otr.firstChild,true);editor.forceRedraw();editor.focusEditor();break;case "TO-row-delete":var tr=this.getClosest("tr");if(!tr){break;}var par=tr.parentNode;if(par.rows.length==1){alert(i18n["not-del-last-row"]);break;}selectNextNode(tr);par.removeChild(tr);editor.forceRedraw();editor.focusEditor();editor.updateToolbar();break;case "TO-row-split":var td=this.getClosest("td");if(!td){break;}splitRow(td);break;case "TO-col-insert-before":case "TO-col-insert-after":var td=this.getClosest("td");if(!td){break;}var rows=td.parentNode.parentNode.rows;var index=td.cellIndex;for(var i=rows.length;--i>=0;){var tr=rows[i];var ref=tr.cells[index];var otd=ref.cloneNode(true);otd.innerHTML=mozbr;if(/after/.test(button_id))ref=tr.cells[index+1];tr.insertBefore(otd,ref);editor.selectNodeContents(otd,true);}editor.focusEditor();break;case "TO-col-split":var td=this.getClosest("td");if(!td){break;}splitCol(td);break;case "TO-col-delete":var td=this.getClosest("td");if(!td){break;}var index=td.cellIndex;if(td.parentNode.cells.length==1){alert(i18n["not-del-last-col"]);break;}selectNextNode(td);var rows=td.parentNode.parentNode.rows;for(var i=rows.length;--i>=0;){var tr=rows[i];tr.removeChild(tr.cells[index]);}editor.forceRedraw();editor.focusEditor();editor.updateToolbar();break;case "TO-cell-split":var td=this.getClosest("td");if(!td){break;}splitCell(td);break;case "TO-cell-insert-before":case "TO-cell-insert-after":var td=this.getClosest("td");if(!td){break;}var tr=td.parentNode;var otd=td.cloneNode(true);otd.innerHTML=mozbr;tr.insertBefore(otd,/after/.test(button_id)?td.nextSibling:td);editor.selectNodeContents(otd,true);editor.forceRedraw();editor.focusEditor();break;case "TO-cell-delete":var td=this.getClosest("td");if(!td){break;}if(td.parentNode.cells.length==1){alert(i18n["not-del-last-cell"]);break;}selectNextNode(td);td.parentNode.removeChild(td);editor.forceRedraw();editor.updateToolbar();break;case "TO-cell-merge":var sel=editor._getSelection();var range,i=0;var rows=[];var row=null;var cells=null;if(!HTMLArea.is_ie){try{while(range=sel.getRangeAt(i++)){var td=range.startContainer.childNodes[range.startOffset];if(td.parentNode!=row){row=td.parentNode;(cells)&&rows.push(cells);cells=[];}cells.push(td);}}catch(e){}rows.push(cells);}else{var td=this.getClosest("td");if(!td){alert(i18n["Please click into some cell"]);break;}var tr=td.parentElement;var no_cols=prompt(i18n["How many columns would you like to merge?"],2);if(!no_cols){break;}if(!/^\+?[1-9][0-9]*$/.test(no_cols)){alert(i18n["Aborted: please enter a positive integer"]);break;}var no_rows=prompt(i18n["How many rows would you like to merge?"],2);if(!no_rows){break;}if(!/^\+?[1-9][0-9]*$/.test(no_rows)){alert(i18n["Aborted: please enter a positive integer"]);break;}var cell_index=td.cellIndex;while(no_rows-->0){td=tr.cells[cell_index];cells=[td];for(var i=1;i<no_cols;++i){td=td.nextSibling;if(!td){break;}cells.push(td);}rows.push(cells);tr=tr.nextSibling;if(!tr){break;}}}try{for(i=0;i<rows.length;++i){var cells=rows[i];for(var j=0;j<cells.length;++j){var cell=cells[j];if(cell.rowSpan>1||cell.colSpan>1)throw "HTMLAREA_US: Aborting: merged cells already exist in range.";}}var HTML="";for(i=0;i<rows.length;++i){var cells=rows[i];for(var j=0;j<cells.length;++j){var cell=cells[j];HTML+=cell.innerHTML;(i||j)&&(cell.parentNode.removeChild(cell));}}var td=rows[0][0];td.innerHTML=HTML;td.rowSpan=rows.length;td.colSpan=rows[0].length;editor.selectNodeContents(td);editor.forceRedraw();editor.focusEditor();}catch(e){if(/^HTMLAREA_US:/.test(e)){e=e.replace(/^HTMLAREA_US:\s*/,'');alert(i18n[e]||e);}}break;case "TO-table-prop":this.dialogTableProperties();break;case "TO-row-prop":this.dialogRowCellProperties(false);break;case "TO-cell-prop":this.dialogRowCellProperties(true);break;default:alert("Button ["+button_id+"] not yet implemented");}};TableOperations.prototype.onUpdateToolbar=function(){if(HTMLArea.is_ie){var mergeBtn=this.editor._toolbarObjects["TO-cell-merge"];var anc=this.editor.getAncestorsHash();mergeBtn.state("enabled",(anc.table&&anc.td));}};TableOperations.btnList=[["table-prop","table"],null,["row-prop","tr"],["row-insert-above","tr"],["row-insert-under","tr"],["row-delete","tr"],["row-split","td[rowSpan!=1]"],null,["col-insert-before","td"],["col-insert-after","td"],["col-delete","td"],["col-split","td[colSpan!=1]"],null,["cell-prop","td"],["cell-insert-before","td"],["cell-insert-after","td"],["cell-delete","td"],["cell-merge","tr"],["cell-split","td[colSpan!=1,rowSpan!=1]"]];TableOperations.getLength=function(value){var len=parseInt(value);if(isNaN(len)){len="";}return len;};TableOperations.style_ops=function(style,params){var cleaned={};for(var prop in params){var val=params[prop];var m=TableOperations.style_mapping[prop];if(m){if(val&&typeof m.m=="string")val=m.m.replace(/%s/g,val);else if(typeof m.m=="object"&&typeof m.m[""+val]!="undefined")val=m.m[""+val];if(val===null||!/\S/.test(val)){if(HTMLArea.is_ie){if(m.c){for(var i in style)if(m.c.test(i)){style.removeAttribute(i,false);cleaned[i]=true;}}style.removeAttribute(m.ie,false);cleaned[m.ie]=true;}else{if(m.c){for(var i=style.length;--i>=0;)if(m.c.test(style.item(i))){style.removeProperty(i.nodeName);cleaned[i.nodeName]=true;}}style.removeProperty(m.s);cleaned[m.s]=true;}}else try{if(HTMLArea.is_ie){if(!cleaned[m.ie])style.setAttribute(m.ie,val,false);}else{if(!cleaned[m.s])style.setProperty(m.s,val,"");}}catch(e){};}}};TableOperations.style_mapping={f_st_backgroundColor:{s:"background-color",ie:"backgroundColor"},f_st_color:{s:"color",ie:"color"},f_st_backgroundImage:{s:"background-image",m:"url('%s')",ie:"backgroundImage"},f_st_borderStyle:{s:"border-style",c:/^border-?(right|top|left|bottom)?-?(width|color)$/i,ie:"borderStyle"},f_st_borderWidth:{s:"border-width",m:"%spx",c:/^border-?(right|top|left|bottom)?-?(style|color)$/i,ie:"borderWidth"},f_st_borderColor:{s:"border-color",c:/^border-?(right|top|left|bottom)?-?(style|width)$/i,ie:"borderColor"},f_st_borderCollapse:{s:"border-collapse",ie:"borderCollapse",m:{"true":"collapse","false":""}},f_st_width:{s:"width",ie:"width"},f_st_height:{s:"height",ie:"height"},f_st_textAlign:{s:"text-align",ie:"textAlign"},f_st_verticalAlign:{s:"vertical-align",ie:"verticalAlign"},f_st_float:{s:"float",ie:"styleFloat"},f_st_margin:{s:"margin",ie:"margin"},f_st_padding:{s:"padding",ie:"padding"}};TableOperations.processStyle=function(params,element){var style=element.style,i;if(params.f_st_width)params.f_st_width=params.f_st_width+params.f_st_widthUnit;if(params.f_st_height)params.f_st_height=params.f_st_height+params.f_st_heightUnit;TableOperations.style_ops(style,params);element.__msh_globalStyle=params.f_our_globalStyle;var tagname=element.tagName.toLowerCase();if(tagname=="table"){if(params.f_st_float=="center"){element.align="center";params.f_st_float=null;if(HTMLArea.is_ie)style.removeAttribute("styleFloat",false);}else element.removeAttribute("align");}if(params.f_our_globalStyle){var tmpst={f_st_borderColor:params.f_st_borderColor,f_st_borderWidth:params.f_st_borderWidth,f_st_borderStyle:params.f_st_borderStyle,f_st_backgroundColor:params.f_st_backgroundColor,f_st_color:params.f_st_color,f_st_textAlign:params.f_st_textAlign,f_st_verticalAlign:params.f_st_verticalAlign};if(tagname=="tr"){tmpst.f_st_height=params.f_st_height;tmpst.f_st_heightUnit="";}var tds=element.getElementsByTagName("td");for(i=tds.length;--i>=0;)TableOperations.processStyle(tmpst,tds[i]);}if(tagname=="td"){var tmpst={f_st_width:params.f_st_width,f_st_widthUnit:""};var table=element;while(table&&!/^table$/i.test(table.tagName))table=table.parentNode;if(table){for(i=table.rows.length;--i>=0;)TableOperations.style_ops(table.rows[i].cells[element.cellIndex].style,tmpst);}}};TableOperations.createColorButton=function(doc,editor,color,name){if(!color){color="";}else if(!/#/.test(color)){color=HTMLArea._colorToRgb(color);}var df=doc.createElement("span");var field=doc.createElement("input");field.type="hidden";df.appendChild(field);field.name="f_st_"+name;field.value=color;var button=doc.createElement("span");button.className="buttonColor";df.appendChild(button);var span=doc.createElement("span");span.className="chooser";if(typeof color=="string")color=color.replace(/.*\s+([^\s]+)$/g,"$1");span.style.backgroundColor=color;button.appendChild(span);button.onmouseover=function(){if(!this.disabled){this.className+=" buttonColor-hilite";}};button.onmouseout=function(){if(!this.disabled){this.className="buttonColor";}};span.onclick=function(){if(this.parentNode.disabled){return false;}editor._popupDialog("select_color.html",function(color){if(color){span.style.backgroundColor="#"+color;field.value="#"+color;}},color);};var span2=doc.createElement("span");span2.innerHTML="&#x00d7;";span2.className="nocolor";span2.title=TableOperations.I18N["Unset color"];button.appendChild(span2);span2.onmouseover=function(){if(!this.parentNode.disabled){this.className+=" nocolor-hilite";}};span2.onmouseout=function(){if(!this.parentNode.disabled){this.className="nocolor";}};span2.onclick=function(){span.style.backgroundColor="";field.value="";};return df;};TableOperations.createStyleLayoutFieldset=function(doc,editor,el){var i18n=TableOperations.I18N;var fieldset=doc.createElement("fieldset");var legend=doc.createElement("legend");fieldset.appendChild(legend);legend.innerHTML=i18n["Layout"];var table=doc.createElement("table");fieldset.appendChild(table);table.style.width="100%";var tbody=doc.createElement("tbody");table.appendChild(tbody);var tagname=el.tagName.toLowerCase();var tr,td,input,select,option,options,i;if(tagname!="td"&&tagname!="tr"&&tagname!="th"){tr=doc.createElement("tr");tbody.appendChild(tr);td=doc.createElement("td");td.className="label";tr.appendChild(td);td.innerHTML=i18n["Align"]+" / "+i18n["Float"]+":";td=doc.createElement("td");tr.appendChild(td);select=doc.createElement("select");td.appendChild(select);select.name="f_st_float";options=["Not set","None","Left","Center","Right"];for(var i=0;i<options.length;++i){var Val=options[i];var val=i?options[i].toLowerCase():"";option=doc.createElement("option");option.innerHTML=i18n[Val];option.value=val;option.selected=(val!="center"?((""+el.style[HTMLArea.is_ie?"styleFloat":"cssFloat"]).toLowerCase()==val):el.align=="center");select.appendChild(option);}}tr=doc.createElement("tr");tbody.appendChild(tr);td=doc.createElement("td");td.className="label";tr.appendChild(td);td.innerHTML=i18n["Width"]+":";td=doc.createElement("td");tr.appendChild(td);input=doc.createElement("input");input.type="text";input.value=TableOperations.getLength(el.style.width);input.size="5";input.name="f_st_width";input.style.marginRight="0.5em";td.appendChild(input);select=doc.createElement("select");select.name="f_st_widthUnit";option=doc.createElement("option");option.innerHTML=i18n["percent"];option.value="%";option.selected=/%/.test(el.style.width);select.appendChild(option);option=doc.createElement("option");option.innerHTML=i18n["pixels"];option.value="px";option.selected=/px/.test(el.style.width);select.appendChild(option);option=doc.createElement("option");option.innerHTML=i18n["points"];option.value="pt";option.selected=/pt/.test(el.style.width);select.appendChild(option);td.appendChild(select);if(tagname=="tr"){select.disabled=true;input.disabled=true;}select.style.marginRight="0.5em";td.appendChild(doc.createTextNode(i18n["Text align"]+":"));select=doc.createElement("select");select.style.marginLeft=select.style.marginRight="0.5em";td.appendChild(select);select.name="f_st_textAlign";options=["Not set","Left","Center","Right","Justify"];if(tagname=="td"){options.push("Char");}input=doc.createElement("input");input.name="f_st_textAlignChar";input.size="1";input.style.fontFamily="monospace";td.appendChild(input);for(var i=0;i<options.length;++i){var Val=options[i];var val=i?Val.toLowerCase():"";option=doc.createElement("option");option.value=val;option.innerHTML=i18n[Val];option.selected=(el.style.textAlign.toLowerCase()==val);select.appendChild(option);}function setCharVisibility(value){input.style.visibility=value?"visible":"hidden";if(value){input.focus();input.select();}};select.onchange=function(){setCharVisibility(this.value=="char");};setCharVisibility(select.value=="char");tr=doc.createElement("tr");tbody.appendChild(tr);td=doc.createElement("td");td.className="label";tr.appendChild(td);td.innerHTML=i18n["Height"]+":";td=doc.createElement("td");tr.appendChild(td);input=doc.createElement("input");input.type="text";input.value=TableOperations.getLength(el.style.height);input.size="5";input.name="f_st_height";input.style.marginRight="0.5em";td.appendChild(input);select=doc.createElement("select");select.name="f_st_heightUnit";option=doc.createElement("option");option.innerHTML=i18n["pixels"];option.value="px";option.selected=/px/.test(el.style.height);select.appendChild(option);option=doc.createElement("option");option.innerHTML=i18n["points"];option.value="pt";option.selected=/pt/.test(el.style.height);select.appendChild(option);td.appendChild(select);select.style.marginRight="0.5em";td.appendChild(doc.createTextNode(i18n["Vertical align"]+":"));select=doc.createElement("select");select.name="f_st_verticalAlign";select.style.marginLeft="0.5em";td.appendChild(select);options=["Not set","Top","Middle","Bottom","Baseline"];for(var i=0;i<options.length;++i){var Val=options[i];var val=i?Val.toLowerCase():"";option=doc.createElement("option");option.value=val;option.innerHTML=i18n[Val];option.selected=(el.style.verticalAlign.toLowerCase()==val);select.appendChild(option);}return fieldset;};TableOperations.createStyleFieldset=function(parent,doc,editor,el){var i18n=TableOperations.I18N;var fieldset=doc.createElement("fieldset");var legend=doc.createElement("legend");fieldset.appendChild(legend);legend.innerHTML=i18n["CSS Style"];var table=doc.createElement("table");fieldset.appendChild(table);table.style.width="100%";var tbody=doc.createElement("tbody");table.appendChild(tbody);var tr,td,input,select,option,options,i;tr=doc.createElement("tr");tbody.appendChild(tr);td=doc.createElement("td");tr.appendChild(td);td.className="label";td.innerHTML=i18n["Background"]+":";td=doc.createElement("td");tr.appendChild(td);var df=TableOperations.createColorButton(doc,editor,el.style.backgroundColor,"backgroundColor");df.firstChild.nextSibling.style.marginRight="0.5em";td.appendChild(df);td.appendChild(doc.createTextNode(i18n["Image URL"]+": "));input=doc.createElement("input");input.type="text";input.name="f_st_backgroundImage";if(el.style.backgroundImage.match(/url\(\s*(.*?)\s*\)/)){input.value=RegExp.$1;}td.appendChild(input);tr=doc.createElement("tr");tbody.appendChild(tr);td=doc.createElement("td");tr.appendChild(td);td.className="label";td.innerHTML=i18n["FG Color"]+":";td=doc.createElement("td");tr.appendChild(td);td.appendChild(TableOperations.createColorButton(doc,editor,el.style.color,"color"));input=doc.createElement("input");input.style.visibility="hidden";input.type="text";td.appendChild(input);tr=doc.createElement("tr");tbody.appendChild(tr);td=doc.createElement("td");tr.appendChild(td);td.className="label";td.innerHTML=i18n["Border"]+":";td=doc.createElement("td");tr.appendChild(td);var colorButton=TableOperations.createColorButton(doc,editor,el.style.borderColor,"borderColor");var btn=colorButton.firstChild.nextSibling;td.appendChild(colorButton);btn.style.marginRight="0.5em";select=doc.createElement("select");var borderFields=[];td.appendChild(select);select.name="f_st_borderStyle";options=["Not set","Solid","None","Dotted","Dashed","Double","Groove","Ridge","Inset","Outset"];var currentBorderStyle=el.style.borderStyle;(currentBorderStyle.match(/([^\s]*)\s/))&&(currentBorderStyle=RegExp.$1);for(var i=0;i<options.length;++i){var Val=options[i];var val=i?Val.toLowerCase():"";option=doc.createElement("option");option.value=val;option.innerHTML=Val;(val==currentBorderStyle)&&(option.selected=true);select.appendChild(option);}select.style.marginRight="0.5em";function setBorderFieldsStatus(value){for(var i=0;i<borderFields.length;++i){var el=borderFields[i];el.style.visibility=value?"hidden":"visible";if(!value&&(el.tagName.toLowerCase()=="input")){el.focus();el.select();}}};select.onchange=function(){setBorderFieldsStatus(this.value=="none"||!this.value);};input=doc.createElement("input");borderFields.push(input);input.type="text";input.name="f_st_borderWidth";input.value=TableOperations.getLength(el.style.borderWidth);input.size="5";td.appendChild(input);input.style.marginRight="0.5em";var span=doc.createElement("span");span.innerHTML=i18n["pixels"];td.appendChild(span);borderFields.push(span);setBorderFieldsStatus(select.value=="none");var IEsuX_boxes=[];if(el.tagName.toLowerCase()=="table"){tr=doc.createElement("tr");tbody.appendChild(tr);td=doc.createElement("td");td.className="label";tr.appendChild(td);input=doc.createElement("input");input.type="checkbox";input.name=input.id="f_st_borderCollapse";var val=(/collapse/i.test(el.style.borderCollapse));td.appendChild(input);input.__msh_checked=val;IEsuX_boxes.push(input);td=doc.createElement("td");tr.appendChild(td);var label=doc.createElement("label");label.htmlFor="f_st_borderCollapse";label.innerHTML=i18n["Collapsed borders"];td.appendChild(label);}if(/^(table|tr)$/i.test(el.tagName)){tr=doc.createElement("tr");tbody.appendChild(tr);td=doc.createElement("td");td.className="label";tr.appendChild(td);input=doc.createElement("input");input.type="checkbox";td.appendChild(input);input.name=input.id="f_our_globalStyle";input.__msh_checked=!!el.__msh_globalStyle;IEsuX_boxes.push(input);td=doc.createElement("td");tr.appendChild(td);label=doc.createElement("label");label.htmlFor="f_our_globalStyle";label.innerHTML=i18n["Apply style to all cells"];td.appendChild(label);}parent.appendChild(fieldset);for(var i=IEsuX_boxes.length;--i>=0;){input=IEsuX_boxes[i];input.checked=input.__msh_checked;}return fieldset;};
